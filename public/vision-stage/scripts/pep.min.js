(function(b,c){'object'==typeof exports&&'undefined'!=typeof module?module.exports=c():'function'==typeof define&&define.amd?define(c):b.PointerEventsPolyfill=c()})(this,function(){'use strict';function b(ta,ua){ua=ua||Object.create(null);var va=document.createEvent('Event');va.initEvent(ta,ua.bubbles||!1,ua.cancelable||!1);for(var xa,wa=2;wa<C.length;wa++)xa=C[wa],va[xa]=ua[xa]||D[wa];va.buttons=ua.buttons||0;var ya=0;return ya=ua.pressure&&va.buttons?ua.pressure:va.buttons?0.5:0,va.x=va.clientX,va.y=va.clientY,va.pointerId=ua.pointerId||0,va.width=ua.width||0,va.height=ua.height||0,va.pressure=ya,va.tiltX=ua.tiltX||0,va.tiltY=ua.tiltY||0,va.twist=ua.twist||0,va.tangentialPressure=ua.tangentialPressure||0,va.pointerType=ua.pointerType||'',va.hwTimestamp=ua.hwTimestamp||0,va.isPrimary=ua.isPrimary||!1,va}function c(){this.array=[],this.size=0}function f(ta,ua,va,wa){this.addCallback=ta.bind(wa),this.removeCallback=ua.bind(wa),this.changedCallback=va.bind(wa),Q&&(this.observer=new Q(this.mutationWatcher.bind(this)))}function g(ta){return'body /shadow-deep/ '+j(ta)}function j(ta){return'[touch-action="'+ta+'"]'}function o(ta){return'{ -ms-touch-action: '+ta+'; touch-action: '+ta+'; }'}function w(ta){if(!K.pointermap.has(ta)){var ua=new Error('InvalidPointerId');throw ua.name='InvalidPointerId',ua}}function z(ta){for(var ua=ta.parentNode;ua&&ua!==ta.ownerDocument;)ua=ua.parentNode;if(!ua){var va=new Error('InvalidStateError');throw va.name='InvalidStateError',va}}function A(ta){var ua=K.pointermap.get(ta);return 0!==ua.buttons}var C=['bubbles','cancelable','view','detail','screenX','screenY','clientX','clientY','ctrlKey','altKey','shiftKey','metaKey','button','relatedTarget','pageX','pageY'],D=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],E=window.Map&&window.Map.prototype.forEach,F=E?Map:c;c.prototype={set:function(ta,ua){return void 0===ua?this.delete(ta):void(!this.has(ta)&&this.size++,this.array[ta]=ua)},has:function(ta){return this.array[ta]!==void 0},delete:function(ta){this.has(ta)&&(delete this.array[ta],this.size--)},get:function(ta){return this.array[ta]},clear:function(){this.array.length=0,this.size=0},forEach:function(ta,ua){return this.array.forEach(function(va,wa){ta.call(ua,va,wa,this)},this)}};var G=['bubbles','cancelable','view','detail','screenX','screenY','clientX','clientY','ctrlKey','altKey','shiftKey','metaKey','button','relatedTarget','buttons','pointerId','width','height','pressure','tiltX','tiltY','pointerType','hwTimestamp','isPrimary','type','target','currentTarget','which','pageX','pageY','timeStamp'],H=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,'',0,!1,'',null,null,0,0,0,0],I={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},J='undefined'!=typeof SVGElementInstance,K={pointermap:new F,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(ta,ua){var va=ua,wa=va.events;wa&&(wa.forEach(function(xa){va[xa]&&(this.eventMap[xa]=va[xa].bind(va))},this),this.eventSources[ta]=va,this.eventSourceList.push(va))},register:function(ta){for(var wa,ua=this.eventSourceList.length,va=0;va<ua&&(wa=this.eventSourceList[va]);va++)wa.register.call(wa,ta)},unregister:function(ta){for(var wa,ua=this.eventSourceList.length,va=0;va<ua&&(wa=this.eventSourceList[va]);va++)wa.unregister.call(wa,ta)},contains:function(ta,ua){try{return ta.contains(ua)}catch(va){return!1}},down:function(ta){ta.bubbles=!0,this.fireEvent('pointerdown',ta)},move:function(ta){ta.bubbles=!0,this.fireEvent('pointermove',ta)},up:function(ta){ta.bubbles=!0,this.fireEvent('pointerup',ta)},enter:function(ta){ta.bubbles=!1,this.fireEvent('pointerenter',ta)},leave:function(ta){ta.bubbles=!1,this.fireEvent('pointerleave',ta)},over:function(ta){ta.bubbles=!0,this.fireEvent('pointerover',ta)},out:function(ta){ta.bubbles=!0,this.fireEvent('pointerout',ta)},cancel:function(ta){ta.bubbles=!0,this.fireEvent('pointercancel',ta)},leaveOut:function(ta){this.out(ta),this.propagate(ta,this.leave,!1)},enterOver:function(ta){this.over(ta),this.propagate(ta,this.enter,!0)},eventHandler:function(ta){if(!ta._handledByPE){var ua=ta.type,va=this.eventMap&&this.eventMap[ua];va&&va(ta),ta._handledByPE=!0}},listen:function(ta,ua){ua.forEach(function(va){this.addEvent(ta,va)},this)},unlisten:function(ta,ua){ua.forEach(function(va){this.removeEvent(ta,va)},this)},addEvent:function(ta,ua){ta.addEventListener(ua,this.boundHandler)},removeEvent:function(ta,ua){ta.removeEventListener(ua,this.boundHandler)},makeEvent:function(ta,ua){this.captureInfo[ua.pointerId]&&(ua.relatedTarget=null);var va=new b(ta,ua);return ua.preventDefault&&(va.preventDefault=ua.preventDefault),va._target=va._target||ua.target,va},fireEvent:function(ta,ua){var va=this.makeEvent(ta,ua);return this.dispatchEvent(va)},cloneEvent:function(ta){for(var va,ua=Object.create(null),wa=0;wa<G.length;wa++)va=G[wa],ua[va]=ta[va]||H[wa],J&&('target'===va||'relatedTarget'===va)&&ua[va]instanceof SVGElementInstance&&(ua[va]=ua[va].correspondingUseElement);return ta.preventDefault&&(ua.preventDefault=function(){ta.preventDefault()}),ua},getTarget:function(ta){var ua=this.captureInfo[ta.pointerId];return ua?ta._target!==ua&&ta.type in I?void 0:ua:ta._target},propagate:function(ta,ua,va){for(var wa=ta.target,xa=[];wa!==document&&!wa.contains(ta.relatedTarget);)if(xa.push(wa),wa=wa.parentNode,!wa)return;va&&xa.reverse(),xa.forEach(function(ya){ta.target=ya,ua.call(this,ta)},this)},setCapture:function(ta,ua,va){this.captureInfo[ta]&&this.releaseCapture(ta,va),this.captureInfo[ta]=ua,this.implicitRelease=this.releaseCapture.bind(this,ta,va),document.addEventListener('pointerup',this.implicitRelease),document.addEventListener('pointercancel',this.implicitRelease);var wa=new b('gotpointercapture');wa.pointerId=ta,wa._target=ua,va||this.asyncDispatchEvent(wa)},releaseCapture:function(ta,ua){var va=this.captureInfo[ta];if(va){this.captureInfo[ta]=void 0,document.removeEventListener('pointerup',this.implicitRelease),document.removeEventListener('pointercancel',this.implicitRelease);var wa=new b('lostpointercapture');wa.pointerId=ta,wa._target=va,ua||this.asyncDispatchEvent(wa)}},dispatchEvent:function(ta){var ua=this.getTarget(ta);if(ua)return ua.dispatchEvent(ta)},asyncDispatchEvent:function(ta){requestAnimationFrame(this.dispatchEvent.bind(this,ta))}};K.boundHandler=K.eventHandler.bind(K);var L={shadow:function(ta){if(ta)return ta.shadowRoot||ta.webkitShadowRoot},canTarget:function(ta){return ta&&!!ta.elementFromPoint},targetingShadow:function(ta){var ua=this.shadow(ta);if(this.canTarget(ua))return ua},olderShadow:function(ta){var ua=ta.olderShadowRoot;if(!ua){var va=ta.querySelector('shadow');va&&(ua=va.olderShadowRoot)}return ua},allShadows:function(ta){for(var ua=[],va=this.shadow(ta);va;)ua.push(va),va=this.olderShadow(va);return ua},searchRoot:function(ta,ua,va){if(ta){var wa=ta.elementFromPoint(ua,va),xa,ya;for(ya=this.targetingShadow(wa);ya;)if(xa=ya.elementFromPoint(ua,va),!xa)ya=this.olderShadow(ya);else{var za=this.targetingShadow(xa);return this.searchRoot(za,ua,va)||xa}return wa}},owner:function(ta){for(var ua=ta;ua.parentNode;)ua=ua.parentNode;return ua.nodeType!==Node.DOCUMENT_NODE&&ua.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(ua=document),ua},findTarget:function(ta){var ua=ta.clientX,va=ta.clientY,wa=this.owner(ta.target);return wa.elementFromPoint(ua,va)||(wa=document),this.searchRoot(wa,ua,va)}},M=Array.prototype.forEach.call.bind(Array.prototype.forEach),N=Array.prototype.map.call.bind(Array.prototype.map),O=Array.prototype.slice.call.bind(Array.prototype.slice),P=Array.prototype.filter.call.bind(Array.prototype.filter),Q=window.MutationObserver||window.WebKitMutationObserver,S={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:['touch-action']};f.prototype={watchSubtree:function(ta){this.observer&&L.canTarget(ta)&&this.observer.observe(ta,S)},enableOnSubtree:function(ta){this.watchSubtree(ta),ta===document&&'complete'!==document.readyState?this.installOnLoad():this.installNewSubtree(ta)},installNewSubtree:function(ta){M(this.findElements(ta),this.addElement,this)},findElements:function(ta){return ta.querySelectorAll?ta.querySelectorAll('[touch-action]'):[]},removeElement:function(ta){this.removeCallback(ta)},addElement:function(ta){this.addCallback(ta)},elementChanged:function(ta,ua){this.changedCallback(ta,ua)},concatLists:function(ta,ua){return ta.concat(O(ua))},installOnLoad:function(){document.addEventListener('readystatechange',function(){'complete'===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(ta){return ta.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(ta){var ua=N(ta,this.findElements,this);return ua.push(P(ta,this.isElement)),ua.reduce(this.concatLists,[])},mutationWatcher:function(ta){ta.forEach(this.mutationHandler,this)},mutationHandler:function(ta){if('childList'===ta.type){var ua=this.flattenMutationTree(ta.addedNodes);ua.forEach(this.addElement,this);var va=this.flattenMutationTree(ta.removedNodes);va.forEach(this.removeElement,this)}else'attributes'===ta.type&&this.elementChanged(ta.target,ta.oldValue)}};var T=['none','auto','pan-x','pan-y',{rule:'pan-x pan-y',selectors:['pan-x pan-y','pan-y pan-x']}],U='',V=window.PointerEvent||window.MSPointerEvent,W=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,X=K.pointermap,Y=25,Z=[1,4,2,8,16],$=!1;try{$=1===new MouseEvent('test',{buttons:1}).buttons}catch(ta){}var _={POINTER_ID:1,POINTER_TYPE:'mouse',events:['mousedown','mousemove','mouseup','mouseover','mouseout'],register:function(ta){K.listen(ta,this.events)},unregister:function(ta){K.unlisten(ta,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(ta){for(var za,ua=this.lastTouches,va=ta.clientX,wa=ta.clientY,xa=0,ya=ua.length;xa<ya&&(za=ua[xa]);xa++){var Aa=Math.abs(va-za.x),Ba=Math.abs(wa-za.y);if(Aa<=Y&&Ba<=Y)return!0}},prepareEvent:function(ta){var ua=K.cloneEvent(ta),va=ua.preventDefault;return ua.preventDefault=function(){ta.preventDefault(),va()},ua.pointerId=this.POINTER_ID,ua.isPrimary=!0,ua.pointerType=this.POINTER_TYPE,ua},prepareButtonsForMove:function(ta,ua){var va=X.get(this.POINTER_ID);ta.buttons=0!==ua.which&&va?va.buttons:0,ua.buttons=ta.buttons},mousedown:function(ta){if(!this.isEventSimulatedFromTouch(ta)){var ua=X.get(this.POINTER_ID),va=this.prepareEvent(ta);$||(va.buttons=Z[va.button],ua&&(va.buttons|=ua.buttons),ta.buttons=va.buttons),X.set(this.POINTER_ID,ta),ua&&0!==ua.buttons?K.move(va):K.down(va)}},mousemove:function(ta){if(!this.isEventSimulatedFromTouch(ta)){var ua=this.prepareEvent(ta);$||this.prepareButtonsForMove(ua,ta),ua.button=-1,X.set(this.POINTER_ID,ta),K.move(ua)}},mouseup:function(ta){if(!this.isEventSimulatedFromTouch(ta)){var ua=X.get(this.POINTER_ID),va=this.prepareEvent(ta);if(!$){var wa=Z[va.button];va.buttons=ua?ua.buttons&~wa:0,ta.buttons=va.buttons}X.set(this.POINTER_ID,ta),va.buttons&=~Z[va.button],0===va.buttons?K.up(va):K.move(va)}},mouseover:function(ta){if(!this.isEventSimulatedFromTouch(ta)){var ua=this.prepareEvent(ta);$||this.prepareButtonsForMove(ua,ta),ua.button=-1,X.set(this.POINTER_ID,ta),K.enterOver(ua)}},mouseout:function(ta){if(!this.isEventSimulatedFromTouch(ta)){var ua=this.prepareEvent(ta);$||this.prepareButtonsForMove(ua,ta),ua.button=-1,K.leaveOut(ua)}},cancel:function(ta){var ua=this.prepareEvent(ta);K.cancel(ua),this.deactivateMouse()},deactivateMouse:function(){X.delete(this.POINTER_ID)}},aa=K.captureInfo,ba=L.findTarget.bind(L),ca=L.allShadows.bind(L),ea=K.pointermap,ha='touch-action',ia,ja={events:['touchstart','touchmove','touchend','touchcancel'],register:function(ta){ia.enableOnSubtree(ta)},unregister:function(){},elementAdded:function(ta){var ua=ta.getAttribute(ha),va=this.touchActionToScrollType(ua);va&&(ta._scrollType=va,K.listen(ta,this.events),ca(ta).forEach(function(wa){wa._scrollType=va,K.listen(wa,this.events)},this))},elementRemoved:function(ta){ta._scrollType=void 0,K.unlisten(ta,this.events),ca(ta).forEach(function(ua){ua._scrollType=void 0,K.unlisten(ua,this.events)},this)},elementChanged:function(ta,ua){var va=ta.getAttribute(ha),wa=this.touchActionToScrollType(va),xa=this.touchActionToScrollType(ua);wa&&xa?(ta._scrollType=wa,ca(ta).forEach(function(ya){ya._scrollType=wa},this)):xa?this.elementRemoved(ta):wa&&this.elementAdded(ta)},scrollTypes:{EMITTER:'none',XSCROLLER:'pan-x',YSCROLLER:'pan-y',SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(ta){var ua=ta,va=this.scrollTypes;if('none'===ua)return'none';return ua===va.XSCROLLER?'X':ua===va.YSCROLLER?'Y':va.SCROLLER.exec(ua)?'XY':void 0},POINTER_TYPE:'touch',firstTouch:null,isPrimaryTouch:function(ta){return this.firstTouch===ta.identifier},setPrimaryTouch:function(ta){(0===ea.size||1===ea.size&&ea.has(1))&&(this.firstTouch=ta.identifier,this.firstXY={X:ta.clientX,Y:ta.clientY},this.scrolling=!1,this.cancelResetClickCount())},removePrimaryPointer:function(ta){ta.isPrimary&&(this.firstTouch=null,this.firstXY=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var ta=function(){this.clickCount=0,this.resetId=null}.bind(this);this.resetId=setTimeout(ta,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(ta){var ua=0;return('touchstart'===ta||'touchmove'===ta)&&(ua=1),ua},touchToPointer:function(ta){var ua=this.currentTouchEvent,va=K.cloneEvent(ta),wa=va.pointerId=ta.identifier+2;va.target=aa[wa]||ba(va),va.bubbles=!0,va.cancelable=!0,va.detail=this.clickCount,va.button=0,va.buttons=this.typeToButtons(ua.type),va.width=2*(ta.radiusX||ta.webkitRadiusX||0),va.height=2*(ta.radiusY||ta.webkitRadiusY||0),va.pressure=ta.force||ta.webkitForce||0.5,va.isPrimary=this.isPrimaryTouch(ta),va.pointerType=this.POINTER_TYPE,va.altKey=ua.altKey,va.ctrlKey=ua.ctrlKey,va.metaKey=ua.metaKey,va.shiftKey=ua.shiftKey;var xa=this;return va.preventDefault=function(){xa.scrolling=!1,xa.firstXY=null,ua.preventDefault()},va},processTouches:function(ta,ua){var va=ta.changedTouches;this.currentTouchEvent=ta;for(var xa,wa=0;wa<va.length;wa++)xa=va[wa],ua.call(this,this.touchToPointer(xa))},shouldScroll:function(ta){if(this.firstXY){var ua,va=ta.currentTarget._scrollType;if('none'===va)ua=!1;else if('XY'===va)ua=!0;else{var wa=ta.changedTouches[0],xa=va,ya='Y'===va?'X':'Y',za=Math.abs(wa['client'+xa]-this.firstXY[xa]),Aa=Math.abs(wa['client'+ya]-this.firstXY[ya]);ua=za>=Aa}return this.firstXY=null,ua}},findTouch:function(ta,ua){for(var xa,va=0,wa=ta.length;va<wa&&(xa=ta[va]);va++)if(xa.identifier===ua)return!0},vacuumTouches:function(ta){var ua=ta.touches;if(ea.size>=ua.length){var va=[];ea.forEach(function(wa,xa){if(1!==xa&&!this.findTouch(ua,xa-2)){var ya=wa.out;va.push(ya)}},this),va.forEach(this.cancelOut,this)}},touchstart:function(ta){this.vacuumTouches(ta),this.setPrimaryTouch(ta.changedTouches[0]),this.dedupSynthMouse(ta),this.scrolling||(this.clickCount++,this.processTouches(ta,this.overDown))},overDown:function(ta){ea.set(ta.pointerId,{target:ta.target,out:ta,outTarget:ta.target}),K.enterOver(ta),K.down(ta)},touchmove:function(ta){this.scrolling||(this.shouldScroll(ta)?(this.scrolling=!0,this.touchcancel(ta)):(ta.preventDefault(),this.processTouches(ta,this.moveOverOut)))},moveOverOut:function(ta){var ua=ta,va=ea.get(ua.pointerId);if(va){var wa=va.out,xa=va.outTarget;K.move(ua),wa&&xa!==ua.target&&(wa.relatedTarget=ua.target,ua.relatedTarget=xa,wa.target=xa,ua.target?(K.leaveOut(wa),K.enterOver(ua)):(ua.target=xa,ua.relatedTarget=null,this.cancelOut(ua))),va.out=ua,va.outTarget=ua.target}},touchend:function(ta){this.dedupSynthMouse(ta),this.processTouches(ta,this.upOut)},upOut:function(ta){this.scrolling||(K.up(ta),K.leaveOut(ta)),this.cleanUpPointer(ta)},touchcancel:function(ta){this.processTouches(ta,this.cancelOut)},cancelOut:function(ta){K.cancel(ta),K.leaveOut(ta),this.cleanUpPointer(ta)},cleanUpPointer:function(ta){ea.delete(ta.pointerId),this.removePrimaryPointer(ta)},dedupSynthMouse:function(ta){var ua=_.lastTouches,va=ta.changedTouches[0];if(this.isPrimaryTouch(va)){var wa={x:va.clientX,y:va.clientY};ua.push(wa);var xa=function(ya,za){var Aa=ya.indexOf(za);-1<Aa&&ya.splice(Aa,1)}.bind(null,ua,wa);setTimeout(xa,2500)}}};ia=new f(ja.elementAdded,ja.elementRemoved,ja.elementChanged,ja);var ka=K.pointermap,la=window.MSPointerEvent&&'number'==typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,ma={events:['MSPointerDown','MSPointerMove','MSPointerUp','MSPointerOut','MSPointerOver','MSPointerCancel','MSGotPointerCapture','MSLostPointerCapture'],register:function(ta){K.listen(ta,this.events)},unregister:function(ta){K.unlisten(ta,this.events)},POINTER_TYPES:['','unavailable','touch','pen','mouse'],prepareEvent:function(ta){var ua=ta;return la&&(ua=K.cloneEvent(ta),ua.pointerType=this.POINTER_TYPES[ta.pointerType]),ua},cleanup:function(ta){ka.delete(ta)},MSPointerDown:function(ta){ka.set(ta.pointerId,ta);var ua=this.prepareEvent(ta);K.down(ua)},MSPointerMove:function(ta){var ua=this.prepareEvent(ta);K.move(ua)},MSPointerUp:function(ta){var ua=this.prepareEvent(ta);K.up(ua),this.cleanup(ta.pointerId)},MSPointerOut:function(ta){var ua=this.prepareEvent(ta);K.leaveOut(ua)},MSPointerOver:function(ta){var ua=this.prepareEvent(ta);K.enterOver(ua)},MSPointerCancel:function(ta){var ua=this.prepareEvent(ta);K.cancel(ua),this.cleanup(ta.pointerId)},MSLostPointerCapture:function(ta){var ua=K.makeEvent('lostpointercapture',ta);K.dispatchEvent(ua)},MSGotPointerCapture:function(ta){var ua=K.makeEvent('gotpointercapture',ta);K.dispatchEvent(ua)}},na=window.navigator,pa,qa,ra;na.msPointerEnabled?(pa=function(ta){w(ta),z(this),A(ta)&&(K.setCapture(ta,this,!0),this.msSetPointerCapture(ta))},qa=function(ta){w(ta),K.releaseCapture(ta,!0),this.msReleasePointerCapture(ta)}):(pa=function(ua){w(ua),z(this),A(ua)&&K.setCapture(ua,this)},qa=function(ua){w(ua),K.releaseCapture(ua)}),ra=function(ua){return!!K.captureInfo[ua]},function(){if(V){T.forEach(function(ua){ua+''===ua?(U+=j(ua)+o(ua)+'\n',W&&(U+=g(ua)+o(ua)+'\n')):(U+=ua.selectors.map(j)+o(ua.rule)+'\n',W&&(U+=ua.selectors.map(g)+o(ua.rule)+'\n'))});var ta=document.createElement('style');ta.textContent=U,document.head.appendChild(ta)}}(),function(){if(!window.PointerEvent){if(window.PointerEvent=b,window.navigator.msPointerEnabled){var ta=window.navigator.msMaxTouchPoints;Object.defineProperty(window.navigator,'maxTouchPoints',{value:ta,enumerable:!0}),K.registerSource('ms',ma)}else Object.defineProperty(window.navigator,'maxTouchPoints',{value:0,enumerable:!0}),K.registerSource('mouse',_),void 0!==window.ontouchstart&&K.registerSource('touch',ja);K.register(document)}}(),function(){window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:pa},releasePointerCapture:{value:qa},hasPointerCapture:{value:ra}})}();return{dispatcher:K,Installer:f,PointerEvent:b,PointerMap:F,targetFinding:L}});