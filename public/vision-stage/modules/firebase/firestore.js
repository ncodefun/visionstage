import{j as t,a as e,b as n,k as r,l as i,m as o,n as s,o as u,p as a,q as c,g as h,r as f,L as l,C as p,f as d}from"../common/index.esm-671f1674.js";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var v=function(t,e){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function y(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var g,m="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},w=w||{},b=m||self;function I(){}function _(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function E(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var T="closure_uid_"+(1e9*Math.random()>>>0),N=0;function A(t,e,n){return t.call.apply(t.bind,arguments)}function S(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function x(t,e,n){return(x=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?A:S).apply(null,arguments)}function D(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function k(){return Date.now()}function O(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function C(){this.j=this.j,this.i=this.i}C.prototype.j=!1,C.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,T)&&t[T]||(t[T]=++N))},C.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var P=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},L=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function R(t){return Array.prototype.concat.apply([],arguments)}function V(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function M(t){return/^[\s\xa0]*$/.test(t)}var U,F=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function q(t,e){return-1!=t.indexOf(e)}function j(t,e){return t<e?-1:t>e?1:0}t:{var z=b.navigator;if(z){var G=z.userAgent;if(G){U=G;break t}}U=""}function H(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function B(t){var e={};for(var n in t)e[n]=t[n];return e}var K="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function J(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<K.length;o++)n=K[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function W(t){return W[" "](t),t}W[" "]=I;var X,Y,Q=q(U,"Opera"),$=q(U,"Trident")||q(U,"MSIE"),Z=q(U,"Edge"),tt=Z||$,et=q(U,"Gecko")&&!(q(U.toLowerCase(),"webkit")&&!q(U,"Edge"))&&!(q(U,"Trident")||q(U,"MSIE"))&&!q(U,"Edge"),nt=q(U.toLowerCase(),"webkit")&&!q(U,"Edge");function rt(){var t=b.document;return t?t.documentMode:void 0}t:{var it="",ot=(Y=U,et?/rv:([^\);]+)(\)|;)/.exec(Y):Z?/Edge\/([\d\.]+)/.exec(Y):$?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Y):nt?/WebKit\/(\S+)/.exec(Y):Q?/(?:Version)[ \/]?(\S+)/.exec(Y):void 0);if(ot&&(it=ot?ot[1]:""),$){var st=rt();if(null!=st&&st>parseFloat(it)){X=String(st);break t}}X=it}var ut,at={};function ct(t){return function(t,e){var n=at;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(){for(var e=0,n=F(String(X)).split("."),r=F(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",u=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],u=/(\d*)(\D*)(.*)/.exec(u)||["","","",""],0==s[0].length&&0==u[0].length)break;e=j(0==s[1].length?0:parseInt(s[1],10),0==u[1].length?0:parseInt(u[1],10))||j(0==s[2].length,0==u[2].length)||j(s[2],u[2]),s=s[3],u=u[3]}while(0==e)}return 0<=e}))}if(b.document&&$){var ht=rt();ut=ht||(parseInt(X,10)||void 0)}else ut=void 0;var ft=ut,lt=!$||9<=Number(ft),pt=$&&!ct("9"),dt=function(){if(!b.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{b.addEventListener("test",I,e),b.removeEventListener("test",I,e)}catch(t){}return t}();function vt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function yt(t,e){if(vt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(et){t:{try{W(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:gt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}vt.prototype.b=function(){this.defaultPrevented=!0},O(yt,vt);var gt={2:"touch",3:"pen",4:"mouse"};yt.prototype.b=function(){yt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,pt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var mt="closure_listenable_"+(1e6*Math.random()|0),wt=0;function bt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++wt,this.Y=this.Z=!1}function It(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function _t(t){this.src=t,this.a={},this.b=0}function Et(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=P(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(It(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Tt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}_t.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Tt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new bt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Nt="closure_lm_"+(1e6*Math.random()|0),At={};function St(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Rt(r),e&&e[mt]?e.wa(n,r,E(i)?!!i.capture:!!i,o):xt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)St(t,e[o],n,r,i);return null}return n=Rt(n),t&&t[mt]?t.va(e,n,E(r)?!!r.capture:!!r,i):xt(t,e,n,!1,r,i)}function xt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=E(i)?!!i.capture:!!i;if(s&&!lt)return null;var u=Pt(t);if(u||(t[Nt]=u=new _t(t)),(n=u.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Ct,e=lt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)dt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(kt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Dt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[mt])Et(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(kt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Pt(e))?(Et(n,t),0==n.b&&(n.src=null,e[Nt]=null)):It(t)}}}function kt(t){return t in At?At[t]:At[t]="on"+t}function Ot(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Dt(t),n.call(r,e)}function Ct(t,e){if(t.Y)return!0;if(!lt){if(!e)t:{e=["window","event"];for(var n=b,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Ot(t,e=new yt(e,this))}return Ot(t,new yt(e,this))}function Pt(t){return(t=t[Nt])instanceof _t?t:null}var Lt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Rt(t){return"function"==typeof t?t:(t[Lt]||(t[Lt]=function(e){return t.handleEvent(e)}),t[Lt])}function Vt(){C.call(this),this.c=new _t(this),this.J=this,this.C=null}function Mt(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new vt(e,t);else if(e instanceof vt)e.target=e.target||t;else{var i=e;J(e=new vt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=Ut(s,r,!0,e)&&i}if(i=Ut(s=e.a=t,r,!0,e)&&i,i=Ut(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Ut(s=e.a=n[o],r,!1,e)&&i}function Ut(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var u=s.listener,a=s.ca||s.src;s.Z&&Et(t.c,s),i=!1!==u.call(a,r)&&i}}return i&&!r.defaultPrevented}O(Vt,C),Vt.prototype[mt]=!0,(g=Vt.prototype).addEventListener=function(t,e,n,r){St(this,t,e,n,r)},g.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=E(i)?!!i.capture:!!i,r=Rt(r),e&&e[mt]?(e=e.c,(n=String(n).toString())in e.a&&(-1<(r=Tt(s=e.a[n],r,i,o))&&(It(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--)))):e&&(e=Pt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Tt(n,r,i,o)),(r=-1<e?n[e]:null)&&Dt(r))}(this,t,e,n,r)},g.G=function(){if(Vt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)It(n[r]);delete e.a[t],e.b--}}this.C=null},g.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},g.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Ft=b.JSON.stringify;function qt(){this.b=this.a=null}var jt,zt=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())((function(){return new Ht}),(function(t){t.reset()}));function Gt(){var t=Wt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Ht(){this.next=this.b=this.a=null}function Bt(t){b.setTimeout((function(){throw t}),0)}function Kt(t,e){jt||function(){var t=b.Promise.resolve(void 0);jt=function(){t.then(Xt)}}(),Jt||(jt(),Jt=!0),Wt.add(t,e)}qt.prototype.add=function(t,e){var n=zt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Ht.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Ht.prototype.reset=function(){this.next=this.b=this.a=null};var Jt=!1,Wt=new qt;function Xt(){for(var t;t=Gt();){try{t.a.call(t.b)}catch(t){Bt(t)}var e=zt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Jt=!1}function Yt(t,e){Vt.call(this),this.b=t||1,this.a=e||b,this.f=x(this.Za,this),this.g=k()}function Qt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function $t(t,e,n){if("function"==typeof t)n&&(t=x(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=x(t.handleEvent,t)}return 2147483647<Number(e)?-1:b.setTimeout(t,e||0)}function Zt(t){t.a=$t((function(){t.a=null,t.c&&(t.c=!1,Zt(t))}),t.h);var e=t.b;t.b=null,t.g.apply(null,e)}O(Yt,Vt),(g=Yt.prototype).aa=!1,g.M=null,g.Za=function(){if(this.aa){var t=k()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Mt(this,"tick"),this.aa&&(Qt(this),this.start()))}},g.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=k())},g.G=function(){Yt.X.G.call(this),Qt(this),delete this.a};var te=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}v(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:Zt(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(b.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(C);function ee(t){C.call(this),this.b=t,this.a={}}O(ee,C);var ne=[];function re(t,e,n,r){Array.isArray(n)||(n&&(ne[0]=n.toString()),n=ne);for(var i=0;i<n.length;i++){var o=St(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ie(t){H(t.a,(function(t,e){this.a.hasOwnProperty(e)&&Dt(t)}),t),t.a={}}function oe(){this.a=!0}function se(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Ft(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}ee.prototype.G=function(){ee.X.G.call(this),ie(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},oe.prototype.info=function(){};var ue={},ae=null;function ce(){return ae=ae||new Vt}function he(t){vt.call(this,ue.Fa,t)}function fe(t){var e=ce();Mt(e,new he(e,t))}function le(t,e){vt.call(this,ue.STAT_EVENT,t),this.stat=e}function pe(t){var e=ce();Mt(e,new le(e,t))}function de(t){vt.call(this,ue.Ga,t)}function ve(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return b.setTimeout((function(){t()}),e)}ue.Fa="serverreachability",O(he,vt),ue.STAT_EVENT="statevent",O(le,vt),ue.Ga="timingevent",O(de,vt);var ye={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},ge={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function me(){}function we(t){var e;return(e=t.a)||(e=t.a={}),e}function be(){}me.prototype.a=null;var Ie,_e={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function Ee(){vt.call(this,"d")}function Te(){vt.call(this,"c")}function Ne(){}function Ae(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new ee(this),this.P=Se,t=tt?125:void 0,this.R=new Yt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}O(Ee,vt),O(Te,vt),O(Ne,me),Ie=new Ne;var Se=45e3,xe={},De={};function ke(t,e,n){t.H=1,t.i=$e(Ke(e)),t.j=n,t.I=!0,Oe(t,null)}function Oe(t,e){t.u=k(),Le(t),t.l=Ke(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),ln(n.b,"t",r),t.D=0,t.a=sr(t.g,t.g.C?e:null),0<t.O&&(t.F=new te(x(t.Ca,t,t.a),t.O)),re(t.J,t.a,"readystatechange",t.Xa),e=t.B?B(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),fe(1),function(t,e,n,r,i,o){t.info((function(){if(t.a)if(o)for(var s="",u=o.split("&"),a=0;a<u.length;a++){var c=u[a].split("=");if(1<c.length){var h=c[0];c=c[1];var f=h.split("_");s=2<=f.length&&"type"==f[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.c,t.m,t.l,t.f,t.S,t.j)}function Ce(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Pe(t,n);if(i==De){4==e&&(t.h=4,pe(14),r=!1),se(t.c,t.f,null,"[Incomplete Response]");break}if(i==xe){t.h=4,pe(15),se(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}se(t.c,t.f,i,null),Fe(t,i)}4==e&&0==n.length&&(t.h=1,pe(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),$n(e),e.F=!0,pe(11))):(se(t.c,t.f,n,"[Invalid Chunked Response]"),Ue(t),Me(t))}function Pe(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?De:(n=Number(e.substring(n,r)),isNaN(n)?xe:(r+=1)+n>e.length?De:(e=e.substr(r,n),t.D=r+n,e))}function Le(t){t.T=k()+t.P,Re(t,t.P)}function Re(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=ve(x(t.Va,t),e)}function Ve(t){t.o&&(b.clearTimeout(t.o),t.o=null)}function Me(t){0==t.g.v||t.A||er(t.g,t)}function Ue(t){Ve(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Qt(t.R),ie(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Fe(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||wn(n.b,t)))if(n.I=t.N,!t.C&&wn(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;tr(n),Gn(n)}Qn(n),pe(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=ve(x(n.Sa,n),6e3));if(1>=mn(n.b)&&n.ea){try{n.ea()}catch(t){}n.ea=void 0}}else rr(n,11)}else if((t.C||n.a==t)&&tr(n),!M(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];null!=s&&(n.pa=s,n.c.info("SVER="+n.pa));var u=i[5];if(null!=u&&"number"==typeof u&&0<u){var a=1.5*u;n.D=a,n.c.info("backChannelRequestTimeoutMs_="+a)}a=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var f=a.b;!f.a&&(q(h,"spdy")||q(h,"quic")||q(h,"h2"))&&(f.f=f.g,f.a=new Set,f.b&&(bn(f,f.b),f.b=null))}if(a.A){var l=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;l&&(a.na=l,Qe(a.B,a.A,l))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=k()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var p=t;if((a=n).la=or(a,a.C?a.ga:null,a.fa),p.C){In(a.b,p);var d=p,v=a.D;v&&d.setTimeout(v),d.o&&(Ve(d),Le(d)),a.a=p}else Yn(a);0<n.g.length&&Kn(n)}else"stop"!=i[0]&&"close"!=i[0]||rr(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?rr(n,7):zn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);fe(4)}catch(t){}}function qe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(_(t)||"string"==typeof t)L(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(_(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(_(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function je(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof je)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function ze(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ge(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Ge(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Ge(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(g=Ae.prototype).setTimeout=function(t){this.P=t},g.Xa=function(t){t=t.target;var e=this.F;e&&3==Un(t)?e.f():this.Ca(t)},g.Ca=function(t){try{if(t==this.a)t:{var e=Un(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!tt&&!this.a.$())){this.A||4!=e||7==n||fe(8==n||0>=r?3:2),Ve(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,u=this.a;if((s=u.a?u.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!M(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.h=3,pe(12),Ue(this),Me(this);break t}se(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Fe(this,a)}this.I?(Ce(this,e,o),tt&&this.b&&3==e&&(re(this.J,this.R,"tick",this.Wa),this.R.start())):(se(this.c,this.f,o,null),Fe(this,o)),4==e&&Ue(this),this.b&&!this.A&&(4==e?er(this.g,this):(this.b=!1,Le(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,pe(12)):(this.h=0,pe(13)),Ue(this),Me(this)}}}catch(t){}},g.Wa=function(){if(this.a){var t=Un(this.a),e=this.a.$();this.D<e.length&&(Ve(this),Ce(this,t,e),this.b&&4!=t&&Le(this))}},g.cancel=function(){this.A=!0,Ue(this)},g.Va=function(){this.o=null;var t=k();0<=t-this.T?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.c,this.l),2!=this.H&&(fe(3),pe(17)),Ue(this),this.h=2,Me(this)):Re(this,this.T-t)},(g=je.prototype).K=function(){ze(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},g.L=function(){return ze(this),this.a.concat()},g.get=function(t,e){return Ge(this.b,t)?this.b[t]:e},g.set=function(t,e){Ge(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},g.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var He=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Be(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Be){this.a=void 0!==e?e:t.a,Je(this,t.f),this.j=t.j,We(this,t.c),Xe(this,t.h),this.g=t.g,e=t.b;var n=new an;n.c=e.c,e.a&&(n.a=new je(e.a),n.b=e.b),Ye(this,n),this.i=t.i}else t&&(n=String(t).match(He))?(this.a=!!e,Je(this,n[1]||"",!0),this.j=Ze(n[2]||""),We(this,n[3]||"",!0),Xe(this,n[4]),this.g=Ze(n[5]||"",!0),Ye(this,n[6]||"",!0),this.i=Ze(n[7]||"")):(this.a=!!e,this.b=new an(null,this.a))}function Ke(t){return new Be(t)}function Je(t,e,n){t.f=n?Ze(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function We(t,e,n){t.c=n?Ze(e,!0):e}function Xe(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Ye(t,e,n){e instanceof an?(t.b=e,function(t,e){e&&!t.f&&(cn(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(hn(this,e),ln(this,n,t))}),t)),t.f=e}(t.b,t.a)):(n||(e=tn(e,sn)),t.b=new an(e,t.a))}function Qe(t,e,n){t.b.set(e,n)}function $e(t){return Qe(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^k()).toString(36)),t}function Ze(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function tn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,en),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function en(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Be.prototype.toString=function(){var t=[],e=this.f;e&&t.push(tn(e,nn,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(tn(e,nn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(tn(n,"/"==n.charAt(0)?on:rn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",tn(n,un)),t.join("")};var nn=/[#\/\?@]/g,rn=/[#\?:]/g,on=/[#\?]/g,sn=/[#\?@]/g,un=/#/g;function an(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function cn(t){t.a||(t.a=new je,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function hn(t,e){cn(t),e=pn(t,e),Ge(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ge((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&ze(t)))}function fn(t,e){return cn(t),e=pn(t,e),Ge(t.a.b,e)}function ln(t,e,n){hn(t,e),0<n.length&&(t.c=null,t.a.set(pn(t,e),V(n)),t.b+=n.length)}function pn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(g=an.prototype).add=function(t,e){cn(this),this.c=null,t=pn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},g.forEach=function(t,e){cn(this),this.a.forEach((function(n,r){L(n,(function(n){t.call(e,n,r,this)}),this)}),this)},g.L=function(){cn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},g.K=function(t){cn(this);var e=[];if("string"==typeof t)fn(this,t)&&(e=R(e,this.a.get(pn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=R(e,t[n])}return e},g.set=function(t,e){return cn(this),this.c=null,fn(this,t=pn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},g.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},g.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var dn=function(t,e){this.b=t,this.a=e};function vn(t){this.g=t||yn,b.PerformanceNavigationTiming?t=0<(t=b.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(b.ia&&b.ia.ya&&b.ia.ya()&&b.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var yn=10;function gn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function mn(t){return t.b?1:t.a?t.a.size:0}function wn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function bn(t,e){t.a?t.a.add(e):t.b=e}function In(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function _n(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=y(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.s)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return V(t.c)}function En(){}function Tn(){this.a=new En}function Nn(t,e,n){var r=n||"";try{qe(t,(function(t,n){var i=t;E(t)&&(i=Ft(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function An(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}vn.prototype.cancel=function(){var t,e;if(this.c=_n(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=y(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},En.prototype.stringify=function(t){return b.JSON.stringify(t,void 0)},En.prototype.parse=function(t){return b.JSON.parse(t,void 0)};var Sn=b.JSON.parse;function xn(t){Vt.call(this),this.headers=new je,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Dn,this.D=this.F=!1}O(xn,Vt);var Dn="",kn=/^https?$/i,On=["POST","PUT"];function Cn(t){return"content-type"==t.toLowerCase()}function Pn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Ln(t),Vn(t)}function Ln(t){t.u||(t.u=!0,Mt(t,"complete"),Mt(t,"error"))}function Rn(t){if(t.b&&void 0!==w&&(!t.s[1]||4!=Un(t)||2!=t.W()))if(t.l&&4==Un(t))$t(t.za,0,t);else if(Mt(t,"readystatechange"),4==Un(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(He)[1]||null;if(!o&&b.self&&b.self.location){var s=b.self.location.protocol;o=s.substr(0,s.length-1)}i=!kn.test(o?o.toLowerCase():"")}e=i}if(e)Mt(t,"complete"),Mt(t,"success");else{t.h=6;try{var u=2<Un(t)?t.a.statusText:""}catch(n){u=""}t.f=u+" ["+t.W()+"]",Ln(t)}}finally{Vn(t)}}}function Vn(t,e){if(t.a){Mn(t);var n=t.a,r=t.s[0]?I:null;t.a=null,t.s=null,e||Mt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Mn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(b.clearTimeout(t.m),t.m=null)}function Un(t){return t.a?t.a.readyState:0}function Fn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return H(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Qe(t,e,n))}function qn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function jn(t){this.pa=0,this.g=[],this.c=new oe,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=qn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=qn("baseRetryDelayMs",5e3,t),this.Ra=qn("retryDelaySeedMs",1e4,t),this.Ma=qn("forwardChannelMaxRetries",2,t),this.ma=qn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new vn(t&&t.concurrentRequestLimit),this.ka=new Tn,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function zn(t){if(Hn(t),3==t.v){var e=t.R++,n=Ke(t.B);Qe(n,"SID",t.J),Qe(n,"RID",e),Qe(n,"TYPE","terminate"),Wn(t,n),(e=new Ae(t,t.c,e,void 0)).H=2,e.i=$e(Ke(n)),n=!1,b.navigator&&b.navigator.sendBeacon&&(n=b.navigator.sendBeacon(e.i.toString(),"")),!n&&b.Image&&((new Image).src=e.i,n=!0),n||(e.a=sr(e.g,null),e.a.ba(e.i)),e.u=k(),Le(e)}ir(t)}function Gn(t){t.a&&($n(t),t.a.cancel(),t.a=null)}function Hn(t){Gn(t),t.j&&(b.clearTimeout(t.j),t.j=null),tr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&b.clearTimeout(t.h),t.h=null)}function Bn(t,e){t.g.push(new dn(t.Oa++,e)),3==t.v&&Kn(t)}function Kn(t){gn(t.b)||t.h||(t.h=!0,Kt(t.Ba,t),t.u=0)}function Jn(t,e){var n;n=e?e.f:t.R++;var r=Ke(t.B);Qe(r,"SID",t.J),Qe(r,"RID",n),Qe(r,"AID",t.P),Wn(t,r),t.i&&t.l&&Fn(r,t.i,t.l),n=new Ae(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Xn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),bn(t.b,n),ke(n,r,e)}function Wn(t,e){t.f&&qe({},(function(t,n){Qe(e,n,t)}))}function Xn(t,e,n){n=Math.min(t.g.length,n);var r=t.f?x(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if(0>(c-=o))o=Math.max(0,i[a].b-100),u=!1;else try{Nn(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Yn(t){t.a||t.j||(t.T=1,Kt(t.Aa,t),t.o=0)}function Qn(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=ve(x(t.Aa,t),nr(t,t.o)),t.o++,!0)}function $n(t){null!=t.s&&(b.clearTimeout(t.s),t.s=null)}function Zn(t){t.a=new Ae(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Ke(t.la);Qe(e,"RID","rpc"),Qe(e,"SID",t.J),Qe(e,"CI",t.H?"0":"1"),Qe(e,"AID",t.P),Wn(t,e),Qe(e,"TYPE","xmlhttp"),t.i&&t.l&&Fn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=$e(Ke(e)),n.j=null,n.I=!0,Oe(n,t)}function tr(t){null!=t.m&&(b.clearTimeout(t.m),t.m=null)}function er(t,e){var n=null;if(t.a==e){tr(t),$n(t),t.a=null;var r=2}else{if(!wn(t.b,e))return;n=e.s,In(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=k()-e.u;var i=t.u;Mt(r=ce(),new de(r,n,e,i)),Kn(t)}else Yn(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(mn(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.g=e.s.concat(t.g),!0):!(1==t.v||2==t.v||t.u>=(t.La?0:t.Ma))&&(t.h=ve(x(t.Ba,t,e),nr(t,t.u)),t.u++,!0))}(t,e)||2==r&&Qn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:rr(t,5);break;case 4:rr(t,10);break;case 3:rr(t,6);break;default:rr(t,2)}}function nr(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function rr(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=x(t.Ya,t);n||(n=new Be("//www.google.com/images/cleardot.gif"),b.location&&"http"==b.location.protocol||Je(n,"https"),$e(n)),function(t,e){var n=new oe;if(b.Image){var r=new Image;r.onload=D(An,n,r,"TestLoadImage: loaded",!0,e),r.onerror=D(An,n,r,"TestLoadImage: error",!1,e),r.onabort=D(An,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=D(An,n,r,"TestLoadImage: timeout",!1,e),b.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else pe(2);t.v=0,t.f&&t.f.ra(e),ir(t),Hn(t)}function ir(t){t.v=0,t.I=-1,t.f&&(0==_n(t.b).length&&0==t.g.length||(t.b.c.length=0,V(t.g),t.g.length=0),t.f.qa())}function or(t,e,n){var r=function(t){return t instanceof Be?Ke(t):new Be(t,void 0)}(n);if(""!=r.c)e&&We(r,e+"."+r.c),Xe(r,r.h);else{var i=b.location;r=function(t,e,n,r){var i=new Be(null,void 0);return t&&Je(i,t),e&&We(i,e),n&&Xe(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&H(t.V,(function(t,e){Qe(r,e,t)})),e=t.A,n=t.na,e&&n&&Qe(r,e,n),Qe(r,"VER",t.ha),Wn(t,r),r}function sr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new xn(t.Na)).F=t.C,e}function ur(){}function ar(){if($&&!(10<=Number(ft)))throw Error("Environmental error: no available transport.")}function cr(t,e){Vt.call(this),this.a=new jn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!M(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!M(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new lr(this)}function hr(t){Ee.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function fr(){Te.call(this),this.status=1}function lr(t){this.a=t}(g=xn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?we(this.H):we(Ie),this.a.onreadystatechange=x(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Pn(this,t)}t=n||"";var i=new je(this.headers);r&&qe(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=Cn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=b.FormData&&t instanceof b.FormData,!(0<=P(On,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Mn(this),0<this.o&&((this.D=function(t){return $&&ct(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=x(this.xa,this)):this.m=$t(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Pn(this,t)}},g.xa=function(){void 0!==w&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Mt(this,"timeout"),this.abort(8))},g.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Mt(this,"complete"),Mt(this,"abort"),Vn(this))},g.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Vn(this,!0)),xn.X.G.call(this)},g.za=function(){this.j||(this.A||this.l||this.g?Rn(this):this.Ua())},g.Ua=function(){Rn(this)},g.W=function(){try{return 2<Un(this)?this.a.status:-1}catch(t){return-1}},g.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},g.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Sn(e)}},g.ua=function(){return this.h},g.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(g=jn.prototype).ha=8,g.v=1,g.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ae(this,this.c,t,void 0),r=this.l;if(this.O&&(r?J(r=B(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Xn(this,n,e),Qe(i=Ke(this.B),"RID",t),Qe(i,"CVER",22),this.A&&Qe(i,"X-HTTP-Session-Id",this.A),Wn(this,i),this.i&&r&&Fn(i,this.i,r),bn(this.b,n),this.Ia&&Qe(i,"TYPE","init"),this.da?(Qe(i,"$req",e),Qe(i,"SID","null"),n.U=!0,ke(n,i,null)):ke(n,i,e),this.v=2}}else 3==this.v&&(t?Jn(this,t):0==this.g.length||gn(this.b)||Jn(this))},g.Aa=function(){if(this.j=null,Zn(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=ve(x(this.Ta,this),t)}},g.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,pe(10),Gn(this),Zn(this))},g.Sa=function(){null!=this.m&&(this.m=null,Gn(this),Qn(this),pe(19))},g.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),pe(2)):(this.c.info("Failed to ping google.com"),pe(1))},(g=ur.prototype).ta=function(){},g.sa=function(){},g.ra=function(){},g.qa=function(){},g.Ja=function(){},ar.prototype.a=function(t,e){return new cr(t,e)},O(cr,Vt),cr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;pe(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=or(t,null,t.fa),Kn(t)},cr.prototype.close=function(){zn(this.a)},cr.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,Bn(this.a,e)}else this.l?((e={}).__data__=Ft(t),Bn(this.a,e)):Bn(this.a,t)},cr.prototype.G=function(){this.a.f=null,delete this.f,zn(this.a),delete this.a,cr.X.G.call(this)},O(hr,Ee),O(fr,Te),O(lr,ur),lr.prototype.ta=function(){Mt(this.a,"a")},lr.prototype.sa=function(t){Mt(this.a,new hr(t))},lr.prototype.ra=function(t){Mt(this.a,new fr(t))},lr.prototype.qa=function(){Mt(this.a,"b")},ar.prototype.createWebChannel=ar.prototype.a,cr.prototype.send=cr.prototype.h,cr.prototype.open=cr.prototype.g,cr.prototype.close=cr.prototype.close,ye.NO_ERROR=0,ye.TIMEOUT=8,ye.HTTP_ERROR=6,ge.COMPLETE="complete",be.EventType=_e,_e.OPEN="a",_e.CLOSE="b",_e.ERROR="c",_e.MESSAGE="d",Vt.prototype.listen=Vt.prototype.va,xn.prototype.listenOnce=xn.prototype.wa,xn.prototype.getLastError=xn.prototype.Qa,xn.prototype.getLastErrorCode=xn.prototype.ua,xn.prototype.getStatus=xn.prototype.W,xn.prototype.getResponseJson=xn.prototype.Pa,xn.prototype.getResponseText=xn.prototype.$,xn.prototype.send=xn.prototype.ba;var pr=ye,dr=ge,vr=ue,yr=10,gr=11,mr=be,wr=xn,br=new l("@firebase/firestore");function Ir(){return br.logLevel}function _r(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(br.logLevel<=f.DEBUG){var r=e.map(Nr);br.debug.apply(br,i(["Firestore (8.2.4): "+t],r))}}function Er(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(br.logLevel<=f.ERROR){var r=e.map(Nr);br.error.apply(br,i(["Firestore (8.2.4): "+t],r))}}function Tr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(br.logLevel<=f.WARN){var r=e.map(Nr);br.warn.apply(br,i(["Firestore (8.2.4): "+t],r))}}function Nr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ar(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.2.4) INTERNAL ASSERTION FAILED: "+t;throw Er(e),new Error(e)}function Sr(t,e){t||Ar()}function xr(t,e){return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kr=function(){function t(){}return t.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Dr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Or(t,e){return t<e?-1:t>e?1:0}function Cr(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Pr(t){return t+"\0"}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lr=function(){function t(t){this.i=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.i,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.i)},t.prototype.o=function(){return 2*this.i.length},t.prototype.u=function(t){return Or(this.i,t.i)},t.prototype.isEqual=function(t){return this.i===t.i},t}();Lr.h=new Lr("");var Rr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Vr=function(e){function n(t,n){var r=this;return(r=e.call(this,n)||this).code=t,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return t(n,e),n}(Error),Mr=function(){function t(t){this.l=t}return t.fromBase64String=function(e){try{return new t(Lr.fromBase64String(e))}catch(e){throw new Vr(Rr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(Lr.fromUint8Array(e))},t.prototype.toBase64=function(){return this.l.toBase64()},t.prototype.toUint8Array=function(){return this.l.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.l.isEqual(t.l)},t}(),Ur=function(t){this._=t};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fr(){if("undefined"==typeof Uint8Array)throw new Vr(Rr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function qr(){if("undefined"==typeof atob)throw new Vr(Rr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var jr=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.fromBase64String=function(t){return qr(),new n(Mr.fromBase64String(t))},n.fromUint8Array=function(t){return Fr(),new n(Mr.fromUint8Array(t))},n.prototype.toBase64=function(){return qr(),this._.toBase64()},n.prototype.toUint8Array=function(){return Fr(),this._.toUint8Array()},n.prototype.isEqual=function(t){return this._.isEqual(t._)},n.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},n}(Ur),zr=function(t,e,n,r,i,o){this.T=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.I=o},Gr=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"m",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Hr=function(){function t(t){this.uid=t}return t.prototype.A=function(){return null!=this.uid},t.prototype.R=function(){return this.A()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Hr.UNAUTHENTICATED=new Hr(null),Hr.P=new Hr("google-credentials-uid"),Hr.g=new Hr("first-party-uid");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Br=function(t,e){this.user=e,this.type="OAuth",this.V={},this.V.Authorization="Bearer "+t},Kr=function(){function t(){this.p=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.v=function(){},t.prototype.S=function(t){this.p=t,t(Hr.UNAUTHENTICATED)},t.prototype.D=function(){this.p=null},t}(),Jr=function(){function t(t){var e=this;this.C=null,this.currentUser=Hr.UNAUTHENTICATED,this.N=!1,this.F=0,this.p=null,this.forceRefresh=!1,this.C=function(){e.F++,e.currentUser=e.O(),e.N=!0,e.p&&e.p(e.currentUser)},this.F=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.C):(this.C(null),t.get().then((function(t){e.auth=t,e.C&&e.auth.addAuthTokenListener(e.C)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.F,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.F!==e?(_r("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Sr("string"==typeof n.accessToken),new Br(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.v=function(){this.forceRefresh=!0},t.prototype.S=function(t){this.p=t,this.N&&t(this.currentUser)},t.prototype.D=function(){this.auth&&this.auth.removeAuthTokenListener(this.C),this.C=null,this.p=null},t.prototype.O=function(){var t=this.auth&&this.auth.getUid();return Sr(null===t||"string"==typeof t),new Hr(t)},t}(),Wr=function(){function t(t,e){this.k=t,this.M=e,this.type="FirstParty",this.user=Hr.g}return Object.defineProperty(t.prototype,"V",{get:function(){var t={"X-Goog-AuthUser":this.M},e=this.k.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),Xr=function(){function t(t,e){this.k=t,this.M=e}return t.prototype.getToken=function(){return Promise.resolve(new Wr(this.k,this.M))},t.prototype.S=function(t){t(Hr.g)},t.prototype.D=function(){},t.prototype.v=function(){},t}(),Yr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.L=function(t){return n.$(t)},this.B=function(t){return e.q(t)})}return t.prototype.$=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.B&&this.B(t),t},t}();Yr.U=-1;var Qr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Vr(Rr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Vr(Rr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Vr(Rr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Vr(Rr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.K=function(t){return this.seconds===t.seconds?Or(this.nanoseconds,t.nanoseconds):Or(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),$r=function(){function t(t){this.timestamp=t}return t.W=function(e){return new t(e)},t.min=function(){return new t(new Qr(0,0))},t.prototype.u=function(t){return this.timestamp.K(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.j=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.G=function(){return this.timestamp},t}(),Zr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Ar(),void 0===n?n=t.length-e:n>t.length-e&&Ar(),this.segments=t,this.offset=e,this.H=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.H},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.J(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.Y(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.X=function(t){return t=void 0===t?1:t,this.Y(this.segments,this.offset+t,this.length-t)},t.prototype.Z=function(){return this.Y(this.segments,this.offset,this.length-1)},t.prototype.tt=function(){return this.segments[this.offset]},t.prototype.et=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.nt=function(){return 0===this.length},t.prototype.st=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.it=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.rt=function(){return this.segments.slice(this.offset,this.limit())},t.J=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),ti=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.Y=function(t,e,r){return new n(t,e,r)},n.prototype.ot=function(){return this.rt().join("/")},n.prototype.toString=function(){return this.ot()},n.ct=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Vr(Rr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new n(r)},n.at=function(){return new n([])},n}(Zr),ei=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ni=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.Y=function(t,e,r){return new n(t,e,r)},n.ut=function(t){return ei.test(t)},n.prototype.ot=function(){return this.rt().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.ut(t)||(t="`"+t+"`"),t})).join(".")},n.prototype.toString=function(){return this.ot()},n.prototype.ht=function(){return 1===this.length&&"__name__"===this.get(0)},n.lt=function(){return new n(["__name__"])},n._t=function(t){for(var e=[],r="",i=0,o=function(){if(0===r.length)throw new Vr(Rr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(r),r=""},s=!1;i<t.length;){var u=t[i];if("\\"===u){if(i+1===t.length)throw new Vr(Rr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[i+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new Vr(Rr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=a,i+=2}else"`"===u?(s=!s,i++):"."!==u||s?(r+=u,i++):(o(),i++)}if(o(),s)throw new Vr(Rr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)},n.at=function(){return new n([])},n}(Zr),ri=function(){function t(t){this.path=t}return t.ft=function(e){return new t(ti.ct(e))},t.dt=function(e){return new t(ti.ct(e).X(5))},t.prototype.wt=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===ti.J(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.J=function(t,e){return ti.J(t.path,e.path)},t.Et=function(t){return t.length%2==0},t.Tt=function(e){return new t(new ti(e.slice()))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ii(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function oi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function si(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ui=function(){function t(t){this.fields=t,t.sort(ni.J)}return t.prototype.It=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].st(t))return!0;return!1},t.prototype.isEqual=function(t){return Cr(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),ai=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ci(t){if(Sr(!!t),"string"==typeof t){var e=0,n=ai.exec(t);if(Sr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:hi(t.seconds),nanos:hi(t.nanos)}}function hi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function fi(t){return"string"==typeof t?Lr.fromBase64String(t):Lr.fromUint8Array(t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function li(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function pi(t){var e=ci(t.mapValue.fields.__local_write_time__.timestampValue);return new Qr(e.seconds,e.nanos)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function di(t){return null==t}function vi(t){return 0===t&&1/t==-1/0}function yi(t){return"number"==typeof t&&Number.isInteger(t)&&!vi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?li(t)?4:10:Ar()}function mi(t,e){var n=gi(t);if(n!==gi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return pi(t).isEqual(pi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=ci(t.timestampValue),r=ci(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return fi(t.bytesValue).isEqual(fi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return hi(t.geoPointValue.latitude)===hi(e.geoPointValue.latitude)&&hi(t.geoPointValue.longitude)===hi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return hi(t.integerValue)===hi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=hi(t.doubleValue),r=hi(e.doubleValue);return n===r?vi(n)===vi(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Cr(t.arrayValue.values||[],e.arrayValue.values||[],mi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ii(n)!==ii(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!mi(n[i],r[i])))return!1;return!0}(t,e);default:return Ar()}}function wi(t,e){return void 0!==(t.values||[]).find((function(t){return mi(t,e)}))}function bi(t,e){var n=gi(t),r=gi(e);if(n!==r)return Or(n,r);switch(n){case 0:return 0;case 1:return Or(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=hi(t.integerValue||t.doubleValue),r=hi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Ii(t.timestampValue,e.timestampValue);case 4:return Ii(pi(t),pi(e));case 5:return Or(t.stringValue,e.stringValue);case 6:return function(t,e){var n=fi(t),r=fi(e);return n.u(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Or(n[i],r[i]);if(0!==o)return o}return Or(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Or(hi(t.latitude),hi(e.latitude));return 0!==n?n:Or(hi(t.longitude),hi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=bi(n[i],r[i]);if(o)return o}return Or(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Or(r[s],o[s]);if(0!==u)return u;var a=bi(n[r[s]],i[o[s]]);if(0!==a)return a}return Or(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Ar()}}function Ii(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Or(t,e);var n=ci(t),r=ci(e),i=Or(n.seconds,r.seconds);return 0!==i?i:Or(n.nanos,r.nanos)}function _i(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=ci(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?fi(e.bytesValue).toBase64():"referenceValue"in e?(r=e.referenceValue,ri.dt(r).toString()):"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++)r?r=!1:n+=",",n+=t(o[i]);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):Ar();var n,r}(t)}function Ei(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.ot()}}function Ti(t){return!!t&&"integerValue"in t}function Ni(t){return!!t&&"arrayValue"in t}function Ai(t){return!!t&&"nullValue"in t}function Si(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function xi(t){return!!t&&"mapValue"in t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Di=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.nt())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!xi(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.et()])||null},t.prototype.isEqual=function(t){return mi(this.proto,t.proto)},t}(),ki=function(){function t(t){void 0===t&&(t=Di.empty()),this.At=t,this.Rt=new Map}return t.prototype.set=function(t,e){return this.Pt(t,e),this},t.prototype.delete=function(t){return this.Pt(t,null),this},t.prototype.Pt=function(t,e){for(var n=this.Rt,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===gi(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.et(),e)},t.prototype.yt=function(){var t=this.gt(ni.at(),this.Rt);return null!=t?new Di(t):this.At},t.prototype.gt=function(t,e){var n=this,r=!1,i=this.At.field(t),o=xi(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var s=n.gt(t.child(i),e);null!=s&&(o[i]=s,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}();function Oi(t){var e=[];return oi(t.fields||{},(function(t,n){var r=new ni([t]);if(xi(n)){var i=Oi(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var u=s[o];e.push(r.child(u))}}else e.push(r)})),new ui(e)
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var Ci=function(t,e){this.key=t,this.version=e},Pi=function(e){function n(t,n,r,i){var o=this;return(o=e.call(this,t,n)||this).Vt=r,o.bt=!!i.bt,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return t(n,e),n.prototype.field=function(t){return this.Vt.field(t)},n.prototype.data=function(){return this.Vt},n.prototype.vt=function(){return this.Vt.proto},n.prototype.isEqual=function(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.bt===t.bt&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Vt.isEqual(t.Vt)},n.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Vt.toString()+", {hasLocalMutations: "+this.bt+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return this.bt||this.hasCommittedMutations},enumerable:!1,configurable:!0}),n}(Ci),Li=function(e){function n(t,n,r){var i=this;return(i=e.call(this,t,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return t(n,e),n.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return t instanceof n&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},n}(Ci),Ri=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return t instanceof n&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},n}(Ci),Vi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.St=null};function Mi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Vi(t,e,n,r,i,o,s)}function Ui(t){var e=xr(t);if(null===e.St){var n=e.path.ot();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.ot()+t.op.toString()+_i(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.ot()+t.dir}(t)})).join(","),di(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Qi(e.startAt)),e.endAt&&(n+="|ub:",n+=Qi(e.endAt)),e.St=n}return e.St}function Fi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Zi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!mi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!eo(t.startAt,e.startAt)&&eo(t.endAt,e.endAt)}function qi(t){return ri.Et(t.path)&&null===t.collectionGroup&&0===t.filters.length}var ji=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).field=t,i.op=n,i.value=r,i}return t(n,e),n.create=function(t,e,r){return t.ht()?"in"===e||"not-in"===e?this.Dt(t,e,r):new zi(t,e,r):"array-contains"===e?new Ki(t,r):"in"===e?new Ji(t,r):"not-in"===e?new Wi(t,r):"array-contains-any"===e?new Xi(t,r):new n(t,e,r)},n.Dt=function(t,e,n){return"in"===e?new Gi(t,n):new Hi(t,n)},n.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.Ct(bi(e,this.value)):null!==e&&gi(this.value)===gi(e)&&this.Ct(bi(e,this.value))},n.prototype.Ct=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Ar()}},n.prototype.xt=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},n}((function(){})),zi=function(e){function n(t,n,r){var i=this;return(i=e.call(this,t,n,r)||this).key=ri.dt(r.referenceValue),i}return t(n,e),n.prototype.matches=function(t){var e=ri.J(t.key,this.key);return this.Ct(e)},n}(ji),Gi=function(e){function n(t,n){var r=this;return(r=e.call(this,t,"in",n)||this).keys=Bi("in",n),r}return t(n,e),n.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},n}(ji),Hi=function(e){function n(t,n){var r=this;return(r=e.call(this,t,"not-in",n)||this).keys=Bi("not-in",n),r}return t(n,e),n.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},n}(ji);function Bi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return ri.dt(t.referenceValue)}))}var Ki=function(e){function n(t,n){return e.call(this,t,"array-contains",n)||this}return t(n,e),n.prototype.matches=function(t){var e=t.field(this.field);return Ni(e)&&wi(e.arrayValue,this.value)},n}(ji),Ji=function(e){function n(t,n){return e.call(this,t,"in",n)||this}return t(n,e),n.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&wi(this.value.arrayValue,e)},n}(ji),Wi=function(e){function n(t,n){return e.call(this,t,"not-in",n)||this}return t(n,e),n.prototype.matches=function(t){if(wi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.field(this.field);return null!==e&&!wi(this.value.arrayValue,e)},n}(ji),Xi=function(e){function n(t,n){return e.call(this,t,"array-contains-any",n)||this}return t(n,e),n.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!Ni(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return wi(e.value.arrayValue,t)}))},n}(ji),Yi=function(t,e){this.position=t,this.before=e};function Qi(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return _i(t)})).join(",")}var $i=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Zi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function to(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.ht()?ri.J(ri.dt(s.referenceValue),n.key):bi(s,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function eo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!mi(t.position[n],e.position[n]))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var no=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.Nt=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=u,this.Ft=null,this.Ot=null,this.startAt,this.endAt};function ro(t,e,n,r,i,o,s,u){return new no(t,e,n,r,i,o,s,u)}function io(t){return new no(t)}function oo(t){return!di(t.limit)&&"F"===t.limitType}function so(t){return!di(t.limit)&&"L"===t.limitType}function uo(t){return t.Nt.length>0?t.Nt[0].field:null}function ao(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.xt())return r.field}return null}function co(t){return null!==t.collectionGroup}function ho(t){var e=xr(t);if(null===e.Ft){e.Ft=[];var n=ao(e),r=uo(e);if(null!==n&&null===r)n.ht()||e.Ft.push(new $i(n)),e.Ft.push(new $i(ni.lt(),"asc"));else{for(var i=!1,o=0,s=e.Nt;o<s.length;o++){var u=s[o];e.Ft.push(u),u.field.ht()&&(i=!0)}if(!i){var a=e.Nt.length>0?e.Nt[e.Nt.length-1].dir:"asc";e.Ft.push(new $i(ni.lt(),a))}}}return e.Ft}function fo(t){var e=xr(t);if(!e.Ot)if("F"===e.limitType)e.Ot=Mi(e.path,e.collectionGroup,ho(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=ho(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new $i(o.field,s))}var u=e.endAt?new Yi(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Yi(e.startAt.position,!e.startAt.before):null;e.Ot=Mi(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.Ot}function lo(t,e,n){return new no(t.path,t.collectionGroup,t.Nt.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function po(t,e){return Fi(fo(t),fo(e))&&t.limitType===e.limitType}function vo(t){return Ui(fo(t))+"|lt:"+t.limitType}function yo(t){return"Query(target="+function(t){var e=t.path.ot();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.ot()+" "+e.op+" "+_i(e.value);var e})).join(", ")+"]"),di(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.ot()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Qi(t.startAt)),t.endAt&&(e+=", endAt: "+Qi(t.endAt)),"Target("+e+")"}(fo(t))+"; limitType="+t.limitType+")"}function go(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.wt(t.collectionGroup)&&t.path.st(n):ri.Et(t.path)?t.path.isEqual(n):t.path.it(n)}(t,e)&&function(t,e){for(var n=0,r=t.Nt;n<r.length;n++){var i=r[n];if(!i.field.ht()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!to(t.startAt,ho(t),e)||t.endAt&&to(t.endAt,ho(t),e))}(t,e)}function mo(t){return function(e,n){for(var r=!1,i=0,o=ho(t);i<o.length;i++){var s=o[i],u=wo(s,e,n);if(0!==u)return u;r=r||s.field.ht()}return 0}}function wo(t,e,n){var r=t.field.ht()?ri.J(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?bi(r,i):Ar()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ar()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bo=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=$r.min()),void 0===o&&(o=$r.min()),void 0===s&&(s=Lr.h),this.target=t,this.targetId=e,this.kt=n,this.sequenceNumber=r,this.Mt=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.Lt=function(e){return new t(this.target,this.targetId,this.kt,e,this.Mt,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.$t=function(e,n){return new t(this.target,this.targetId,this.kt,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.Bt=function(e){return new t(this.target,this.targetId,this.kt,this.sequenceNumber,this.Mt,e,this.resumeToken)},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Io(t,e){if(t.qt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vi(e)?"-0":e}}function _o(t){return{integerValue:""+t}}function Eo(t,e){return yi(e)?_o(e):Io(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var To=function(){this.Ut=void 0};function No(t,e,n){return t instanceof xo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Do?ko(t,e):t instanceof Oo?Co(t,e):function(t,e){var n=So(t,e),r=Lo(n)+Lo(t.Qt);return Ti(n)&&Ti(t.Qt)?_o(r):Io(t.Kt,r)}(t,e)}function Ao(t,e,n){return t instanceof Do?ko(t,e):t instanceof Oo?Co(t,e):n}function So(t,e){return t instanceof Po?Ti(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var xo=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(To),Do=function(e){function n(t){var n=this;return(n=e.call(this)||this).elements=t,n}return t(n,e),n}(To);function ko(t,e){for(var n=Ro(e),r=function(t){n.some((function(e){return mi(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Oo=function(e){function n(t){var n=this;return(n=e.call(this)||this).elements=t,n}return t(n,e),n}(To);function Co(t,e){for(var n=Ro(e),r=function(t){n=n.filter((function(e){return!mi(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Po=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).Kt=t,r.Qt=n,r}return t(n,e),n}(To);function Lo(t){return hi(t.integerValue||t.doubleValue)}function Ro(t){return Ni(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vo=function(t,e){this.field=t,this.transform=e},Mo=function(t,e){this.version=t,this.transformResults=e},Uo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.Wt=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"jt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Fo(t,e){return void 0!==t.updateTime?e instanceof Pi&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof Pi}var qo=function(){};function jo(t,e,n){return t instanceof Ko?function(t,e,n){var r=t.value;if(n.transformResults){var i=Xo(t.fieldTransforms,e,n.transformResults);r=Qo(t.fieldTransforms,r,i)}return new Pi(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof Jo?function(t,e,n){if(!Fo(t.Gt,e))return new Ri(t.key,n.version);var r=Wo(t,e,n.transformResults?Xo(t.fieldTransforms,e,n.transformResults):[]);return new Pi(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new Li(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function zo(t,e,n,r){return t instanceof Ko?function(t,e,n,r){if(!Fo(t.Gt,e))return e;var i=t.value,o=Yo(t.fieldTransforms,n,e);i=Qo(t.fieldTransforms,i,o);var s=Bo(e);return new Pi(t.key,s,i,{bt:!0})}(t,e,r):t instanceof Jo?function(t,e,n,r){if(!Fo(t.Gt,e))return e;var i=Bo(e),o=Wo(t,e,Yo(t.fieldTransforms,n,e));return new Pi(t.key,i,o,{bt:!0})}(t,e,r):function(t,e){return Fo(t.Gt,e)?new Li(t.key,$r.min()):e}(t,e)}function Go(t,e){return function(t,e){for(var n=null,r=0,i=t;r<i.length;r++){var o=i[r],s=e instanceof Pi?e.field(o.field):void 0,u=So(o.transform,s||null);null!=u&&(n=null==n?(new ki).set(o.field,u):n.set(o.field,u))}return n?n.yt():null}(t.fieldTransforms,e)}function Ho(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Gt.isEqual(e.Gt)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Cr(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Do&&e instanceof Do||t instanceof Oo&&e instanceof Oo?Cr(t.elements,e.elements,mi):t instanceof Po&&e instanceof Po?mi(t.Qt,e.Qt):t instanceof xo&&e instanceof xo}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.zt.isEqual(e.zt))}function Bo(t){return t instanceof Pi?t.version:$r.min()}var Ko=function(e){function n(t,n,r,i){void 0===i&&(i=[]);var o=this;return(o=e.call(this)||this).key=t,o.value=n,o.Gt=r,o.fieldTransforms=i,o.type=0,o}return t(n,e),n}(qo),Jo=function(e){function n(t,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=e.call(this)||this).key=t,s.data=n,s.zt=r,s.Gt=i,s.fieldTransforms=o,s.type=1,s}return t(n,e),n}(qo);function Wo(t,e,n){var r;return r=function(t,e){var n=new ki(e);return t.zt.fields.forEach((function(e){if(!e.nt()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}})),n.yt()}(t,r=e instanceof Pi?e.data():Di.empty()),Qo(t.fieldTransforms,r,n)}function Xo(t,e,n){var r=[];Sr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof Pi&&(u=e.field(o.field)),r.push(Ao(s,u,n[i]))}return r}function Yo(t,e,n,r){for(var i=[],o=0,s=t;o<s.length;o++){var u=s[o],a=u.transform,c=null;n instanceof Pi&&(c=n.field(u.field)),i.push(No(a,c,e))}return i}function Qo(t,e,n){for(var r=new ki(e),i=0;i<t.length;i++){var o=t[i];r.set(o.field,n[i])}return r.yt()}var $o,Zo,ts=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).key=t,r.Gt=n,r.type=2,r.fieldTransforms=[],r}return t(n,e),n}(qo),es=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).key=t,r.Gt=n,r.type=3,r.fieldTransforms=[],r}return t(n,e),n}(qo),ns=function(t){this.count=t};function rs(t){switch(t){case Rr.OK:return Ar();case Rr.CANCELLED:case Rr.UNKNOWN:case Rr.DEADLINE_EXCEEDED:case Rr.RESOURCE_EXHAUSTED:case Rr.INTERNAL:case Rr.UNAVAILABLE:case Rr.UNAUTHENTICATED:return!1;case Rr.INVALID_ARGUMENT:case Rr.NOT_FOUND:case Rr.ALREADY_EXISTS:case Rr.PERMISSION_DENIED:case Rr.FAILED_PRECONDITION:case Rr.ABORTED:case Rr.OUT_OF_RANGE:case Rr.UNIMPLEMENTED:case Rr.DATA_LOSS:return!0;default:return Ar()}}function is(t){if(void 0===t)return Er("GRPC error has no .code"),Rr.UNKNOWN;switch(t){case $o.OK:return Rr.OK;case $o.CANCELLED:return Rr.CANCELLED;case $o.UNKNOWN:return Rr.UNKNOWN;case $o.DEADLINE_EXCEEDED:return Rr.DEADLINE_EXCEEDED;case $o.RESOURCE_EXHAUSTED:return Rr.RESOURCE_EXHAUSTED;case $o.INTERNAL:return Rr.INTERNAL;case $o.UNAVAILABLE:return Rr.UNAVAILABLE;case $o.UNAUTHENTICATED:return Rr.UNAUTHENTICATED;case $o.INVALID_ARGUMENT:return Rr.INVALID_ARGUMENT;case $o.NOT_FOUND:return Rr.NOT_FOUND;case $o.ALREADY_EXISTS:return Rr.ALREADY_EXISTS;case $o.PERMISSION_DENIED:return Rr.PERMISSION_DENIED;case $o.FAILED_PRECONDITION:return Rr.FAILED_PRECONDITION;case $o.ABORTED:return Rr.ABORTED;case $o.OUT_OF_RANGE:return Rr.OUT_OF_RANGE;case $o.UNIMPLEMENTED:return Rr.UNIMPLEMENTED;case $o.DATA_LOSS:return Rr.DATA_LOSS;default:return Ar()}}(Zo=$o||($o={}))[Zo.OK=0]="OK",Zo[Zo.CANCELLED=1]="CANCELLED",Zo[Zo.UNKNOWN=2]="UNKNOWN",Zo[Zo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Zo[Zo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Zo[Zo.NOT_FOUND=5]="NOT_FOUND",Zo[Zo.ALREADY_EXISTS=6]="ALREADY_EXISTS",Zo[Zo.PERMISSION_DENIED=7]="PERMISSION_DENIED",Zo[Zo.UNAUTHENTICATED=16]="UNAUTHENTICATED",Zo[Zo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Zo[Zo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Zo[Zo.ABORTED=10]="ABORTED",Zo[Zo.OUT_OF_RANGE=11]="OUT_OF_RANGE",Zo[Zo.UNIMPLEMENTED=12]="UNIMPLEMENTED",Zo[Zo.INTERNAL=13]="INTERNAL",Zo[Zo.UNAVAILABLE=14]="UNAVAILABLE",Zo[Zo.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var os=function(){function t(t,e){this.J=t,this.root=e||us.EMPTY}return t.prototype.Ht=function(e,n){return new t(this.J,this.root.Ht(e,n,this.J).copy(null,null,us.Jt,null,null))},t.prototype.remove=function(e){return new t(this.J,this.root.remove(e,this.J).copy(null,null,us.Jt,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.nt();){var n=this.J(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.nt();){var r=this.J(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.nt=function(){return this.root.nt()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.Yt=function(){return this.root.Yt()},t.prototype.Xt=function(){return this.root.Xt()},t.prototype.Zt=function(t){return this.root.Zt(t)},t.prototype.forEach=function(t){this.Zt((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.Zt((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.te=function(t){return this.root.te(t)},t.prototype.ee=function(){return new ss(this.root,null,this.J,!1)},t.prototype.ne=function(t){return new ss(this.root,t,this.J,!1)},t.prototype.se=function(){return new ss(this.root,null,this.J,!0)},t.prototype.ie=function(t){return new ss(this.root,t,this.J,!0)},t}(),ss=function(){function t(t,e,n,r){this.re=r,this.oe=[];for(var i=1;!t.nt();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.re?t.left:t.right;else{if(0===i){this.oe.push(t);break}this.oe.push(t),t=this.re?t.right:t.left}}return t.prototype.ce=function(){var t=this.oe.pop(),e={key:t.key,value:t.value};if(this.re)for(t=t.left;!t.nt();)this.oe.push(t),t=t.right;else for(t=t.right;!t.nt();)this.oe.push(t),t=t.left;return e},t.prototype.ae=function(){return this.oe.length>0},t.prototype.ue=function(){if(0===this.oe.length)return null;var t=this.oe[this.oe.length-1];return{key:t.key,value:t.value}},t}(),us=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.nt=function(){return!1},t.prototype.Zt=function(t){return this.left.Zt(t)||t(this.key,this.value)||this.right.Zt(t)},t.prototype.te=function(t){return this.right.te(t)||t(this.key,this.value)||this.left.te(t)},t.prototype.min=function(){return this.left.nt()?this:this.left.min()},t.prototype.Yt=function(){return this.min().key},t.prototype.Xt=function(){return this.right.nt()?this.key:this.right.Xt()},t.prototype.Ht=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.Ht(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.Ht(t,e,n))).he()},t.prototype.le=function(){if(this.left.nt())return t.EMPTY;var e=this;return e.left._e()||e.left.left._e()||(e=e.fe()),(e=e.copy(null,null,null,e.left.le(),null)).he()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.nt()||i.left._e()||i.left.left._e()||(i=i.fe()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left._e()&&(i=i.de()),i.right.nt()||i.right._e()||i.right.left._e()||(i=i.we()),0===n(e,i.key)){if(i.right.nt())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.le())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.he()},t.prototype._e=function(){return this.color},t.prototype.he=function(){var t=this;return t.right._e()&&!t.left._e()&&(t=t.Ee()),t.left._e()&&t.left.left._e()&&(t=t.de()),t.left._e()&&t.right._e()&&(t=t.Te()),t},t.prototype.fe=function(){var t=this.Te();return t.right.left._e()&&(t=(t=(t=t.copy(null,null,null,null,t.right.de())).Ee()).Te()),t},t.prototype.we=function(){var t=this.Te();return t.left.left._e()&&(t=(t=t.de()).Te()),t},t.prototype.Ee=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.de=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.Te=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.Ie=function(){var t=this.me();return Math.pow(2,t)<=this.size+1},t.prototype.me=function(){if(this._e()&&this.left._e())throw Ar();if(this.right._e())throw Ar();var t=this.left.me();if(t!==this.right.me())throw Ar();return t+(this._e()?0:1)},t}();us.EMPTY=null,us.RED=!0,us.Jt=!1,us.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Ar()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Ar()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Ar()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Ar()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Ar()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.Ht=function(t,e,n){return new us(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.nt=function(){return!0},t.prototype.Zt=function(t){return!1},t.prototype.te=function(t){return!1},t.prototype.Yt=function(){return null},t.prototype.Xt=function(){return null},t.prototype._e=function(){return!1},t.prototype.Ie=function(){return!0},t.prototype.me=function(){return 0},t}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var as=function(){function t(t){this.J=t,this.data=new os(this.J)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.Yt()},t.prototype.last=function(){return this.data.Xt()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.Zt((function(e,n){return t(e),!1}))},t.prototype.Ae=function(t,e){for(var n=this.data.ne(t[0]);n.ae();){var r=n.ce();if(this.J(r.key,t[1])>=0)return;e(r.key)}},t.prototype.Re=function(t,e){var n;for(n=void 0!==e?this.data.ne(e):this.data.ee();n.ae();)if(!t(n.ce().key))return},t.prototype.Pe=function(t){var e=this.data.ne(t);return e.ae()?e.ce().key:null},t.prototype.ee=function(){return new cs(this.data.ee())},t.prototype.ne=function(t){return new cs(this.data.ne(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).Ht(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.nt=function(){return this.data.nt()},t.prototype.ye=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.ee(),r=e.data.ee();n.ae();){var i=n.ce().key,o=r.ce().key;if(0!==this.J(i,o))return!1}return!0},t.prototype.rt=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.J);return n.data=e,n},t}(),cs=function(){function t(t){this.ge=t}return t.prototype.ce=function(){return this.ge.ce().key},t.prototype.ae=function(){return this.ge.ae()},t}(),hs=new os(ri.J);function fs(){return hs}function ls(){return fs()}var ps=new os(ri.J);function ds(){return ps}var vs=new os(ri.J);var ys=new as(ri.J);function gs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ys,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var ms=new as(Or);function ws(){return ms}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bs=function(){function t(t){this.J=t?function(e,n){return t(e,n)||ri.J(e.key,n.key)}:function(t,e){return ri.J(t.key,e.key)},this.Ve=ds(),this.pe=new os(this.J)}return t.be=function(e){return new t(e.J)},t.prototype.has=function(t){return null!=this.Ve.get(t)},t.prototype.get=function(t){return this.Ve.get(t)},t.prototype.first=function(){return this.pe.Yt()},t.prototype.last=function(){return this.pe.Xt()},t.prototype.nt=function(){return this.pe.nt()},t.prototype.indexOf=function(t){var e=this.Ve.get(t);return e?this.pe.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.pe.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.pe.Zt((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Ve.Ht(t.key,t),e.pe.Ht(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Ve.remove(t),this.pe.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.pe.ee(),r=e.pe.ee();n.ae();){var i=n.ce().key,o=r.ce().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.J=this.J,r.Ve=e,r.pe=n,r},t}(),Is=function(){function t(){this.ve=new os(ri.J)}return t.prototype.track=function(t){var e=t.doc.key,n=this.ve.get(e);n?0!==t.type&&3===n.type?this.ve=this.ve.Ht(e,t):3===t.type&&1!==n.type?this.ve=this.ve.Ht(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ve=this.ve.Ht(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ve=this.ve.Ht(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ve=this.ve.remove(e):1===t.type&&2===n.type?this.ve=this.ve.Ht(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ve=this.ve.Ht(e,{type:2,doc:t.doc}):Ar():this.ve=this.ve.Ht(e,t)},t.prototype.Se=function(){var t=[];return this.ve.Zt((function(e,n){t.push(n)})),t},t}(),_s=function(){function t(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.De=n,this.docChanges=r,this.Ce=i,this.fromCache=o,this.xe=s,this.Ne=u}return t.Fe=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,bs.be(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.Ce.nt()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.xe===t.xe&&this.Ce.isEqual(t.Ce)&&po(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.De.isEqual(t.De)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Es=function(){function t(t,e,n,r,i){this.Mt=t,this.Oe=e,this.ke=n,this.Me=r,this.Le=i}return t.$e=function(e,n){var r=new Map;return r.set(e,Ts.Be(e,n)),new t($r.min(),r,ws(),fs(),gs())},t}(),Ts=function(){function t(t,e,n,r,i){this.resumeToken=t,this.qe=e,this.Ue=n,this.Qe=r,this.Ke=i}return t.Be=function(e,n){return new t(Lr.h,n,gs(),gs(),gs())},t}(),Ns=function(t,e,n,r){this.We=t,this.removedTargetIds=e,this.key=n,this.je=r},As=function(t,e){this.targetId=t,this.Ge=e},Ss=function(t,e,n,r){void 0===n&&(n=Lr.h),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},xs=function(){function t(){this.ze=0,this.He=Os(),this.Je=Lr.h,this.Ye=!1,this.Xe=!0}return Object.defineProperty(t.prototype,"qe",{get:function(){return this.Ye},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.Je},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Ze",{get:function(){return 0!==this.ze},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tn",{get:function(){return this.Xe},enumerable:!1,configurable:!0}),t.prototype.en=function(t){t.o()>0&&(this.Xe=!0,this.Je=t)},t.prototype.nn=function(){var t=gs(),e=gs(),n=gs();return this.He.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Ar()}})),new Ts(this.Je,this.Ye,t,e,n)},t.prototype.sn=function(){this.Xe=!1,this.He=Os()},t.prototype.rn=function(t,e){this.Xe=!0,this.He=this.He.Ht(t,e)},t.prototype.on=function(t){this.Xe=!0,this.He=this.He.remove(t)},t.prototype.cn=function(){this.ze+=1},t.prototype.an=function(){this.ze-=1},t.prototype.un=function(){this.Xe=!0,this.Ye=!0},t}(),Ds=function(){function t(t){this.hn=t,this.ln=new Map,this._n=fs(),this.fn=ks(),this.dn=new as(Or)}return t.prototype.wn=function(t){for(var e=0,n=t.We;e<n.length;e++){var r=n[e];t.je instanceof Pi?this.En(r,t.je):t.je instanceof Li&&this.Tn(r,t.key,t.je)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.Tn(r,t.key,t.je)},t.prototype.In=function(t){var e=this;this.mn(t,(function(n){var r=e.An(n);switch(t.state){case 0:e.Rn(n)&&r.en(t.resumeToken);break;case 1:r.an(),r.Ze||r.sn(),r.en(t.resumeToken);break;case 2:r.an(),r.Ze||e.removeTarget(n);break;case 3:e.Rn(n)&&(r.un(),r.en(t.resumeToken));break;case 4:e.Rn(n)&&(e.Pn(n),r.en(t.resumeToken));break;default:Ar()}}))},t.prototype.mn=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.ln.forEach((function(t,r){n.Rn(r)&&e(r)}))},t.prototype.yn=function(t){var e=t.targetId,n=t.Ge.count,r=this.gn(e);if(r){var i=r.target;if(qi(i))if(0===n){var o=new ri(i.path);this.Tn(e,o,new Li(o,$r.min()))}else Sr(1===n);else this.Vn(e)!==n&&(this.Pn(e),this.dn=this.dn.add(e))}},t.prototype.pn=function(t){var e=this,n=new Map;this.ln.forEach((function(r,i){var o=e.gn(i);if(o){if(r.qe&&qi(o.target)){var s=new ri(o.target.path);null!==e._n.get(s)||e.bn(i,s)||e.Tn(i,s,new Li(s,t))}r.tn&&(n.set(i,r.nn()),r.sn())}}));var r=gs();this.fn.forEach((function(t,n){var i=!0;n.Re((function(t){var n=e.gn(t);return!n||2===n.kt||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new Es(t,n,this.dn,this._n,r);return this._n=fs(),this.fn=ks(),this.dn=new as(Or),i},t.prototype.En=function(t,e){if(this.Rn(t)){var n=this.bn(t,e.key)?2:0;this.An(t).rn(e.key,n),this._n=this._n.Ht(e.key,e),this.fn=this.fn.Ht(e.key,this.vn(e.key).add(t))}},t.prototype.Tn=function(t,e,n){if(this.Rn(t)){var r=this.An(t);this.bn(t,e)?r.rn(e,1):r.on(e),this.fn=this.fn.Ht(e,this.vn(e).delete(t)),n&&(this._n=this._n.Ht(e,n))}},t.prototype.removeTarget=function(t){this.ln.delete(t)},t.prototype.Vn=function(t){var e=this.An(t).nn();return this.hn.Sn(t).size+e.Ue.size-e.Ke.size},t.prototype.cn=function(t){this.An(t).cn()},t.prototype.An=function(t){var e=this.ln.get(t);return e||(e=new xs,this.ln.set(t,e)),e},t.prototype.vn=function(t){var e=this.fn.get(t);return e||(e=new as(Or),this.fn=this.fn.Ht(t,e)),e},t.prototype.Rn=function(t){var e=null!==this.gn(t);return e||_r("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.gn=function(t){var e=this.ln.get(t);return e&&e.Ze?null:this.hn.Dn(t)},t.prototype.Pn=function(t){var e=this;this.ln.set(t,new xs),this.hn.Sn(t).forEach((function(n){e.Tn(t,n,null)}))},t.prototype.bn=function(t,e){return this.hn.Sn(t).has(e)},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ks(){return new os(ri.J)}function Os(){return new os(ri.J)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Cs={asc:"ASCENDING",desc:"DESCENDING"},Ps={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ls=function(t,e){this.T=t,this.qt=e};function Rs(t,e){return t.qt?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Vs(t,e){return t.qt?e.toBase64():e.toUint8Array()}function Ms(t,e){return Rs(t,e.G())}function Us(t){return Sr(!!t),$r.W(function(t){var e=ci(t);return new Qr(e.seconds,e.nanos)}(t))}function Fs(t,e){return function(t){return new ti(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).ot()}function qs(t){var e=ti.ct(t);return Sr(au(e)),e}function js(t,e){return Fs(t.T,e.path)}function zs(t,e){var n=qs(e);if(n.get(1)!==t.T.projectId)throw new Vr(Rr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.T.projectId);if(n.get(3)!==t.T.database)throw new Vr(Rr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.T.database);return new ri(Ks(n))}function Gs(t,e){return Fs(t.T,e)}function Hs(t){var e=qs(t);return 4===e.length?ti.at():Ks(e)}function Bs(t){return new ti(["projects",t.T.projectId,"databases",t.T.database]).ot()}function Ks(t){return Sr(t.length>4&&"documents"===t.get(4)),t.X(5)}function Js(t,e,n){return{name:js(t,e),fields:n.proto.mapValue.fields}}function Ws(t,e){var n;if(e instanceof Ko)n={update:Js(t,e.key,e.value)};else if(e instanceof ts)n={delete:js(t,e.key)};else if(e instanceof Jo)n={update:Js(t,e.key,e.data),updateMask:uu(e.zt)};else{if(!(e instanceof es))return Ar();n={verify:js(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof xo)return{fieldPath:e.field.ot(),setToServerValue:"REQUEST_TIME"};if(n instanceof Do)return{fieldPath:e.field.ot(),appendMissingElements:{values:n.elements}};if(n instanceof Oo)return{fieldPath:e.field.ot(),removeAllFromArray:{values:n.elements}};if(n instanceof Po)return{fieldPath:e.field.ot(),increment:n.Qt};throw Ar()}(0,t)}))),e.Gt.jt||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Ms(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Ar()}(t,e.Gt)),n}function Xs(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Uo.updateTime(Us(t.updateTime)):void 0!==t.exists?Uo.exists(t.exists):Uo.Wt()}(e.currentDocument):Uo.Wt(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)Sr("REQUEST_TIME"===e.setToServerValue),n=new xo;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new Do(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new Oo(i)}else"increment"in e?n=new Po(t,e.increment):Ar();var o=ni._t(e.fieldPath);return new Vo(o,n)}(t,e)})):[];if(e.update){e.update.name;var i=zs(t,e.update.name),o=new Di({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){var e=t.fieldPaths||[];return new ui(e.map((function(t){return ni._t(t)})))}(e.updateMask);return new Jo(i,o,s,n,r)}return new Ko(i,o,n,r)}if(e.delete){var u=zs(t,e.delete);return new ts(u,n)}if(e.verify){var a=zs(t,e.verify);return new es(a,n)}return Ar()}function Ys(t,e){return{documents:[Gs(t,e.path)]}}function Qs(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Gs(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Gs(t,r.Z()),n.structuredQuery.from=[{collectionId:r.et()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(Si(t.value))return{unaryFilter:{field:ru(t.field),op:"IS_NAN"}};if(Ai(t.value))return{unaryFilter:{field:ru(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Si(t.value))return{unaryFilter:{field:ru(t.field),op:"IS_NOT_NAN"}};if(Ai(t.value))return{unaryFilter:{field:ru(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ru(t.field),op:nu(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:ru(t.field),direction:eu(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.qt||di(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Zs(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Zs(e.endAt)),n}function $s(t){var e=Hs(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Sr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[su(e)]:void 0!==e.fieldFilter?[ou(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):Ar():[]}(n.where));var u=[];n.orderBy&&(u=n.orderBy.map((function(t){return function(t){return new $i(iu(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var a=null;n.limit&&(a=function(t){var e;return di(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=tu(n.startAt));var h=null;return n.endAt&&(h=tu(n.endAt)),ro(e,i,u,s,a,"F",c,h)}function Zs(t){return{before:t.before,values:t.position}}function tu(t){var e=!!t.before,n=t.values||[];return new Yi(n,e)}function eu(t){return Cs[t]}function nu(t){return Ps[t]}function ru(t){return{fieldPath:t.ot()}}function iu(t){return ni._t(t.fieldPath)}function ou(t){return ji.create(iu(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Ar()}}(t.fieldFilter.op),t.fieldFilter.value)}function su(t){switch(t.unaryFilter.op){case"IS_NAN":var e=iu(t.unaryFilter.field);return ji.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=iu(t.unaryFilter.field);return ji.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=iu(t.unaryFilter.field);return ji.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=iu(t.unaryFilter.field);return ji.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Ar()}}function uu(t){var e=[];return t.fields.forEach((function(t){return e.push(t.ot())})),{fieldPaths:e}}function au(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cu=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},hu=function(){function t(t){var e=this;this.Cn=null,this.xn=null,this.result=void 0,this.error=void 0,this.Nn=!1,this.Fn=!1,t((function(t){e.Nn=!0,e.result=t,e.Cn&&e.Cn(t)}),(function(t){e.Nn=!0,e.error=t,e.xn&&e.xn(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.Fn&&Ar(),this.Fn=!0,this.Nn?this.error?this.On(n,this.error):this.kn(e,this.result):new t((function(t,i){r.Cn=function(n){r.kn(e,n).next(t,i)},r.xn=function(e){r.On(n,e).next(t,i)}}))},t.prototype.Mn=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.Ln=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.kn=function(e,n){return e?this.Ln((function(){return e(n)})):t.resolve(n)},t.prototype.On=function(e,n){return e?this.Ln((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.$n=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.Bn=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.$n(r)},t}(),fu=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.qn=new cu,this.transaction.oncomplete=function(){n.qn.resolve()},this.transaction.onabort=function(){e.error?n.qn.reject(new du(t,e.error)):n.qn.resolve()},this.transaction.onerror=function(e){var r=wu(e.target.error);n.qn.reject(new du(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new du(n,e)}},Object.defineProperty(t.prototype,"Un",{get:function(){return this.qn.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.qn.reject(t),this.aborted||(_r("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new yu(e)},t}(),lu=function(){function t(e,n,i){this.name=e,this.version=n,this.Qn=i,12.2===t.Kn(r())&&Er("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return _r("SimpleDb","Removing database:",t),gu(window.indexedDB.deleteDatabase(t)).Mn()},t.Wn=function(){if("undefined"==typeof indexedDB)return!1;if(t.jn())return!0;var e=r(),n=t.Kn(e),i=0<n&&n<10,o=t.Gn(e),s=0<o&&o<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)},t.jn=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.zn)},t.Hn=function(t,e){return t.store(e)},t.Kn=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Gn=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.Jn=function(t){return e(this,void 0,void 0,(function(){var e,r=this;return n(this,(function(n){switch(n.label){case 0:return this.db?[3,2]:(_r("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,n){var i=indexedDB.open(r.name,r.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){n(new du(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var r=e.target.error;"VersionError"===r.name?n(new Vr(Rr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new du(t,r))},i.onupgradeneeded=function(t){_r("SimpleDb",'Database "'+r.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;r.Qn.Yn(e,i.transaction,t.oldVersion,r.version).next((function(){_r("SimpleDb","Database upgrade to version "+r.version+" complete")}))}}))]);case 1:e.db=n.sent(),n.label=2;case 2:return[2,(this.Xn&&(this.db.onversionchange=function(t){return r.Xn(t)}),this.db)]}}))}))},t.prototype.Zn=function(t){this.Xn=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,r,i,o){return e(this,void 0,void 0,(function(){var e,s,u,a,c;return n(this,(function(h){switch(h.label){case 0:e="readonly"===r,s=0,u=function(){var r,u,c,h,f;return n(this,(function(n){switch(n.label){case 0:++s,n.label=1;case 1:return n.trys.push([1,4,,5]),[4,a.Jn(t)];case 2:return a.db=n.sent(),r=fu.open(a.db,t,e?"readonly":"readwrite",i),u=o(r).catch((function(t){return r.abort(t),hu.reject(t)})).Mn(),c={},u.catch((function(){})),[4,r.Un];case 3:return[2,(c.value=(n.sent(),u),c)];case 4:return h=n.sent(),f="FirebaseError"!==h.name&&s<3,_r("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),a.close(),f?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}}))},a=this,h.label=1;case 1:return[5,u()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),pu=function(){function t(t){this.ts=t,this.es=!1,this.ns=null}return Object.defineProperty(t.prototype,"Nn",{get:function(){return this.es},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ss",{get:function(){return this.ns},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.ts=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.es=!0},t.prototype.rs=function(t){this.ns=t},t.prototype.delete=function(){return gu(this.ts.delete())},t}(),du=function(e){function n(t,n){var r=this;return(r=e.call(this,Rr.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return t(n,e),n}(Vr);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vu(t){return"IndexedDbTransactionError"===t.name}var yu=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(_r("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(_r("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),gu(n)},t.prototype.add=function(t){return _r("SimpleDb","ADD",this.store.name,t,t),gu(this.store.add(t))},t.prototype.get=function(t){var e=this;return gu(this.store.get(t)).next((function(n){return void 0===n&&(n=null),_r("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return _r("SimpleDb","DELETE",this.store.name,t),gu(this.store.delete(t))},t.prototype.count=function(){return _r("SimpleDb","COUNT",this.store.name),gu(this.store.count())},t.prototype.os=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.cs(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.us=function(t,e){_r("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.hs=!1;var r=this.cursor(n);return this.cs(r,(function(t,e,n){return n.delete()}))},t.prototype.ls=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.cs(r,e)},t.prototype._s=function(t){var e=this.cursor({});return new hu((function(n,r){e.onerror=function(t){var e=wu(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.cs=function(t,e){var n=[];return new hu((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new pu(i),s=e(i.primaryKey,i.value,o);if(s instanceof hu){var u=s.catch((function(t){return o.done(),hu.reject(t)}));n.push(u)}o.Nn?r():null===o.ss?i.continue():i.continue(o.ss)}else r()}})).next((function(){return hu.$n(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.hs?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function gu(t){return new hu((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=wu(t.target.error);n(e)}}))}var mu=!1;function wu(t){var e=lu.Kn(r());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var i=new Vr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return mu||(mu=!0,setTimeout((function(){throw i}),0)),i}}return t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bu=function(){function t(t,e,n,r,i){this.fs=t,this.ds=e,this.ws=n,this.op=r,this.Es=i,this.Ts=new cu,this.then=this.Ts.promise.then.bind(this.Ts.promise),this.Ts.promise.catch((function(t){}))}return t.Is=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.As=setTimeout((function(){return e.Rs()}),t)},t.prototype.Ps=function(){return this.Rs()},t.prototype.cancel=function(t){null!==this.As&&(this.clearTimeout(),this.Ts.reject(new Vr(Rr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.Rs=function(){var t=this;this.fs.ys((function(){return null!==t.As?(t.clearTimeout(),t.op().then((function(e){return t.Ts.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.As&&(this.Es(this),clearTimeout(this.As),this.As=null)},t}();function Iu(t,e){if(Er("AsyncQueue",e+": "+t),vu(t))return new Vr(Rr.UNAVAILABLE,e+": "+t);throw t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _u="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Eu=function(){function t(){this.gs=[]}return t.prototype.Vs=function(t){this.gs.push(t)},t.prototype.ps=function(){this.gs.forEach((function(t){return t()}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tu(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Au(e)),e=Nu(t.get(n),e);return Au(e)}function Nu(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Au(t){return t+""}function Su(t){var e=t.length;if(Sr(e>=2),2===e)return Sr(""===t.charAt(0)&&""===t.charAt(1)),ti.at();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&Ar(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Ar()}o=s+2}return new ti(r)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xu=function(t,e){this.seconds=t,this.nanoseconds=e},Du=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Du.store="owner",Du.key="owner";var ku=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};ku.store="mutationQueues",ku.keyPath="userId";var Ou=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Ou.store="mutations",Ou.keyPath="batchId",Ou.userMutationsIndex="userMutationsIndex",Ou.userMutationsKeyPath=["userId","batchId"];var Cu=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Tu(e)]},t.key=function(t,e,n){return[t,Tu(e),n]},t}();Cu.store="documentMutations",Cu.PLACEHOLDER=new Cu;var Pu=function(t,e){this.path=t,this.readTime=e},Lu=function(t,e){this.path=t,this.version=e},Ru=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ru.store="remoteDocuments",Ru.readTimeIndex="readTimeIndex",Ru.readTimeIndexPath="readTime",Ru.collectionReadTimeIndex="collectionReadTimeIndex",Ru.collectionReadTimeIndexPath=["parentPath","readTime"];var Vu=function(t){this.byteSize=t};Vu.store="remoteDocumentGlobal",Vu.key="remoteDocumentGlobalKey";var Mu=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Mu.store="targets",Mu.keyPath="targetId",Mu.queryTargetsIndexName="queryTargetsIndex",Mu.queryTargetsKeyPath=["canonicalId","targetId"];var Uu=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Uu.store="targetDocuments",Uu.keyPath=["targetId","path"],Uu.documentTargetsIndex="documentTargetsIndex",Uu.documentTargetsKeyPath=["path","targetId"];var Fu=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Fu.key="targetGlobalKey",Fu.store="targetGlobal";var qu=function(t,e){this.collectionId=t,this.parent=e};qu.store="collectionParents",qu.keyPath=["collectionId","parent"];var ju=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};ju.store="clientMetadata",ju.keyPath="clientId";var zu=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};zu.store="bundles",zu.keyPath="bundleId";var Gu=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Gu.store="namedQueries",Gu.keyPath="name";var Hu=i(i(i(i([ku.store,Ou.store,Cu.store,Ru.store,Mu.store,Du.store,Fu.store,Uu.store],[ju.store]),[Vu.store]),[qu.store]),[zu.store,Gu.store]),Bu=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).bs=t,r.vs=n,r}return t(n,e),n}(Eu);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ku(t,e){var n=xr(t);return lu.Hn(n.bs,e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ju=function(){function t(t,e,n,r){this.batchId=t,this.Ss=e,this.baseMutations=n,this.mutations=r}return t.prototype.Ds=function(t,e,n){for(var r=n.Cs,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=jo(o,e,r[i]))}return e},t.prototype.xs=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=zo(s,e,0,this.Ss));for(var i=0,o=this.mutations;i<o.length;i++){var s;(s=o[i]).key.isEqual(t)&&(e=zo(s,e,0,this.Ss))}return e},t.prototype.Ns=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.xs(r.key,t.get(r.key));i&&(n=n.Ht(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),gs())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Cr(this.mutations,t.mutations,(function(t,e){return Ho(t,e)}))&&Cr(this.baseMutations,t.baseMutations,(function(t,e){return Ho(t,e)}))},t}(),Wu=function(){function t(t,e,n,r){this.batch=t,this.Fs=e,this.Cs=n,this.Os=r}return t.from=function(e,n,r){Sr(e.mutations.length===r.length);for(var i=vs,o=e.mutations,s=0;s<o.length;s++)i=i.Ht(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Xu=function(t){this.ks=t};function Yu(t,e){if(e.document)return function(t,e,n){var r=zs(t,e.name),i=Us(e.updateTime),o=new Di({mapValue:{fields:e.fields}});return new Pi(r,i,o,{hasCommittedMutations:!!n})}(t.ks,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=ri.Tt(e.noDocument.path),r=ea(e.noDocument.readTime);return new Li(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=ri.Tt(e.unknownDocument.path);return r=ea(e.unknownDocument.version),new Ri(i,r)}return Ar()}function Qu(t,e,n){var r=$u(n),i=e.key.path.Z().rt();if(e instanceof Pi){var o=function(t,e){return{name:js(t,e.key),fields:e.vt().mapValue.fields,updateTime:Rs(t,e.version.G())}}(t.ks,e),s=e.hasCommittedMutations;return new Ru(null,null,o,s,r,i)}if(e instanceof Li){var u=e.key.path.rt(),a=ta(e.version);return s=e.hasCommittedMutations,new Ru(null,new Pu(u,a),null,s,r,i)}if(e instanceof Ri){var c=e.key.path.rt(),h=ta(e.version);return new Ru(new Lu(c,h),null,null,!0,r,i)}return Ar()}function $u(t){var e=t.G();return[e.seconds,e.nanoseconds]}function Zu(t){var e=new Qr(t[0],t[1]);return $r.W(e)}function ta(t){var e=t.G();return new xu(e.seconds,e.nanoseconds)}function ea(t){var e=new Qr(t.seconds,t.nanoseconds);return $r.W(e)}function na(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Xs(t.ks,e)})),r=e.mutations.length-1;r>=0;--r){var i=e.mutations[r];void 0!==(null==i?void 0:i.transform)&&(e.mutations[r-1].updateTransforms=i.transform.fieldTransforms,e.mutations.splice(r,1),--r)}var o=e.mutations.map((function(e){return Xs(t.ks,e)})),s=Qr.fromMillis(e.localWriteTimeMs);return new Ju(e.batchId,s,n,o)}function ra(t){var e,n,r=ea(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?ea(t.lastLimboFreeSnapshotVersion):$r.min();return void 0!==t.query.documents?(Sr(1===(n=t.query).documents.length),e=fo(io(Hs(n.documents[0])))):e=function(t){return fo($s(t))}(t.query),new bo(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Lr.fromBase64String(t.resumeToken))}function ia(t,e){var n,r=ta(e.Mt),i=ta(e.lastLimboFreeSnapshotVersion);n=qi(e.target)?Ys(t.ks,e.target):Qs(t.ks,e.target);var o=e.resumeToken.toBase64();return new Mu(e.targetId,Ui(e.target),r,o,e.sequenceNumber,i,n)}function oa(t){var e=$s({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?lo(e,e.limit,"L"):e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sa=function(){function t(){}return t.prototype.Ms=function(t,e){return ua(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:ea(e.createTime),version:e.version};var e}))},t.prototype.Ls=function(t,e){return ua(t).put({bundleId:(n=e).id,createTime:ta(Us(n.createTime)),version:n.version});var n},t.prototype.$s=function(t,e){return aa(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:oa(e.bundledQuery),readTime:ea(e.readTime)};var e}))},t.prototype.Bs=function(t,e){return aa(t).put(function(t){return{name:t.name,readTime:ta(Us(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function ua(t){return Ku(t,zu.store)}function aa(t){return Ku(t,Gu.store)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ca=function(){function t(){this.qs=new ha}return t.prototype.Us=function(t,e){return this.qs.add(e),hu.resolve()},t.prototype.Qs=function(t,e){return hu.resolve(this.qs.getEntries(e))},t}(),ha=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.et(),n=t.Z(),r=this.index[e]||new as(ti.J),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.et(),n=t.Z(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new as(ti.J)).rt()},t}(),fa=function(){function t(){this.Ks=new ha}return t.prototype.Us=function(t,e){var n=this;if(!this.Ks.has(e)){var r=e.et(),i=e.Z();t.Vs((function(){n.Ks.add(e)}));var o={collectionId:r,parent:Tu(i)};return la(t).put(o)}return hu.resolve()},t.prototype.Qs=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Pr(e),""],!1,!0);return la(t).os(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Su(o.parent))}return n}))},t}();function la(t){return Ku(t,qu.store)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pa={Ws:!1,js:0,Gs:0,zs:0},da=function(){function t(t,e,n){this.Hs=t,this.Js=e,this.Ys=n}return t.Xs=function(e){return new t(e,t.Zs,t.ti)},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function va(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){if(t.code!==Rr.FAILED_PRECONDITION||t.message!==_u)throw t;return _r("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */da.Zs=10,da.ti=1e3,da.ei=new da(41943040,da.Zs,da.ti),da.ni=new da(-1,0,0);var ya=function(){function t(t,e){this.si=t,this.ii=e,this.ri={}}return t.prototype.get=function(t){var e=this.si(t),n=this.ri[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.ii(s,t))return u}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.si(t),r=this.ri[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.ii(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.ri[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.si(t),n=this.ri[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.ii(n[r][0],t))return 1===n.length?delete this.ri[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){oi(this.ri,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];t(s,u)}}))},t.prototype.nt=function(){return si(this.ri)},t}(),ga=function(){function t(){this.oi=new ya((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.ci=!1}return t.prototype.ai=function(t){var e=this.oi.get(t);return e?e.readTime:$r.min()},t.prototype.ui=function(t,e){this.hi(),this.oi.set(t.key,{li:t,readTime:e})},t.prototype._i=function(t,e){void 0===e&&(e=null),this.hi(),this.oi.set(t,{li:null,readTime:e})},t.prototype.fi=function(t,e){this.hi();var n=this.oi.get(e);return void 0!==n?hu.resolve(n.li):this.di(t,e)},t.prototype.getEntries=function(t,e){return this.wi(t,e)},t.prototype.apply=function(t){return this.hi(),this.ci=!0,this.Ei(t)},t.prototype.hi=function(){},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ma(t,e,n){var r=t.store(Ou.store),i=t.store(Cu.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.ls({range:s},(function(t,e,n){return u++,n.delete()}));o.push(a.next((function(){Sr(1===u)})));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=Cu.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return hu.$n(o).next((function(){return c}))}function wa(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Ar();e=t.noDocument}return JSON.stringify(e).length}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ba=function(){function t(t,e,n,r){this.userId=t,this.Kt=e,this.Ti=n,this.Ii=r,this.mi={}}return t.Ai=function(e,n,r,i){return Sr(""!==e.uid),new t(e.A()?e.uid:"",n,r,i)},t.prototype.Ri=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return _a(t).ls({index:Ou.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.Pi=function(t,e,n,r){var i=this,o=Ea(t),s=_a(t);return s.add({}).next((function(u){Sr("number"==typeof u);for(var a=new Ju(u,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return Ws(t.ks,e)})),i=n.mutations.map((function(e){return Ws(t.ks,e)}));return new Ou(e,n.batchId,n.Ss.toMillis(),r,i)}(i.Kt,i.userId,a),h=[],f=new as((function(t,e){return Or(t.ot(),e.ot())})),l=0,p=r;l<p.length;l++){var d=p[l],v=Cu.key(i.userId,d.key.path,u);f=f.add(d.key.path.Z()),h.push(s.put(c)),h.push(o.put(v,Cu.PLACEHOLDER))}return f.forEach((function(e){h.push(i.Ti.Us(t,e))})),t.Vs((function(){i.mi[u]=a.keys()})),hu.$n(h).next((function(){return a}))}))},t.prototype.yi=function(t,e){var n=this;return _a(t).get(e).next((function(t){return t?(Sr(t.userId===n.userId),na(n.Kt,t)):null}))},t.prototype.gi=function(t,e){var n=this;return this.mi[e]?hu.resolve(this.mi[e]):this.yi(t,e).next((function(t){if(t){var r=t.keys();return n.mi[e]=r,r}return null}))},t.prototype.Vi=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return _a(t).ls({index:Ou.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Sr(e.batchId>=r),o=na(n.Kt,e)),i.done()})).next((function(){return o}))},t.prototype.pi=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return _a(t).ls({index:Ou.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.bi=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return _a(t).os(Ou.userMutationsIndex,n).next((function(t){return t.map((function(t){return na(e.Kt,t)}))}))},t.prototype.vi=function(t,e){var n=this,r=Cu.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Ea(t).ls({range:i},(function(r,i,s){var u=r[0],a=r[1],c=r[2],h=Su(a);if(u===n.userId&&e.path.isEqual(h))return _a(t).get(c).next((function(t){if(!t)throw Ar();Sr(t.userId===n.userId),o.push(na(n.Kt,t))}));s.done()})).next((function(){return o}))},t.prototype.Si=function(t,e){var n=this,r=new as(Or),i=[];return e.forEach((function(e){var o=Cu.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),u=Ea(t).ls({range:s},(function(t,i,o){var s=t[0],u=t[1],a=t[2],c=Su(u);s===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()}));i.push(u)})),hu.$n(i).next((function(){return n.Di(t,r)}))},t.prototype.Ci=function(t,e){var n=this,r=e.path,i=r.length+1,o=Cu.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),u=new as(Or);return Ea(t).ls({range:s},(function(t,e,o){var s=t[0],a=t[1],c=t[2],h=Su(a);s===n.userId&&r.st(h)?h.length===i&&(u=u.add(c)):o.done()})).next((function(){return n.Di(t,u)}))},t.prototype.Di=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(_a(t).get(e).next((function(t){if(null===t)throw Ar();Sr(t.userId===n.userId),r.push(na(n.Kt,t))})))})),hu.$n(i).next((function(){return r}))},t.prototype.xi=function(t,e){var n=this;return ma(t.bs,this.userId,e).next((function(r){return t.Vs((function(){n.Ni(e.batchId)})),hu.forEach(r,(function(e){return n.Ii.Fi(t,e)}))}))},t.prototype.Ni=function(t){delete this.mi[t]},t.prototype.Oi=function(t){var e=this;return this.Ri(t).next((function(n){if(!n)return hu.resolve();var r=IDBKeyRange.lowerBound(Cu.prefixForUser(e.userId)),i=[];return Ea(t).ls({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Su(t[1]);i.push(o)}else r.done()})).next((function(){Sr(0===i.length)}))}))},t.prototype.ki=function(t,e){return Ia(t,this.userId,e)},t.prototype.Mi=function(t){var e=this;return Ta(t).get(this.userId).next((function(t){return t||new ku(e.userId,-1,"")}))},t}();function Ia(t,e,n){var r=Cu.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Ea(t).ls({range:o,hs:!0},(function(t,n,r){var o=t[0],u=t[1];t[2],o===e&&u===i&&(s=!0),r.done()})).next((function(){return s}))}function _a(t){return Ku(t,Ou.store)}function Ea(t){return Ku(t,Cu.store)}function Ta(t){return Ku(t,ku.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Na=function(){function t(t){this.Li=t}return t.prototype.next=function(){return this.Li+=2,this.Li},t.$i=function(){return new t(0)},t.Bi=function(){return new t(-1)},t}(),Aa=function(){function t(t,e){this.Ii=t,this.Kt=e}return t.prototype.qi=function(t){var e=this;return this.Ui(t).next((function(n){var r=new Na(n.highestTargetId);return n.highestTargetId=r.next(),e.Qi(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.Ki=function(t){return this.Ui(t).next((function(t){return $r.W(new Qr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.Wi=function(t){return this.Ui(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.ji=function(t,e,n){var r=this;return this.Ui(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.G()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Qi(t,i)}))},t.prototype.Gi=function(t,e){var n=this;return this.zi(t,e).next((function(){return n.Ui(t).next((function(r){return r.targetCount+=1,n.Hi(e,r),n.Qi(t,r)}))}))},t.prototype.Ji=function(t,e){return this.zi(t,e)},t.prototype.Yi=function(t,e){var n=this;return this.Xi(t,e.targetId).next((function(){return Sa(t).delete(e.targetId)})).next((function(){return n.Ui(t)})).next((function(e){return Sr(e.targetCount>0),e.targetCount-=1,n.Qi(t,e)}))},t.prototype.Zi=function(t,e,n){var r=this,i=0,o=[];return Sa(t).ls((function(s,u){var a=ra(u);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.Yi(t,a)))})).next((function(){return hu.$n(o)})).next((function(){return i}))},t.prototype.mn=function(t,e){return Sa(t).ls((function(t,n){var r=ra(n);e(r)}))},t.prototype.Ui=function(t){return xa(t).get(Fu.key).next((function(t){return Sr(null!==t),t}))},t.prototype.Qi=function(t,e){return xa(t).put(Fu.key,e)},t.prototype.zi=function(t,e){return Sa(t).put(ia(this.Kt,e))},t.prototype.Hi=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.tr=function(t){return this.Ui(t).next((function(t){return t.targetCount}))},t.prototype.er=function(t,e){var n=Ui(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Sa(t).ls({range:r,index:Mu.queryTargetsIndexName},(function(t,n,r){var o=ra(n);Fi(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.nr=function(t,e,n){var r=this,i=[],o=Da(t);return e.forEach((function(e){var s=Tu(e.path);i.push(o.put(new Uu(n,s))),i.push(r.Ii.sr(t,n,e))})),hu.$n(i)},t.prototype.ir=function(t,e,n){var r=this,i=Da(t);return hu.forEach(e,(function(e){var o=Tu(e.path);return hu.$n([i.delete([n,o]),r.Ii.rr(t,n,e)])}))},t.prototype.Xi=function(t,e){var n=Da(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.cr=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Da(t),i=gs();return r.ls({range:n,hs:!0},(function(t,e,n){var r=Su(t[1]),o=new ri(r);i=i.add(o)})).next((function(){return i}))},t.prototype.ki=function(t,e){var n=Tu(e.path),r=IDBKeyRange.bound([n],[Pr(n)],!1,!0),i=0;return Da(t).ls({index:Uu.documentTargetsIndex,hs:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.Dn=function(t,e){return Sa(t).get(e).next((function(t){return t?ra(t):null}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sa(t){return Ku(t,Mu.store)}function xa(t){return Ku(t,Fu.store)}function Da(t){return Ku(t,Uu.store)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ka(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Or(n,i);return 0===s?Or(r,o):s}var Oa=function(){function t(t){this.ar=t,this.buffer=new as(ka),this.ur=0}return t.prototype.hr=function(){return++this.ur},t.prototype.lr=function(t){var e=[t,this.hr()];if(this.buffer.size<this.ar)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ka(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Ca=function(){function t(t,e){this._r=t,this.fs=e,this.dr=!1,this.wr=null}return t.prototype.start=function(t){-1!==this._r.params.Hs&&this.Er(t)},t.prototype.stop=function(){this.wr&&(this.wr.cancel(),this.wr=null)},Object.defineProperty(t.prototype,"Tr",{get:function(){return null!==this.wr},enumerable:!1,configurable:!0}),t.prototype.Er=function(t){var r=this,i=this.dr?3e5:6e4;_r("LruGarbageCollector","Garbage collection scheduled in "+i+"ms"),this.wr=this.fs.Ir("lru_garbage_collection",i,(function(){return e(r,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:this.wr=null,this.dr=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.mr(this._r)];case 2:return n.sent(),[3,7];case 3:return vu(e=n.sent())?(_r("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,va(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.Er(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),Pa=function(){function t(t,e){this.Ar=t,this.params=e}return t.prototype.Rr=function(t,e){return this.Ar.Pr(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.yr=function(t,e){var n=this;if(0===e)return hu.resolve(Yr.U);var r=new Oa(e);return this.Ar.mn(t,(function(t){return r.lr(t.sequenceNumber)})).next((function(){return n.Ar.gr(t,(function(t){return r.lr(t)}))})).next((function(){return r.maxValue}))},t.prototype.Zi=function(t,e,n){return this.Ar.Zi(t,e,n)},t.prototype.Vr=function(t,e){return this.Ar.Vr(t,e)},t.prototype.pr=function(t,e){var n=this;return-1===this.params.Hs?(_r("LruGarbageCollector","Garbage collection skipped; disabled"),hu.resolve(pa)):this.br(t).next((function(r){return r<n.params.Hs?(_r("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.Hs),pa):n.vr(t,e)}))},t.prototype.br=function(t){return this.Ar.br(t)},t.prototype.vr=function(t,e){var n,r,i,o,s,u,a,c=this,h=Date.now();return this.Rr(t,this.params.Js).next((function(e){return e>c.params.Ys?(_r("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.Ys+" from "+e),r=c.params.Ys):r=e,o=Date.now(),c.yr(t,r)})).next((function(r){return n=r,s=Date.now(),c.Zi(t,n,e)})).next((function(e){return i=e,u=Date.now(),c.Vr(t,n)})).next((function(t){return a=Date.now(),Ir()<=f.DEBUG&&_r("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(a-u)+"ms\nTotal Duration: "+(a-h)+"ms"),hu.resolve({Ws:!0,js:r,Gs:i,zs:t})}))},t}(),La=function(){function t(t,e){this.db=t,this._r=function(t,e){return new Pa(t,e)}(this,e)}return t.prototype.Pr=function(t){var e=this.Sr(t);return this.db.Dr().tr(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.Sr=function(t){var e=0;return this.gr(t,(function(t){e++})).next((function(){return e}))},t.prototype.mn=function(t,e){return this.db.Dr().mn(t,e)},t.prototype.gr=function(t,e){return this.Cr(t,(function(t,n){return e(n)}))},t.prototype.sr=function(t,e,n){return Ra(t,n)},t.prototype.rr=function(t,e,n){return Ra(t,n)},t.prototype.Zi=function(t,e,n){return this.db.Dr().Zi(t,e,n)},t.prototype.Fi=function(t,e){return Ra(t,e)},t.prototype.Nr=function(t,e){return function(t,e){var n=!1;return Ta(t)._s((function(r){return Ia(t,r,e).next((function(t){return t&&(n=!0),hu.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.Vr=function(t,e){var n=this,r=this.db.Or().Fr(),i=[],o=0;return this.Cr(t,(function(s,u){if(u<=e){var a=n.Nr(t,s).next((function(e){if(!e)return o++,r.fi(t,s).next((function(){return r._i(s),Da(t).delete([0,Tu(s.path)])}))}));i.push(a)}})).next((function(){return hu.$n(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.Lt(t.vs);return this.db.Dr().Ji(t,n)},t.prototype.kr=function(t,e){return Ra(t,e)},t.prototype.Cr=function(t,e){var n,r=Da(t),i=Yr.U;return r.ls({index:Uu.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),u=r.sequenceNumber;0===o?(i!==Yr.U&&e(new ri(Su(n)),i),i=u,n=s):i=Yr.U})).next((function(){i!==Yr.U&&e(new ri(Su(n)),i)}))},t.prototype.br=function(t){return this.db.Or().Mr(t)},t}();function Ra(t,e){return Da(t).put(function(t,e){return new Uu(0,Tu(t.path),e)}(e,t.vs))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Va=function(){function t(t,e){this.Kt=t,this.Ti=e}return t.prototype.ui=function(t,e,n){return Fa(t).put(qa(e),n)},t.prototype._i=function(t,e){var n=Fa(t),r=qa(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.Lr(t,r)}))},t.prototype.fi=function(t,e){var n=this;return Fa(t).get(qa(e)).next((function(t){return n.$r(t)}))},t.prototype.Br=function(t,e){var n=this;return Fa(t).get(qa(e)).next((function(t){var e=n.$r(t);return e?{li:e,size:wa(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=ls();return this.qr(t,e,(function(t,e){var i=n.$r(e);r=r.Ht(t,i)})).next((function(){return r}))},t.prototype.Ur=function(t,e){var n=this,r=ls(),i=new os(ri.J);return this.qr(t,e,(function(t,e){var o=n.$r(e);o?(r=r.Ht(t,o),i=i.Ht(t,wa(e))):(r=r.Ht(t,null),i=i.Ht(t,0))})).next((function(){return{Qr:r,Kr:i}}))},t.prototype.qr=function(t,e,n){if(e.nt())return hu.resolve();var r=IDBKeyRange.bound(e.first().path.rt(),e.last().path.rt()),i=e.ee(),o=i.ce();return Fa(t).ls({range:r},(function(t,e,r){for(var s=ri.Tt(t);o&&ri.J(o,s)<0;)n(o,null),o=i.ce();o&&o.isEqual(s)&&(n(o,e),o=i.ae()?i.ce():null),o?r.rs(o.path.rt()):r.done()})).next((function(){for(;o;)n(o,null),o=i.ae()?i.ce():null}))},t.prototype.Wr=function(t,e,n){var r=this,i=ds(),o=e.path.length+1,s={};if(n.isEqual($r.min())){var u=e.path.rt();s.range=IDBKeyRange.lowerBound(u)}else{var a=e.path.rt(),c=$u(n);s.range=IDBKeyRange.lowerBound([a,c],!0),s.index=Ru.collectionReadTimeIndex}return Fa(t).ls(s,(function(t,n,s){if(t.length===o){var u=Yu(r.Kt,n);e.path.st(u.key.path)?u instanceof Pi&&go(e,u)&&(i=i.Ht(u.key,u)):s.done()}})).next((function(){return i}))},t.prototype.Fr=function(t){return new Ma(this,!!t&&t.jr)},t.prototype.Mr=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Ua(t).get(Vu.key).next((function(t){return Sr(!!t),t}))},t.prototype.Lr=function(t,e){return Ua(t).put(Vu.key,e)},t.prototype.$r=function(t){if(t){var e=Yu(this.Kt,t);return e instanceof Li&&e.version.isEqual($r.min())?null:e}return null},t}(),Ma=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).Gr=t,r.jr=n,r.zr=new ya((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return t(n,e),n.prototype.Ei=function(t){var e=this,n=[],r=0,i=new as((function(t,e){return Or(t.ot(),e.ot())}));return this.oi.forEach((function(o,s){var u=e.zr.get(o);if(s.li){var a=Qu(e.Gr.Kt,s.li,e.ai(o));i=i.add(o.path.Z());var c=wa(a);r+=c-u,n.push(e.Gr.ui(t,o,a))}else if(r-=u,e.jr){var h=Qu(e.Gr.Kt,new Li(o,$r.min()),e.ai(o));n.push(e.Gr.ui(t,o,h))}else n.push(e.Gr._i(t,o))})),i.forEach((function(r){n.push(e.Gr.Ti.Us(t,r))})),n.push(this.Gr.updateMetadata(t,r)),hu.$n(n)},n.prototype.di=function(t,e){var n=this;return this.Gr.Br(t,e).next((function(t){return null===t?(n.zr.set(e,0),null):(n.zr.set(e,t.size),t.li)}))},n.prototype.wi=function(t,e){var n=this;return this.Gr.Ur(t,e).next((function(t){var e=t.Qr;return t.Kr.forEach((function(t,e){n.zr.set(t,e)})),e}))},n}(ga);function Ua(t){return Ku(t,Vu.store)}function Fa(t){return Ku(t,Ru.store)}function qa(t){return t.path.rt()}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ja=function(){function t(t){this.Kt=t}return t.prototype.Yn=function(t,e,n,r){var i=this;Sr(n<r&&n>=0&&r<=11);var o=new fu("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Du.store)}(t),function(t){t.createObjectStore(ku.store,{keyPath:ku.keyPath}),t.createObjectStore(Ou.store,{keyPath:Ou.keyPath,autoIncrement:!0}).createIndex(Ou.userMutationsIndex,Ou.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Cu.store)}(t),za(t),function(t){t.createObjectStore(Ru.store)}(t));var s=hu.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Uu.store),t.deleteObjectStore(Mu.store),t.deleteObjectStore(Fu.store)}(t),za(t)),s=s.next((function(){return function(t){var e=t.store(Fu.store),n=new Fu(0,0,$r.min().G(),0);return e.put(Fu.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Ou.store).os().next((function(n){t.deleteObjectStore(Ou.store),t.createObjectStore(Ou.store,{keyPath:Ou.keyPath,autoIncrement:!0}).createIndex(Ou.userMutationsIndex,Ou.userMutationsKeyPath,{unique:!0});var r=e.store(Ou.store),i=n.map((function(t){return r.put(t)}));return hu.$n(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(ju.store,{keyPath:ju.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Hr(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Vu.store)}(t),i.Jr(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.Yr(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Xr(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Ru.store);e.createIndex(Ru.readTimeIndex,Ru.readTimeIndexPath,{unique:!1}),e.createIndex(Ru.collectionReadTimeIndex,Ru.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Zr(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(zu.store,{keyPath:zu.keyPath})}(t),function(t){t.createObjectStore(Gu.store,{keyPath:Gu.keyPath})}(t)}))),s},t.prototype.Jr=function(t){var e=0;return t.store(Ru.store).ls((function(t,n){e+=wa(n)})).next((function(){var n=new Vu(e);return t.store(Vu.store).put(Vu.key,n)}))},t.prototype.Hr=function(t){var e=this,n=t.store(ku.store),r=t.store(Ou.store);return n.os().next((function(n){return hu.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.os(Ou.userMutationsIndex,i).next((function(r){return hu.forEach(r,(function(r){Sr(r.userId===n.userId);var i=na(e.Kt,r);return ma(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.Yr=function(t){var e=t.store(Uu.store),n=t.store(Ru.store);return t.store(Fu.store).get(Fu.key).next((function(t){var r=[];return n.ls((function(n,i){var o=new ti(n),s=function(t){return[0,Tu(t)]}(o);r.push(e.get(s).next((function(n){return n?hu.resolve():function(n){return e.put(new Uu(0,Tu(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return hu.$n(r)}))}))},t.prototype.Xr=function(t,e){t.createObjectStore(qu.store,{keyPath:qu.keyPath});var n=e.store(qu.store),r=new ha,i=function(t){if(r.add(t)){var e=t.et(),i=t.Z();return n.put({collectionId:e,parent:Tu(i)})}};return e.store(Ru.store).ls({hs:!0},(function(t,e){var n=new ti(t);return i(n.Z())})).next((function(){return e.store(Cu.store).ls({hs:!0},(function(t,e){t[0];var n=t[1],r=(t[2],Su(n));return i(r.Z())}))}))},t.prototype.Zr=function(t){var e=this,n=t.store(Mu.store);return n.ls((function(t,r){var i=ra(r),o=ia(e.Kt,i);return n.put(o)}))},t}();function za(t){t.createObjectStore(Uu.store,{keyPath:Uu.keyPath}).createIndex(Uu.documentTargetsIndex,Uu.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Mu.store,{keyPath:Mu.keyPath}).createIndex(Mu.queryTargetsIndexName,Mu.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Fu.store)}var Ga="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ha=function(){function t(e,n,r,i,o,s,u,a,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.eo=o,this.window=s,this.document=u,this.no=c,this.so=h,this.io=null,this.ro=!1,this.isPrimary=!1,this.networkEnabled=!0,this.oo=null,this.inForeground=!1,this.co=null,this.ao=null,this.uo=Number.NEGATIVE_INFINITY,this.ho=function(t){return Promise.resolve()},!t.Wn())throw new Vr(Rr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Ii=new La(this,i),this.lo=n+"main",this.Kt=new Xu(a),this._o=new lu(this.lo,11,new ja(this.Kt)),this.fo=new Aa(this.Ii,this.Kt),this.Ti=new fa,this.wo=function(t,e){return new Va(t,e)}(this.Kt,this.Ti),this.Eo=new sa,this.window&&this.window.localStorage?this.To=this.window.localStorage:(this.To=null,!1===h&&Er("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.Io().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Vr(Rr.FAILED_PRECONDITION,Ga);return t.mo(),t.Ao(),t.Ro(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.fo.Wi(e)}))})).then((function(e){t.io=new Yr(e,t.no)})).then((function(){t.ro=!0})).catch((function(e){return t._o&&t._o.close(),Promise.reject(e)}))},t.prototype.Po=function(t){var r=this;return this.ho=function(i){return e(r,void 0,void 0,(function(){return n(this,(function(e){return this.Tr?[2,t(i)]:[2]}))}))},t(this.isPrimary)},t.prototype.yo=function(t){var r=this;this._o.Zn((function(i){return e(r,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return null===i.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.Vo=function(t){var r=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.eo.ys((function(){return e(r,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return this.Tr?[4,this.Io()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.Io=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Ka(e).put(new ju(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.po(e).next((function(e){e||(t.isPrimary=!1,t.eo.bo((function(){return t.ho(!1)})))}))})).next((function(){return t.vo(e)})).next((function(n){return t.isPrimary&&!n?t.So(e).next((function(){return!1})):!!n&&t.Do(e).next((function(){return!0}))}))})).catch((function(e){if(vu(e))return _r("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return _r("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.eo.bo((function(){return t.ho(e)})),t.isPrimary=e}))},t.prototype.po=function(t){var e=this;return Ba(t).get(Du.key).next((function(t){return hu.resolve(e.Co(t))}))},t.prototype.xo=function(t){return Ka(t).delete(this.clientId)},t.prototype.No=function(){return e(this,void 0,void 0,(function(){var t,e,r,i,o=this;return n(this,(function(n){switch(n.label){case 0:return!this.isPrimary||this.Fo(this.uo,18e5)?[3,2]:(this.uo=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=Ku(t,ju.store);return e.os().next((function(t){var n=o.Oo(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return hu.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=n.sent(),this.To)for(e=0,r=t;e<r.length;e++)i=r[e],this.To.removeItem(this.ko(i.clientId));n.label=2;case 2:return[2]}}))}))},t.prototype.Ro=function(){var t=this;this.ao=this.eo.Ir("client_metadata_refresh",4e3,(function(){return t.Io().then((function(){return t.No()})).then((function(){return t.Ro()}))}))},t.prototype.Co=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.vo=function(t){var e=this;return this.so?hu.resolve(!0):Ba(t).get(Du.key).next((function(n){if(null!==n&&e.Fo(n.leaseTimestampMs,5e3)&&!e.Mo(n.ownerId)){if(e.Co(n)&&e.networkEnabled)return!0;if(!e.Co(n)){if(!n.allowTabSynchronization)throw new Vr(Rr.FAILED_PRECONDITION,Ga);return!1}}return!(!e.networkEnabled||!e.inForeground)||Ka(t).os().next((function(t){return void 0===e.Oo(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&_r("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.Lo=function(){return e(this,void 0,void 0,(function(){var t=this;return n(this,(function(e){switch(e.label){case 0:return this.ro=!1,this.$o(),this.ao&&(this.ao.cancel(),this.ao=null),this.Bo(),this.qo(),[4,this._o.runTransaction("shutdown","readwrite",[Du.store,ju.store],(function(e){var n=new Bu(e,Yr.U);return t.So(n).next((function(){return t.xo(n)}))}))];case 1:return e.sent(),this._o.close(),this.Uo(),[2]}}))}))},t.prototype.Oo=function(t,e){var n=this;return t.filter((function(t){return n.Fo(t.updateTimeMs,e)&&!n.Mo(t.clientId)}))},t.prototype.Qo=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Ka(e).os().next((function(e){return t.Oo(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"Tr",{get:function(){return this.ro},enumerable:!1,configurable:!0}),t.prototype.Ko=function(t){return ba.Ai(t,this.Kt,this.Ti,this.Ii)},t.prototype.Dr=function(){return this.fo},t.prototype.Or=function(){return this.wo},t.prototype.Wo=function(){return this.Ti},t.prototype.jo=function(){return this.Eo},t.prototype.runTransaction=function(t,e,n){var r=this;_r("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this._o.runTransaction(t,o,Hu,(function(o){return i=new Bu(o,r.io?r.io.next():Yr.U),"readwrite-primary"===e?r.po(i).next((function(t){return!!t||r.vo(i)})).next((function(e){if(!e)throw Er("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.eo.bo((function(){return r.ho(!1)})),new Vr(Rr.FAILED_PRECONDITION,_u);return n(i)})).next((function(t){return r.Do(i).next((function(){return t}))})):r.Go(i).next((function(){return n(i)}))})).then((function(t){return i.ps(),t}))},t.prototype.Go=function(t){var e=this;return Ba(t).get(Du.key).next((function(t){if(null!==t&&e.Fo(t.leaseTimestampMs,5e3)&&!e.Mo(t.ownerId)&&!e.Co(t)&&!(e.so||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Vr(Rr.FAILED_PRECONDITION,Ga)}))},t.prototype.Do=function(t){var e=new Du(this.clientId,this.allowTabSynchronization,Date.now());return Ba(t).put(Du.key,e)},t.Wn=function(){return lu.Wn()},t.prototype.So=function(t){var e=this,n=Ba(t);return n.get(Du.key).next((function(t){return e.Co(t)?(_r("IndexedDbPersistence","Releasing primary lease."),n.delete(Du.key)):hu.resolve()}))},t.prototype.Fo=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Er("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.mo=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.co=function(){t.eo.ys((function(){return t.inForeground="visible"===t.document.visibilityState,t.Io()}))},this.document.addEventListener("visibilitychange",this.co),this.inForeground="visible"===this.document.visibilityState)},t.prototype.Bo=function(){this.co&&(this.document.removeEventListener("visibilitychange",this.co),this.co=null)},t.prototype.Ao=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.oo=function(){e.$o(),e.eo.ys((function(){return e.Lo()}))},this.window.addEventListener("unload",this.oo))},t.prototype.qo=function(){this.oo&&(this.window.removeEventListener("unload",this.oo),this.oo=null)},t.prototype.Mo=function(t){var e;try{var n=null!==(null===(e=this.To)||void 0===e?void 0:e.getItem(this.ko(t)));return _r("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Er("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.$o=function(){if(this.To)try{this.To.setItem(this.ko(this.clientId),String(Date.now()))}catch(t){Er("Failed to set zombie client id.",t)}},t.prototype.Uo=function(){if(this.To)try{this.To.removeItem(this.ko(this.clientId))}catch(t){}},t.prototype.ko=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Ba(t){return Ku(t,Du.store)}function Ka(t){return Ku(t,ju.store)}function Ja(t,e){var n=t.projectId;return t.m||(n+="."+t.database),"firestore/"+e+"/"+n+"/"
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var Wa=function(){function t(t,e,n){this.wo=t,this.Ho=e,this.Ti=n}return t.prototype.Jo=function(t,e){var n=this;return this.Ho.vi(t,e).next((function(r){return n.Yo(t,e,r)}))},t.prototype.Yo=function(t,e,n){return this.wo.fi(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].xs(e,t);return t}))},t.prototype.Xo=function(t,e,n){var r=ls();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].xs(t,e);r=r.Ht(t,e)})),r},t.prototype.Zo=function(t,e){var n=this;return this.wo.getEntries(t,e).next((function(e){return n.tc(t,e)}))},t.prototype.tc=function(t,e){var n=this;return this.Ho.Si(t,e).next((function(r){var i=n.Xo(t,e,r),o=fs();return i.forEach((function(t,e){e||(e=new Li(t,$r.min())),o=o.Ht(t,e)})),o}))},t.prototype.Wr=function(t,e,n){return function(t){return ri.Et(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.ec(t,e.path):co(e)?this.nc(t,e,n):this.sc(t,e,n)},t.prototype.ec=function(t,e){return this.Jo(t,new ri(e)).next((function(t){var e=ds();return t instanceof Pi&&(e=e.Ht(t.key,t)),e}))},t.prototype.nc=function(t,e,n){var r=this,i=e.collectionGroup,o=ds();return this.Ti.Qs(t,i).next((function(s){return hu.forEach(s,(function(s){var u=function(t,e){return new no(e,null,t.Nt.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.sc(t,u,n).next((function(t){t.forEach((function(t,e){o=o.Ht(t,e)}))}))})).next((function(){return o}))}))},t.prototype.sc=function(t,e,n){var r,i,o=this;return this.wo.Wr(t,e,n).next((function(n){return r=n,o.Ho.Ci(t,e)})).next((function(e){return i=e,o.ic(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,u=o.mutations;s<u.length;s++){var a=u[s],c=a.key,h=zo(a,r.get(c),0,o.Ss);r=h instanceof Pi?r.Ht(c,h):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){go(e,n)||(r=r.remove(t))})),r}))},t.prototype.ic=function(t,e,n){for(var r=gs(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Jo&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.wo.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof Pi&&(c=c.Ht(t,e))})),c}))},t}(),Xa=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.rc=n,this.oc=r}return t.cc=function(e,n){for(var r=gs(),i=gs(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Ya=function(){function t(){}return t.prototype.ac=function(t){this.uc=t},t.prototype.Wr=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.Nt.length||1===t.Nt.length&&t.Nt[0].field.ht())}(e)||n.isEqual($r.min())?this.hc(t,e):this.uc.Zo(t,r).next((function(o){var s=i.lc(e,o);return(oo(e)||so(e))&&i._c(e.limitType,s,r,n)?i.hc(t,e):(Ir()<=f.DEBUG&&_r("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),yo(e)),i.uc.Wr(t,e,n).next((function(t){return s.forEach((function(e){t=t.Ht(e.key,e)})),t})))}))},t.prototype.lc=function(t,e){var n=new as(mo(t));return e.forEach((function(e,r){r instanceof Pi&&go(t,r)&&(n=n.add(r))})),n},t.prototype._c=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.u(r)>0)},t.prototype.hc=function(t,e){return Ir()<=f.DEBUG&&_r("QueryEngine","Using full collection scan to execute query:",yo(e)),this.uc.Wr(t,e,$r.min())},t}(),Qa=function(){function t(t,e,n,r){this.persistence=t,this.fc=e,this.Kt=r,this.dc=new os(Or),this.wc=new ya((function(t){return Ui(t)}),Fi),this.Ec=$r.min(),this.Ho=t.Ko(n),this.Tc=t.Or(),this.fo=t.Dr(),this.Ic=new Wa(this.Tc,this.Ho,this.persistence.Wo()),this.Eo=t.jo(),this.fc.ac(this.Ic)}return t.prototype.mr=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.pr(n,e.dc)}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $a(t,e,n,r){return new Qa(t,e,n,r)}function Za(t,r){return e(this,void 0,void 0,(function(){var e,i,o,s;return n(this,(function(n){switch(n.label){case 0:return e=xr(t),i=e.Ho,o=e.Ic,[4,e.persistence.runTransaction("Handle user change","readonly",(function(t){var n;return e.Ho.bi(t).next((function(s){return n=s,i=e.persistence.Ko(r),o=new Wa(e.Tc,i,e.persistence.Wo()),i.bi(t)})).next((function(e){for(var r=[],i=[],s=gs(),u=0,a=n;u<a.length;u++){var c=a[u];r.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];s=s.add(l.key)}}for(var p=0,d=e;p<d.length;p++){var v=d[p];i.push(v.batchId);for(var y=0,g=v.mutations;y<g.length;y++){var m=g[y];s=s.add(m.key)}}return o.Zo(t,s).next((function(t){return{mc:t,Ac:r,Rc:i}}))}))}))];case 1:return s=n.sent(),[2,(e.Ho=i,e.Ic=o,e.fc.ac(e.Ic),s)]}}))}))}function tc(t,e){var n=xr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.Tc.Fr({jr:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=hu.resolve();return o.forEach((function(t){s=s.next((function(){return r.fi(e,t)})).next((function(e){var o=e,s=n.Os.get(t);Sr(null!==s),(!o||o.version.u(s)<0)&&(o=i.Ds(t,o,n))&&r.ui(o,n.Fs)}))})),s.next((function(){return t.Ho.xi(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n.Ho.Oi(t)})).next((function(){return n.Ic.Zo(t,r)}))}))}function ec(t){var e=xr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.fo.Ki(t)}))}function nc(t,e){var n=xr(t),r=e.Mt,i=n.dc;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.Tc.Fr({jr:!0});i=n.dc;var s=[];e.Oe.forEach((function(e,o){var u=i.get(o);if(u){s.push(n.fo.ir(t,e.Ke,o).next((function(){return n.fo.nr(t,e.Ue,o)})));var a=e.resumeToken;if(a.o()>0){var c=u.$t(a,r).Lt(t.vs);i=i.Ht(o,c),function(t,e,n){return Sr(e.resumeToken.o()>0),0===t.resumeToken.o()||e.Mt.j()-t.Mt.j()>=3e8||n.Ue.size+n.Qe.size+n.Ke.size>0}(u,c,e)&&s.push(n.fo.Ji(t,c))}}}));var u=fs();if(e.Me.forEach((function(r,i){e.Le.has(r)&&s.push(n.persistence.Ii.kr(t,r))})),s.push(function(t,e,n,r,i){var o=gs();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=fs();return n.forEach((function(n,s){var u=t.get(n),a=(null==i?void 0:i.get(n))||r;s instanceof Li&&s.version.isEqual($r.min())?(e._i(n,a),o=o.Ht(n,s)):null==u||s.version.u(u.version)>0||0===s.version.u(u.version)&&u.hasPendingWrites?(e.ui(s,a),o=o.Ht(n,s)):_r("LocalStore","Ignoring outdated watch update for ",n,". Current version:",u.version," Watch version:",s.version)})),o}))}(t,o,e.Me,r,void 0).next((function(t){u=t}))),!r.isEqual($r.min())){var a=n.fo.Ki(t).next((function(e){return n.fo.ji(t,t.vs,r)}));s.push(a)}return hu.$n(s).next((function(){return o.apply(t)})).next((function(){return n.Ic.tc(t,u)}))})).then((function(t){return n.dc=i,t}))}function rc(t,e){var n=xr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n.Ho.Vi(t,e)}))}function ic(t,e){var n=xr(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.fo.er(t,e).next((function(i){return i?(r=i,hu.resolve(r)):n.fo.qi(t).next((function(i){return r=new bo(e,i,0,t.vs),n.fo.Gi(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.dc.get(t.targetId);return(null===r||t.Mt.u(r.Mt)>0)&&(n.dc=n.dc.Ht(t.targetId,t),n.wc.set(e,t.targetId)),t}))}function oc(t,r,i){return e(this,void 0,void 0,(function(){var e,o,s,u;return n(this,(function(n){switch(n.label){case 0:e=xr(t),o=e.dc.get(r),s=i?"readwrite":"readwrite-primary",n.label=1;case 1:return n.trys.push([1,4,,5]),i?[3,3]:[4,e.persistence.runTransaction("Release target",s,(function(t){return e.persistence.Ii.removeTarget(t,o)}))];case 2:n.sent(),n.label=3;case 3:return[3,5];case 4:if(!vu(u=n.sent()))throw u;return _r("LocalStore","Failed to update sequence numbers for target "+r+": "+u),[3,5];case 5:return e.dc=e.dc.remove(r),e.wc.delete(o.target),[2]}}))}))}function sc(t,e,n){var r=xr(t),i=$r.min(),o=gs();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=xr(t),i=r.wc.get(n);return void 0!==i?hu.resolve(r.dc.get(i)):r.fo.er(e,n)}(r,t,fo(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.fo.cr(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.fc.Wr(t,e,n?i:$r.min(),n?o:gs())})).next((function(t){return{documents:t,Pc:o}}))}))}function uc(t,e){var n=xr(t),r=xr(n.fo),i=n.dc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.Dn(t,e).next((function(t){return t?t.target:null}))}))}function ac(t){var e=xr(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=xr(t),i=fs(),o=$u(n),s=Fa(e),u=IDBKeyRange.lowerBound(o,!0);return s.ls({index:Ru.readTimeIndex,range:u},(function(t,e){var n=Yu(r.Kt,e);i=i.Ht(n.key,n),o=e.readTime})).next((function(){return{zo:i,readTime:Zu(o)}}))}(e.Tc,t,e.Ec)})).then((function(t){var n=t.zo,r=t.readTime;return e.Ec=r,n}))}function cc(t){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){return[2,(e=xr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=Fa(t),n=$r.min();return e.ls({index:Ru.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Zu(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.Ec=t}))]}))}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var hc=function(){function t(t){this.Kt=t,this.bc=new Map,this.vc=new Map}return t.prototype.Ms=function(t,e){return hu.resolve(this.bc.get(e))},t.prototype.Ls=function(t,e){var n;return this.bc.set(e.id,{id:(n=e).id,version:n.version,createTime:Us(n.createTime)}),hu.resolve()},t.prototype.$s=function(t,e){return hu.resolve(this.vc.get(e))},t.prototype.Bs=function(t,e){return this.vc.set(e.name,function(t){return{name:t.name,query:oa(t.bundledQuery),readTime:Us(t.readTime)}}(e)),hu.resolve()},t}(),fc=function(){function t(){this.Sc=new as(lc.Dc),this.Cc=new as(lc.xc)}return t.prototype.nt=function(){return this.Sc.nt()},t.prototype.sr=function(t,e){var n=new lc(t,e);this.Sc=this.Sc.add(n),this.Cc=this.Cc.add(n)},t.prototype.Nc=function(t,e){var n=this;t.forEach((function(t){return n.sr(t,e)}))},t.prototype.rr=function(t,e){this.Fc(new lc(t,e))},t.prototype.Oc=function(t,e){var n=this;t.forEach((function(t){return n.rr(t,e)}))},t.prototype.kc=function(t){var e=this,n=new ri(new ti([])),r=new lc(n,t),i=new lc(n,t+1),o=[];return this.Cc.Ae([r,i],(function(t){e.Fc(t),o.push(t.key)})),o},t.prototype.Mc=function(){var t=this;this.Sc.forEach((function(e){return t.Fc(e)}))},t.prototype.Fc=function(t){this.Sc=this.Sc.delete(t),this.Cc=this.Cc.delete(t)},t.prototype.Lc=function(t){var e=new ri(new ti([])),n=new lc(e,t),r=new lc(e,t+1),i=gs();return this.Cc.Ae([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.ki=function(t){var e=new lc(t,0),n=this.Sc.Pe(e);return null!==n&&t.isEqual(n.key)},t}(),lc=function(){function t(t,e){this.key=t,this.$c=e}return t.Dc=function(t,e){return ri.J(t.key,e.key)||Or(t.$c,e.$c)},t.xc=function(t,e){return Or(t.$c,e.$c)||ri.J(t.key,e.key)},t}(),pc=function(){function t(t,e){this.Ti=t,this.Ii=e,this.Ho=[],this.Bc=1,this.qc=new as(lc.Dc)}return t.prototype.Ri=function(t){return hu.resolve(0===this.Ho.length)},t.prototype.Pi=function(t,e,n,r){var i=this.Bc;this.Bc++,this.Ho.length>0&&this.Ho[this.Ho.length-1];var o=new Ju(i,e,n,r);this.Ho.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.qc=this.qc.add(new lc(a.key,i)),this.Ti.Us(t,a.key.path.Z())}return hu.resolve(o)},t.prototype.yi=function(t,e){return hu.resolve(this.Uc(e))},t.prototype.Vi=function(t,e){var n=e+1,r=this.Qc(n),i=r<0?0:r;return hu.resolve(this.Ho.length>i?this.Ho[i]:null)},t.prototype.pi=function(){return hu.resolve(0===this.Ho.length?-1:this.Bc-1)},t.prototype.bi=function(t){return hu.resolve(this.Ho.slice())},t.prototype.vi=function(t,e){var n=this,r=new lc(e,0),i=new lc(e,Number.POSITIVE_INFINITY),o=[];return this.qc.Ae([r,i],(function(t){var e=n.Uc(t.$c);o.push(e)})),hu.resolve(o)},t.prototype.Si=function(t,e){var n=this,r=new as(Or);return e.forEach((function(t){var e=new lc(t,0),i=new lc(t,Number.POSITIVE_INFINITY);n.qc.Ae([e,i],(function(t){r=r.add(t.$c)}))})),hu.resolve(this.Kc(r))},t.prototype.Ci=function(t,e){var n=e.path,r=n.length+1,i=n;ri.Et(i)||(i=i.child(""));var o=new lc(new ri(i),0),s=new as(Or);return this.qc.Re((function(t){var e=t.key.path;return!!n.st(e)&&(e.length===r&&(s=s.add(t.$c)),!0)}),o),hu.resolve(this.Kc(s))},t.prototype.Kc=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.Uc(t);null!==r&&n.push(r)})),n},t.prototype.xi=function(t,e){var n=this;Sr(0===this.Wc(e.batchId,"removed")),this.Ho.shift();var r=this.qc;return hu.forEach(e.mutations,(function(i){var o=new lc(i.key,e.batchId);return r=r.delete(o),n.Ii.Fi(t,i.key)})).next((function(){n.qc=r}))},t.prototype.Ni=function(t){},t.prototype.ki=function(t,e){var n=new lc(e,0),r=this.qc.Pe(n);return hu.resolve(e.isEqual(r&&r.key))},t.prototype.Oi=function(t){return this.Ho.length,hu.resolve()},t.prototype.Wc=function(t,e){return this.Qc(t)},t.prototype.Qc=function(t){return 0===this.Ho.length?0:t-this.Ho[0].batchId},t.prototype.Uc=function(t){var e=this.Qc(t);return e<0||e>=this.Ho.length?null:this.Ho[e]},t}(),dc=function(){function t(t,e){this.Ti=t,this.jc=e,this.docs=new os(ri.J),this.size=0}return t.prototype.ui=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.jc(e);return this.docs=this.docs.Ht(r,{li:e,size:s,readTime:n}),this.size+=s-o,this.Ti.Us(t,r.path.Z())},t.prototype._i=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.fi=function(t,e){var n=this.docs.get(e);return hu.resolve(n?n.li:null)},t.prototype.getEntries=function(t,e){var n=this,r=ls();return e.forEach((function(t){var e=n.docs.get(t);r=r.Ht(t,e?e.li:null)})),hu.resolve(r)},t.prototype.Wr=function(t,e,n){for(var r=ds(),i=new ri(e.path.child("")),o=this.docs.ne(i);o.ae();){var s=o.ce(),u=s.key,a=s.value,c=a.li,h=a.readTime;if(!e.path.st(u.path))break;h.u(n)<=0||c instanceof Pi&&go(e,c)&&(r=r.Ht(c.key,c))}return hu.resolve(r)},t.prototype.Gc=function(t,e){return hu.forEach(this.docs,(function(t){return e(t)}))},t.prototype.Fr=function(t){return new vc(this)},t.prototype.Mr=function(t){return hu.resolve(this.size)},t}(),vc=function(e){function n(t){var n=this;return(n=e.call(this)||this).Gr=t,n}return t(n,e),n.prototype.Ei=function(t){var e=this,n=[];return this.oi.forEach((function(r,i){i&&i.li?n.push(e.Gr.ui(t,i.li,e.ai(r))):e.Gr._i(r)})),hu.$n(n)},n.prototype.di=function(t,e){return this.Gr.fi(t,e)},n.prototype.wi=function(t,e){return this.Gr.getEntries(t,e)},n}(ga),yc=function(){function t(t){this.persistence=t,this.zc=new ya((function(t){return Ui(t)}),Fi),this.lastRemoteSnapshotVersion=$r.min(),this.highestTargetId=0,this.Hc=0,this.Jc=new fc,this.targetCount=0,this.Yc=Na.$i()}return t.prototype.mn=function(t,e){return this.zc.forEach((function(t,n){return e(n)})),hu.resolve()},t.prototype.Ki=function(t){return hu.resolve(this.lastRemoteSnapshotVersion)},t.prototype.Wi=function(t){return hu.resolve(this.Hc)},t.prototype.qi=function(t){return this.highestTargetId=this.Yc.next(),hu.resolve(this.highestTargetId)},t.prototype.ji=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Hc&&(this.Hc=e),hu.resolve()},t.prototype.zi=function(t){this.zc.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Yc=new Na(e),this.highestTargetId=e),t.sequenceNumber>this.Hc&&(this.Hc=t.sequenceNumber)},t.prototype.Gi=function(t,e){return this.zi(e),this.targetCount+=1,hu.resolve()},t.prototype.Ji=function(t,e){return this.zi(e),hu.resolve()},t.prototype.Yi=function(t,e){return this.zc.delete(e.target),this.Jc.kc(e.targetId),this.targetCount-=1,hu.resolve()},t.prototype.Zi=function(t,e,n){var r=this,i=0,o=[];return this.zc.forEach((function(s,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.zc.delete(s),o.push(r.Xi(t,u.targetId)),i++)})),hu.$n(o).next((function(){return i}))},t.prototype.tr=function(t){return hu.resolve(this.targetCount)},t.prototype.er=function(t,e){var n=this.zc.get(e)||null;return hu.resolve(n)},t.prototype.nr=function(t,e,n){return this.Jc.Nc(e,n),hu.resolve()},t.prototype.ir=function(t,e,n){this.Jc.Oc(e,n);var r=this.persistence.Ii,i=[];return r&&e.forEach((function(e){i.push(r.Fi(t,e))})),hu.$n(i)},t.prototype.Xi=function(t,e){return this.Jc.kc(e),hu.resolve()},t.prototype.cr=function(t,e){var n=this.Jc.Lc(e);return hu.resolve(n)},t.prototype.ki=function(t,e){return hu.resolve(this.Jc.ki(e))},t}(),gc=function(){function t(t,e){var n=this;this.Xc={},this.io=new Yr(0),this.ro=!1,this.ro=!0,this.Ii=t(this),this.fo=new yc(this),this.Ti=new ca,this.wo=function(t,e){return new dc(t,(function(t){return n.Ii.Zc(t)}))}(this.Ti),this.Kt=new Xu(e),this.Eo=new hc(this.Kt)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.Lo=function(){return this.ro=!1,Promise.resolve()},Object.defineProperty(t.prototype,"Tr",{get:function(){return this.ro},enumerable:!1,configurable:!0}),t.prototype.yo=function(){},t.prototype.Vo=function(){},t.prototype.Wo=function(){return this.Ti},t.prototype.Ko=function(t){var e=this.Xc[t.R()];return e||(e=new pc(this.Ti,this.Ii),this.Xc[t.R()]=e),e},t.prototype.Dr=function(){return this.fo},t.prototype.Or=function(){return this.wo},t.prototype.jo=function(){return this.Eo},t.prototype.runTransaction=function(t,e,n){var r=this;_r("MemoryPersistence","Starting transaction:",t);var i=new mc(this.io.next());return this.Ii.ta(),n(i).next((function(t){return r.Ii.ea(i).next((function(){return t}))})).Mn().then((function(t){return i.ps(),t}))},t.prototype.na=function(t,e){return hu.Bn(Object.values(this.Xc).map((function(n){return function(){return n.ki(t,e)}})))},t}(),mc=function(e){function n(t){var n=this;return(n=e.call(this)||this).vs=t,n}return t(n,e),n}(Eu),wc=function(){function t(t){this.persistence=t,this.sa=new fc,this.ia=null}return t.ra=function(e){return new t(e)},Object.defineProperty(t.prototype,"oa",{get:function(){if(this.ia)return this.ia;throw Ar()},enumerable:!1,configurable:!0}),t.prototype.sr=function(t,e,n){return this.sa.sr(n,e),this.oa.delete(n.toString()),hu.resolve()},t.prototype.rr=function(t,e,n){return this.sa.rr(n,e),this.oa.add(n.toString()),hu.resolve()},t.prototype.Fi=function(t,e){return this.oa.add(e.toString()),hu.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.sa.kc(e.targetId).forEach((function(t){return n.oa.add(t.toString())}));var r=this.persistence.Dr();return r.cr(t,e.targetId).next((function(t){t.forEach((function(t){return n.oa.add(t.toString())}))})).next((function(){return r.Yi(t,e)}))},t.prototype.ta=function(){this.ia=new Set},t.prototype.ea=function(t){var e=this,n=this.persistence.Or().Fr();return hu.forEach(this.oa,(function(r){var i=ri.ft(r);return e.ca(t,i).next((function(t){t||n._i(i)}))})).next((function(){return e.ia=null,n.apply(t)}))},t.prototype.kr=function(t,e){var n=this;return this.ca(t,e).next((function(t){t?n.oa.delete(e.toString()):n.oa.add(e.toString())}))},t.prototype.Zc=function(t){return 0},t.prototype.ca=function(t,e){var n=this;return hu.Bn([function(){return hu.resolve(n.sa.ki(e))},function(){return n.persistence.Dr().ki(t,e)},function(){return n.persistence.na(t,e)}])},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bc(t,e){return"firestore_clients_"+t+"_"+e}function Ic(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.A()&&(r+="_"+e.uid),r}function _c(t,e){return"firestore_targets_"+t+"_"+e}var Ec=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.aa=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),s=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(s=new Vr(i.error.code,i.error.message)),o?new t(e,n,i.state,s):(Er("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.ua=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Tc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.aa=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Vr(r.error.code,r.error.message)),i?new t(e,r.state,o):(Er("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.ua=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Nc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.aa=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=ws(),s=0;i&&s<r.activeTargetIds.length;++s)i=yi(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Er("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Ac=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.aa=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Er("SharedClientState","Failed to parse online state: "+e),null)},t}(),Sc=function(){function t(){this.activeTargetIds=ws()}return t.prototype.ha=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.la=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.ua=function(){var t={activeTargetIds:this.activeTargetIds.rt(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),xc=function(){function t(t,e,n,r,i){this.window=t,this.eo=e,this.persistenceKey=n,this._a=r,this.fa=null,this.da=null,this.L=null,this.wa=this.Ea.bind(this),this.Ta=new os(Or),this.Tr=!1,this.Ia=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ma=bc(this.persistenceKey,this._a),this.Aa=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Ta=this.Ta.Ht(this._a,new Sc),this.Ra=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Pa=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.ya=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.ga=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Va=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.wa)}return t.Wn=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return e(this,void 0,void 0,(function(){var t,e,r,i,o,s,u,a,c,h,f,l=this;return n(this,(function(n){switch(n.label){case 0:return[4,this.fa.Qo()];case 1:for(t=n.sent(),e=0,r=t;e<r.length;e++)(i=r[e])!==this._a&&(o=this.getItem(bc(this.persistenceKey,i)))&&(s=Nc.aa(i,o))&&(this.Ta=this.Ta.Ht(s.clientId,s));for(this.pa(),(u=this.storage.getItem(this.ga))&&(a=this.ba(u))&&this.va(a),c=0,h=this.Ia;c<h.length;c++)f=h[c],this.Ea(f);return this.Ia=[],this.window.addEventListener("unload",(function(){return l.Lo()})),this.Tr=!0,[2]}}))}))},t.prototype.q=function(t){this.setItem(this.Aa,JSON.stringify(t))},t.prototype.Sa=function(){return this.Da(this.Ta)},t.prototype.Ca=function(t){var e=!1;return this.Ta.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.xa=function(t){this.Na(t,"pending")},t.prototype.Fa=function(t,e,n){this.Na(t,e,n),this.Oa(t)},t.prototype.ka=function(t){var e="not-current";if(this.Ca(t)){var n=this.storage.getItem(_c(this.persistenceKey,t));if(n){var r=Tc.aa(t,n);r&&(e=r.state)}}return this.Ma.ha(t),this.pa(),e},t.prototype.La=function(t){this.Ma.la(t),this.pa()},t.prototype.$a=function(t){return this.Ma.activeTargetIds.has(t)},t.prototype.Ba=function(t){this.removeItem(_c(this.persistenceKey,t))},t.prototype.qa=function(t,e,n){this.Ua(t,e,n)},t.prototype.Qa=function(t,e,n){var r=this;e.forEach((function(t){r.Oa(t)})),this.currentUser=t,n.forEach((function(t){r.xa(t)}))},t.prototype.Ka=function(t){this.Wa(t)},t.prototype.ja=function(){this.Ga()},t.prototype.Lo=function(){this.Tr&&(this.window.removeEventListener("storage",this.wa),this.removeItem(this.ma),this.Tr=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return _r("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){_r("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){_r("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Ea=function(t){var r=this,i=t;if(i.storageArea===this.storage){if(_r("SharedClientState","EVENT",i.key,i.newValue),i.key===this.ma)return void Er("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.eo.bo((function(){return e(r,void 0,void 0,(function(){var t,e,r,o,s,u;return n(this,(function(n){if(this.Tr){if(null!==i.key)if(this.Ra.test(i.key)){if(null==i.newValue)return t=this.za(i.key),[2,this.Ha(t,null)];if(e=this.Ja(i.key,i.newValue))return[2,this.Ha(e.clientId,e)]}else if(this.Pa.test(i.key)){if(null!==i.newValue&&(r=this.Ya(i.key,i.newValue)))return[2,this.Xa(r)]}else if(this.ya.test(i.key)){if(null!==i.newValue&&(o=this.Za(i.key,i.newValue)))return[2,this.tu(o)]}else if(i.key===this.ga){if(null!==i.newValue&&(s=this.ba(i.newValue)))return[2,this.va(s)]}else if(i.key===this.Aa)(u=function(t){var e=Yr.U;if(null!=t)try{var n=JSON.parse(t);Sr("number"==typeof n),e=n}catch(t){Er("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(i.newValue))!==Yr.U&&this.L(u);else if(i.key===this.Va)return[2,this.fa.eu()]}else this.Ia.push(i);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Ma",{get:function(){return this.Ta.get(this._a)},enumerable:!1,configurable:!0}),t.prototype.pa=function(){this.setItem(this.ma,this.Ma.ua())},t.prototype.Na=function(t,e,n){var r=new Ec(this.currentUser,t,e,n),i=Ic(this.persistenceKey,this.currentUser,t);this.setItem(i,r.ua())},t.prototype.Oa=function(t){var e=Ic(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Wa=function(t){var e={clientId:this._a,onlineState:t};this.storage.setItem(this.ga,JSON.stringify(e))},t.prototype.Ua=function(t,e,n){var r=_c(this.persistenceKey,t),i=new Tc(t,e,n);this.setItem(r,i.ua())},t.prototype.Ga=function(){this.setItem(this.Va,"value-not-used")},t.prototype.za=function(t){var e=this.Ra.exec(t);return e?e[1]:null},t.prototype.Ja=function(t,e){var n=this.za(t);return Nc.aa(n,e)},t.prototype.Ya=function(t,e){var n=this.Pa.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Ec.aa(new Hr(i),r,e)},t.prototype.Za=function(t,e){var n=this.ya.exec(t),r=Number(n[1]);return Tc.aa(r,e)},t.prototype.ba=function(t){return Ac.aa(t)},t.prototype.Xa=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.fa.nu(t.batchId,t.state,t.error)]:(_r("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.tu=function(t){return this.fa.su(t.targetId,t.state,t.error)},t.prototype.Ha=function(t,e){var n=this,r=e?this.Ta.Ht(t,e):this.Ta.remove(t),i=this.Da(this.Ta),o=this.Da(r),s=[],u=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||u.push(t)})),this.fa.iu(s,u).then((function(){n.Ta=r}))},t.prototype.va=function(t){this.Ta.get(t.clientId)&&this.da(t.onlineState)},t.prototype.Da=function(t){var e=ws();return t.forEach((function(t,n){e=e.ye(n.activeTargetIds)})),e},t}(),Dc=function(){function t(){this.ru=new Sc,this.ou={},this.da=null,this.L=null}return t.prototype.xa=function(t){},t.prototype.Fa=function(t,e,n){},t.prototype.ka=function(t){return this.ru.ha(t),this.ou[t]||"not-current"},t.prototype.qa=function(t,e,n){this.ou[t]=e},t.prototype.La=function(t){this.ru.la(t)},t.prototype.$a=function(t){return this.ru.activeTargetIds.has(t)},t.prototype.Ba=function(t){delete this.ou[t]},t.prototype.Sa=function(){return this.ru.activeTargetIds},t.prototype.Ca=function(t){return this.ru.activeTargetIds.has(t)},t.prototype.start=function(){return this.ru=new Sc,Promise.resolve()},t.prototype.Qa=function(t,e,n){},t.prototype.Ka=function(t){},t.prototype.Lo=function(){},t.prototype.q=function(t){},t.prototype.ja=function(){},t}(),kc=function(){function t(){}return t.prototype.cu=function(t){},t.prototype.Lo=function(){},t}(),Oc=function(){function t(){var t=this;this.au=function(){return t.uu()},this.hu=function(){return t.lu()},this._u=[],this.fu()}return t.prototype.cu=function(t){this._u.push(t)},t.prototype.Lo=function(){window.removeEventListener("online",this.au),window.removeEventListener("offline",this.hu)},t.prototype.fu=function(){window.addEventListener("online",this.au),window.addEventListener("offline",this.hu)},t.prototype.uu=function(){_r("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this._u;t<e.length;t++)(0,e[t])(0)},t.prototype.lu=function(){_r("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this._u;t<e.length;t++)(0,e[t])(1)},t.Wn=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Cc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Pc=function(){function t(t){this.du=t.du,this.wu=t.wu}return t.prototype.Eu=function(t){this.Tu=t},t.prototype.Iu=function(t){this.mu=t},t.prototype.onMessage=function(t){this.Au=t},t.prototype.close=function(){this.wu()},t.prototype.send=function(t){this.du(t)},t.prototype.Ru=function(){this.Tu()},t.prototype.Pu=function(t){this.mu(t)},t.prototype.yu=function(t){this.Au(t)},t}(),Lc=function(e){function n(t){var n=this;return(n=e.call(this,t)||this).forceLongPolling=t.forceLongPolling,n.I=t.I,n}return t(n,e),n.prototype.Du=function(t,e,n,r){return new Promise((function(i,o){var s=new wr;s.listenOnce(dr.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case pr.NO_ERROR:var e=s.getResponseJson();_r("Connection","XHR received:",JSON.stringify(e)),i(e);break;case pr.TIMEOUT:_r("Connection",'RPC "'+t+'" timed out'),o(new Vr(Rr.DEADLINE_EXCEEDED,"Request time out"));break;case pr.HTTP_ERROR:var n=s.getStatus();if(_r("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var u=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(Rr).indexOf(e)>=0?e:Rr.UNKNOWN}(r.status);o(new Vr(u,r.message))}else o(new Vr(Rr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Vr(Rr.UNAVAILABLE,"Connection failed."));break;default:Ar()}}finally{_r("Connection",'RPC "'+t+'" completed.')}}));var u=JSON.stringify(r);s.send(e,"POST",u,n,15)}))},n.prototype.xu=function(t,e){var n=[this.Vu,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new ar,i=ce(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.T.projectId+"/databases/"+this.T.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.I};this.Su(f.initMessageHeaders,e),o()||s()||u()||a()||c()||h()||(f.httpHeadersOverwriteParam="$httpHeaders");var l=n.join("");_r("Connection","Creating WebChannel: "+l,f);var p=r.createWebChannel(l,f),d=!1,v=!1,y=new Pc({du:function(t){v?_r("Connection","Not sending because WebChannel is closed:",t):(d||(_r("Connection","Opening WebChannel transport."),p.open(),d=!0),_r("Connection","WebChannel sending:",t),p.send(t))},wu:function(){return p.close()}}),g=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return g(p,mr.EventType.OPEN,(function(){v||_r("Connection","WebChannel transport opened.")})),g(p,mr.EventType.CLOSE,(function(){v||(v=!0,_r("Connection","WebChannel transport closed"),y.Pu())})),g(p,mr.EventType.ERROR,(function(t){v||(v=!0,Tr("Connection","WebChannel transport errored:",t),y.Pu(new Vr(Rr.UNAVAILABLE,"The operation could not be completed")))})),g(p,mr.EventType.MESSAGE,(function(t){var e;if(!v){var n=t.data[0];Sr(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){_r("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=$o[t];if(void 0!==e)return is(e)}(o),u=i.message;void 0===s&&(s=Rr.INTERNAL,u="Unknown error status: "+o+" with message "+i.message),v=!0,y.Pu(new Vr(s,u)),p.close()}else _r("Connection","WebChannel received:",n),y.yu(n)}})),g(i,vr.STAT_EVENT,(function(t){t.stat===yr?_r("Connection","Detected buffering proxy"):t.stat===gr&&_r("Connection","Detected no buffering proxy")})),setTimeout((function(){y.Ru()}),0),y},n}(function(){function t(t){this.gu=t,this.T=t.T;var e=t.ssl?"https":"http";this.Vu=e+"://"+t.host,this.pu="projects/"+this.T.projectId+"/databases/"+this.T.database+"/documents"}return t.prototype.bu=function(t,e,n,r){var i=this.vu(t,e);_r("RestConnection","Sending: ",i,n);var o={};return this.Su(o,r),this.Du(t,i,o,n).then((function(t){return _r("RestConnection","Received: ",t),t}),(function(e){throw Tr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Cu=function(t,e,n,r){return this.bu(t,e,n,r)},t.prototype.Su=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.2.4",t["Content-Type"]="text/plain",e)for(var n in e.V)e.V.hasOwnProperty(n)&&(t[n]=e.V[n])},t.prototype.vu=function(t,e){var n=Cc[t];return this.Vu+"/v1/"+e+":"+n},t}());
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rc(){return"undefined"!=typeof window?window:null}function Vc(){return"undefined"!=typeof document?document:null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mc(t){return new Ls(t,!0)}var Uc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.eo=t,this.ds=e,this.Nu=n,this.Fu=r,this.Ou=i,this.ku=0,this.Mu=null,this.Lu=Date.now(),this.reset()}return t.prototype.reset=function(){this.ku=0},t.prototype.$u=function(){this.ku=this.Ou},t.prototype.Bu=function(t){var e=this;this.cancel();var n=Math.floor(this.ku+this.qu()),r=Math.max(0,Date.now()-this.Lu),i=Math.max(0,n-r);i>0&&_r("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.ku+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Mu=this.eo.Ir(this.ds,i,(function(){return e.Lu=Date.now(),t()})),this.ku*=this.Fu,this.ku<this.Nu&&(this.ku=this.Nu),this.ku>this.Ou&&(this.ku=this.Ou)},t.prototype.Uu=function(){null!==this.Mu&&(this.Mu.Ps(),this.Mu=null)},t.prototype.cancel=function(){null!==this.Mu&&(this.Mu.cancel(),this.Mu=null)},t.prototype.qu=function(){return(Math.random()-.5)*this.ku},t}(),Fc=function(){function t(t,e,n,r,i,o){this.eo=t,this.Qu=n,this.Ku=r,this.Wu=i,this.listener=o,this.state=0,this.ju=0,this.Gu=null,this.stream=null,this.zu=new Uc(t,e)}return t.prototype.Hu=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.Ju=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.Yu()},t.prototype.stop=function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return this.Hu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.Xu=function(){this.state=0,this.zu.reset()},t.prototype.Zu=function(){var t=this;this.Ju()&&null===this.Gu&&(this.Gu=this.eo.Ir(this.Qu,6e4,(function(){return t.th()})))},t.prototype.eh=function(t){this.nh(),this.stream.send(t)},t.prototype.th=function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){return this.Ju()?[2,this.close(0)]:[2]}))}))},t.prototype.nh=function(){this.Gu&&(this.Gu.cancel(),this.Gu=null)},t.prototype.close=function(t,r){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this.nh(),this.zu.cancel(),this.ju++,3!==t?this.zu.reset():r&&r.code===Rr.RESOURCE_EXHAUSTED?(Er(r.toString()),Er("Using maximum backoff delay to prevent overloading the backend."),this.zu.$u()):r&&r.code===Rr.UNAUTHENTICATED&&this.Wu.v(),null!==this.stream&&(this.sh(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Iu(r)];case 1:return e.sent(),[2]}}))}))},t.prototype.sh=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.ih(this.ju),n=this.ju;this.Wu.getToken().then((function(e){t.ju===n&&t.rh(e)}),(function(n){e((function(){var e=new Vr(Rr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.oh(e)}))}))},t.prototype.rh=function(t){var e=this,n=this.ih(this.ju);this.stream=this.ah(t),this.stream.Eu((function(){n((function(){return e.state=2,e.listener.Eu()}))})),this.stream.Iu((function(t){n((function(){return e.oh(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.Yu=function(){var t=this;this.state=4,this.zu.Bu((function(){return e(t,void 0,void 0,(function(){return n(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.oh=function(t){return _r("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.ih=function(t){var e=this;return function(n){e.eo.ys((function(){return e.ju===t?n():(_r("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),qc=function(e){function n(t,n,r,i,o){var s=this;return(s=e.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).Kt=i,s}return t(n,e),n.prototype.ah=function(t){return this.Ku.xu("Listen",t)},n.prototype.onMessage=function(t){this.zu.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Ar()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.qt?(Sr(void 0===e||"string"==typeof e),Lr.fromBase64String(e||"")):(Sr(void 0===e||e instanceof Uint8Array),Lr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(u=e.targetChange.cause)&&function(t){var e=void 0===t.code?Rr.UNKNOWN:is(t.code);return new Vr(e,t.message||"")}(u);n=new Ss(r,i,o,s||null)}else if("documentChange"in e){e.documentChange,(r=e.documentChange).document,r.document.name,r.document.updateTime,i=zs(t,r.document.name),o=Us(r.document.updateTime);var u=new Di({mapValue:{fields:r.document.fields}}),a=(s=new Pi(i,o,u,{}),r.targetIds||[]),c=r.removedTargetIds||[];n=new Ns(a,c,s.key,s)}else if("documentDelete"in e)e.documentDelete,(r=e.documentDelete).document,i=zs(t,r.document),o=r.readTime?Us(r.readTime):$r.min(),u=new Li(i,o),s=r.removedTargetIds||[],n=new Ns([],s,u.key,u);else if("documentRemove"in e)e.documentRemove,(r=e.documentRemove).document,i=zs(t,r.document),o=r.removedTargetIds||[],n=new Ns([],o,i,null);else{if(!("filter"in e))return Ar();e.filter;var h=e.filter;h.targetId,r=h.count||0,i=new ns(r),o=h.targetId,n=new As(o,i)}return n}(this.Kt,t),n=function(t){if(!("targetChange"in t))return $r.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?$r.min():e.readTime?Us(e.readTime):$r.min()}(t);return this.listener.uh(e,n)},n.prototype.hh=function(t){var e={};e.database=Bs(this.Kt),e.addTarget=function(t,e){var n,r=e.target;return(n=qi(r)?{documents:Ys(t,r)}:{query:Qs(t,r)}).targetId=e.targetId,e.resumeToken.o()>0?n.resumeToken=Vs(t,e.resumeToken):e.Mt.u($r.min())>0&&(n.readTime=Rs(t,e.Mt.G())),n}(this.Kt,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ar()}}(0,e.kt);return null==n?null:{"goog-listen-tags":n}}(this.Kt,t);n&&(e.labels=n),this.eh(e)},n.prototype.lh=function(t){var e={};e.database=Bs(this.Kt),e.removeTarget=t,this.eh(e)},n}(Fc),jc=function(e){function n(t,n,r,i,o){var s=this;return(s=e.call(this,t,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).Kt=i,s._h=!1,s}return t(n,e),Object.defineProperty(n.prototype,"fh",{get:function(){return this._h},enumerable:!1,configurable:!0}),n.prototype.start=function(){this._h=!1,this.lastStreamToken=void 0,e.prototype.start.call(this)},n.prototype.sh=function(){this._h&&this.dh([])},n.prototype.ah=function(t){return this.Ku.xu("Write",t)},n.prototype.onMessage=function(t){if(Sr(!!t.streamToken),this.lastStreamToken=t.streamToken,this._h){this.zu.reset();var e=function(t,e){return t&&t.length>0?(Sr(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?Us(t.updateTime):Us(e);n.isEqual($r.min())&&(n=Us(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new Mo(n,r)}(t,e)}))):[]}(t.writeResults,t.commitTime),n=Us(t.commitTime);return this.listener.wh(n,e)}return Sr(!t.writeResults||0===t.writeResults.length),this._h=!0,this.listener.Eh()},n.prototype.Th=function(){var t={};t.database=Bs(this.Kt),this.eh(t)},n.prototype.dh=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Ws(e.Kt,t)}))};this.eh(n)},n}(Fc),zc=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).credentials=t,i.Ku=n,i.Kt=r,i.Ih=!1,i}return t(n,e),n.prototype.mh=function(){if(this.Ih)throw new Vr(Rr.FAILED_PRECONDITION,"The client has already been terminated.")},n.prototype.bu=function(t,e,n){var r=this;return this.mh(),this.credentials.getToken().then((function(i){return r.Ku.bu(t,e,n,i)})).catch((function(t){throw t.code===Rr.UNAUTHENTICATED&&r.credentials.v(),t}))},n.prototype.Cu=function(t,e,n){var r=this;return this.mh(),this.credentials.getToken().then((function(i){return r.Ku.Cu(t,e,n,i)})).catch((function(t){throw t.code===Rr.UNAUTHENTICATED&&r.credentials.v(),t}))},n.prototype.terminate=function(){this.Ih=!1},n}((function(){})),Gc=function(){function t(t,e){this.fs=t,this.da=e,this.state="Unknown",this.Ah=0,this.Rh=null,this.Ph=!0}return t.prototype.yh=function(){var t=this;0===this.Ah&&(this.gh("Unknown"),this.Rh=this.fs.Ir("online_state_timeout",1e4,(function(){return t.Rh=null,t.Vh("Backend didn't respond within 10 seconds."),t.gh("Offline"),Promise.resolve()})))},t.prototype.ph=function(t){"Online"===this.state?this.gh("Unknown"):(this.Ah++,this.Ah>=1&&(this.bh(),this.Vh("Connection failed 1 times. Most recent error: "+t.toString()),this.gh("Offline")))},t.prototype.set=function(t){this.bh(),this.Ah=0,"Online"===t&&(this.Ph=!1),this.gh(t)},t.prototype.gh=function(t){t!==this.state&&(this.state=t,this.da(t))},t.prototype.Vh=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Ph?(Er(e),this.Ph=!1):_r("OnlineStateTracker",e)},t.prototype.bh=function(){null!==this.Rh&&(this.Rh.cancel(),this.Rh=null)},t}(),Hc=function(t,r,i,o,s){var u=this;this.Sh=t,this.Dh=r,this.fs=i,this.Ch={},this.xh=[],this.Nh=new Map,this.Fh=new Set,this.Oh=[],this.kh=s,this.kh.cu((function(t){i.ys((function(){return e(u,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return Zc(this)?(_r("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return(e=xr(t)).Fh.add(4),[4,Kc(e)];case 1:return n.sent(),e.Mh.set("Unknown"),e.Fh.delete(4),[4,Bc(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Mh=new Gc(i,o)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bc(t){return e(this,void 0,void 0,(function(){var e,r;return n(this,(function(n){switch(n.label){case 0:if(!Zc(t))return[3,4];e=0,r=t.Oh,n.label=1;case 1:return e<r.length?[4,(0,r[e])(!0)]:[3,4];case 2:n.sent(),n.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Kc(t){return e(this,void 0,void 0,(function(){var e,r;return n(this,(function(n){switch(n.label){case 0:e=0,r=t.Oh,n.label=1;case 1:return e<r.length?[4,(0,r[e])(!1)]:[3,4];case 2:n.sent(),n.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Jc(t,e){var n=xr(t);n.Nh.has(e.targetId)||(n.Nh.set(e.targetId,e),$c(n)?Qc(n):dh(n).Ju()&&Xc(n,e))}function Wc(t,e){var n=xr(t),r=dh(n);n.Nh.delete(e),r.Ju()&&Yc(n,e),0===n.Nh.size&&(r.Ju()?r.Zu():Zc(n)&&n.Mh.set("Unknown"))}function Xc(t,e){t.Lh.cn(e.targetId),dh(t).hh(e)}function Yc(t,e){t.Lh.cn(e),dh(t).lh(e)}function Qc(t){t.Lh=new Ds({Sn:function(e){return t.Ch.Sn(e)},Dn:function(e){return t.Nh.get(e)||null}}),dh(t).start(),t.Mh.yh()}function $c(t){return Zc(t)&&!dh(t).Hu()&&t.Nh.size>0}function Zc(t){return 0===xr(t).Fh.size}function th(t){t.Lh=void 0}function eh(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){return t.Nh.forEach((function(e,n){Xc(t,e)})),[2]}))}))}function nh(t,r){return e(this,void 0,void 0,(function(){return n(this,(function(e){return th(t),$c(t)?(t.Mh.ph(r),Qc(t)):t.Mh.set("Unknown"),[2]}))}))}function rh(t,r,i){return e(this,void 0,void 0,(function(){var o,s,u;return n(this,(function(a){switch(a.label){case 0:if(t.Mh.set("Online"),!(r instanceof Ss&&2===r.state&&r.cause))return[3,6];a.label=1;case 1:return a.trys.push([1,3,,5]),[4,function(t,r){return e(this,void 0,void 0,(function(){var e,i,o,s;return n(this,(function(n){switch(n.label){case 0:e=r.cause,i=0,o=r.targetIds,n.label=1;case 1:return i<o.length?(s=o[i],t.Nh.has(s)?[4,t.Ch.$h(s,e)]:[3,3]):[3,5];case 2:n.sent(),t.Nh.delete(s),t.Lh.removeTarget(s),n.label=3;case 3:n.label=4;case 4:return i++,[3,1];case 5:return[2]}}))}))}(t,r)];case 2:return a.sent(),[3,5];case 3:return o=a.sent(),_r("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),o),[4,ih(t,o)];case 4:return a.sent(),[3,5];case 5:return[3,13];case 6:if(r instanceof Ns?t.Lh.wn(r):r instanceof As?t.Lh.yn(r):t.Lh.In(r),i.isEqual($r.min()))return[3,13];a.label=7;case 7:return a.trys.push([7,11,,13]),[4,ec(t.Sh)];case 8:return s=a.sent(),i.u(s)>=0?[4,function(t,e){var n=t.Lh.pn(e);return n.Oe.forEach((function(n,r){if(n.resumeToken.o()>0){var i=t.Nh.get(r);i&&t.Nh.set(r,i.$t(n.resumeToken,e))}})),n.ke.forEach((function(e){var n=t.Nh.get(e);if(n){t.Nh.set(e,n.$t(Lr.h,n.Mt)),Yc(t,e);var r=new bo(n.target,e,1,n.sequenceNumber);Xc(t,r)}})),t.Ch.Bh(n)}(t,i)]:[3,10];case 9:a.sent(),a.label=10;case 10:return[3,13];case 11:return _r("RemoteStore","Failed to raise snapshot:",u=a.sent()),[4,ih(t,u)];case 12:return a.sent(),[3,13];case 13:return[2]}}))}))}function ih(t,r,i){return e(this,void 0,void 0,(function(){var o=this;return n(this,(function(s){switch(s.label){case 0:if(!vu(r))throw r;return t.Fh.add(1),[4,Kc(t)];case 1:return s.sent(),t.Mh.set("Offline"),i||(i=function(){return ec(t.Sh)}),t.fs.bo((function(){return e(o,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return _r("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return e.sent(),t.Fh.delete(1),[4,Bc(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function oh(t,e){return e().catch((function(n){return ih(t,n,e)}))}function sh(t){return e(this,void 0,void 0,(function(){var e,r,i,o,s;return n(this,(function(n){switch(n.label){case 0:e=xr(t),r=vh(e),i=e.xh.length>0?e.xh[e.xh.length-1].batchId:-1,n.label=1;case 1:if(!function(t){return Zc(t)&&t.xh.length<10}(e))return[3,7];n.label=2;case 2:return n.trys.push([2,4,,6]),[4,rc(e.Sh,i)];case 3:return null===(o=n.sent())?(0===e.xh.length&&r.Zu(),[3,7]):(i=o.batchId,function(t,e){t.xh.push(e);var n=vh(t);n.Ju()&&n.fh&&n.dh(e.mutations)}(e,o),[3,6]);case 4:return s=n.sent(),[4,ih(e,s)];case 5:return n.sent(),[3,6];case 6:return[3,1];case 7:return uh(e)&&ah(e),[2]}}))}))}function uh(t){return Zc(t)&&!vh(t).Hu()&&t.xh.length>0}function ah(t){vh(t).start()}function ch(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){return vh(t).Th(),[2]}))}))}function hh(t){return e(this,void 0,void 0,(function(){var e,r,i,o;return n(this,(function(n){for(e=vh(t),r=0,i=t.xh;r<i.length;r++)o=i[r],e.dh(o.mutations);return[2]}))}))}function fh(t,r,i){return e(this,void 0,void 0,(function(){var e,o;return n(this,(function(n){switch(n.label){case 0:return e=t.xh.shift(),o=Wu.from(e,r,i),[4,oh(t,(function(){return t.Ch.qh(o)}))];case 1:return n.sent(),[4,sh(t)];case 2:return n.sent(),[2]}}))}))}function lh(t,r){return e(this,void 0,void 0,(function(){return n(this,(function(i){switch(i.label){case 0:return r&&vh(t).fh?[4,function(t,r){return e(this,void 0,void 0,(function(){var e,i;return n(this,(function(n){switch(n.label){case 0:return rs(i=r.code)&&i!==Rr.ABORTED?(e=t.xh.shift(),vh(t).Xu(),[4,oh(t,(function(){return t.Ch.Uh(e.batchId,r)}))]):[3,3];case 1:return n.sent(),[4,sh(t)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))}(t,r)]:[3,2];case 1:i.sent(),i.label=2;case 2:return uh(t)&&ah(t),[2]}}))}))}function ph(t,r){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return e=xr(t),r?(e.Fh.delete(2),[4,Bc(e)]):[3,2];case 1:return n.sent(),[3,5];case 2:return r?[3,4]:(e.Fh.add(2),[4,Kc(e)]);case 3:n.sent(),e.Mh.set("Unknown"),n.label=4;case 4:n.label=5;case 5:return[2]}}))}))}function dh(t){var r=this;return t.Qh||(t.Qh=function(t,e,n){var r=xr(t);return r.mh(),new qc(e,r.Ku,r.credentials,r.Kt,n)}(t.Dh,t.fs,{Eu:eh.bind(null,t),Iu:nh.bind(null,t),uh:rh.bind(null,t)}),t.Oh.push((function(i){return e(r,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return i?(t.Qh.Xu(),$c(t)?Qc(t):t.Mh.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Qh.stop()];case 2:e.sent(),th(t),e.label=3;case 3:return[2]}}))}))}))),t.Qh}function vh(t){var r=this;return t.Kh||(t.Kh=function(t,e,n){var r=xr(t);return r.mh(),new jc(e,r.Ku,r.credentials,r.Kt,n)}(t.Dh,t.fs,{Eu:ch.bind(null,t),Iu:lh.bind(null,t),Eh:hh.bind(null,t),wh:fh.bind(null,t)}),t.Oh.push((function(i){return e(r,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return i?(t.Kh.Xu(),[4,sh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kh.stop()];case 3:e.sent(),t.xh.length>0&&(_r("RemoteStore","Stopping write stream with "+t.xh.length+" pending writes"),t.xh=[]),e.label=4;case 4:return[2]}}))}))}))),t.Kh
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var yh=function(){this.Wh=void 0,this.listeners=[]},gh=function(){this.queries=new ya((function(t){return vo(t)}),po),this.onlineState="Unknown",this.jh=new Set};function mh(t,r){return e(this,void 0,void 0,(function(){var e,i,o,s,u,a,c;return n(this,(function(n){switch(n.label){case 0:if(e=xr(t),i=r.query,o=!1,(s=e.queries.get(i))||(o=!0,s=new yh),!o)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),u=s,[4,e.Gh(i)];case 2:return u.Wh=n.sent(),[3,4];case 3:return a=n.sent(),c=Iu(a,"Initialization of query '"+yo(r.query)+"' failed"),[2,void r.onError(c)];case 4:return e.queries.set(i,s),s.listeners.push(r),r.zh(e.onlineState),s.Wh&&r.Hh(s.Wh)&&_h(e),[2]}}))}))}function wh(t,r){return e(this,void 0,void 0,(function(){var e,i,o,s,u;return n(this,(function(n){return e=xr(t),i=r.query,o=!1,(s=e.queries.get(i))&&(u=s.listeners.indexOf(r))>=0&&(s.listeners.splice(u,1),o=0===s.listeners.length),o?[2,(e.queries.delete(i),e.Jh(i))]:[2]}))}))}function bh(t,e){for(var n=xr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,a=n.queries.get(u);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Hh(s)&&(r=!0);a.Wh=s}}r&&_h(n)}function Ih(t,e,n){var r=xr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function _h(t){t.jh.forEach((function(t){t.next()}))}var Eh=function(){function t(t,e,n){this.query=t,this.Yh=e,this.Xh=!1,this.Zh=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hh=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new _s(t.query,t.docs,t.De,e,t.Ce,t.fromCache,t.xe,!0)}var o=!1;return this.Xh?this.tl(t)&&(this.Yh.next(t),o=!0):this.el(t,this.onlineState)&&(this.nl(t),o=!0),this.Zh=t,o},t.prototype.onError=function(t){this.Yh.error(t)},t.prototype.zh=function(t){this.onlineState=t;var e=!1;return this.Zh&&!this.Xh&&this.el(this.Zh,t)&&(this.nl(this.Zh),e=!0),e},t.prototype.el=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.sl&&n||t.docs.nt()&&"Offline"!==e)},t.prototype.tl=function(t){if(t.docChanges.length>0)return!0;var e=this.Zh&&this.Zh.hasPendingWrites!==t.hasPendingWrites;return!(!t.xe&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.nl=function(t){t=_s.Fe(t.query,t.docs,t.Ce,t.fromCache),this.Xh=!0,this.Yh.next(t)},t}(),Th=function(t){this.key=t},Nh=function(t){this.key=t},Ah=function(){function t(t,e){this.query=t,this.al=e,this.ul=null,this.qe=!1,this.hl=gs(),this.Ce=gs(),this.ll=mo(t),this._l=new bs(this.ll)}return Object.defineProperty(t.prototype,"fl",{get:function(){return this.al},enumerable:!1,configurable:!0}),t.prototype.dl=function(t,e){var n=this,r=e?e.wl:new Is,i=e?e._l:this._l,o=e?e.Ce:this.Ce,s=i,u=!1,a=oo(this.query)&&i.size===this.query.limit?i.last():null,c=so(this.query)&&i.size===this.query.limit?i.first():null;if(t.Zt((function(t,e){var h=i.get(t),f=e instanceof Pi?e:null;f&&(f=go(n.query,f)?f:null);var l=!!h&&n.Ce.has(h.key),p=!!f&&(f.bt||n.Ce.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.El(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&n.ll(f,a)>0||c&&n.ll(f,c)<0)&&(u=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(u=!0)),d&&(f?(s=s.add(f),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),oo(this.query)||so(this.query))for(;s.size>this.query.limit;){var h=oo(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{_l:s,wl:r,_c:u,Ce:o}},t.prototype.El=function(t,e){return t.bt&&e.hasCommittedMutations&&!e.bt},t.prototype.Ei=function(t,e,n){var r=this,i=this._l;this._l=t._l,this.Ce=t.Ce;var o=t.wl.Se();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ar()}};return n(t)-n(e)}(t.type,e.type)||r.ll(t.doc,e.doc)})),this.Tl(n);var s=e?this.Il():[],u=0===this.hl.size&&this.qe?1:0,a=u!==this.ul;return this.ul=u,0!==o.length||a?{snapshot:new _s(this.query,t._l,i,o,t.Ce,0===u,a,!1),ml:s}:{ml:s}},t.prototype.zh=function(t){return this.qe&&"Offline"===t?(this.qe=!1,this.Ei({_l:this._l,wl:new Is,Ce:this.Ce,_c:!1},!1)):{ml:[]}},t.prototype.Al=function(t){return!this.al.has(t)&&!!this._l.has(t)&&!this._l.get(t).bt},t.prototype.Tl=function(t){var e=this;t&&(t.Ue.forEach((function(t){return e.al=e.al.add(t)})),t.Qe.forEach((function(t){})),t.Ke.forEach((function(t){return e.al=e.al.delete(t)})),this.qe=t.qe)},t.prototype.Il=function(){var t=this;if(!this.qe)return[];var e=this.hl;this.hl=gs(),this._l.forEach((function(e){t.Al(e.key)&&(t.hl=t.hl.add(e.key))}));var n=[];return e.forEach((function(e){t.hl.has(e)||n.push(new Nh(e))})),this.hl.forEach((function(t){e.has(t)||n.push(new Th(t))})),n},t.prototype.Rl=function(t){this.al=t.Pc,this.hl=gs();var e=this.dl(t.documents);return this.Ei(e,!0)},t.prototype.Pl=function(){return _s.Fe(this.query,this._l,this.Ce,0===this.ul)},t}(),Sh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},xh=function(t){this.key=t,this.yl=!1},Dh=function(){function t(t,e,n,r,i,o){this.Sh=t,this.gl=e,this.Vl=n,this.pl=r,this.currentUser=i,this.bl=o,this.vl={},this.Sl=new ya((function(t){return vo(t)}),po),this.Dl=new Map,this.Cl=[],this.xl=new os(ri.J),this.Nl=new Map,this.Fl=new fc,this.Ol={},this.kl=new Map,this.Ml=Na.Bi(),this.onlineState="Unknown",this.Ll=void 0}return Object.defineProperty(t.prototype,"$l",{get:function(){return!0===this.Ll},enumerable:!1,configurable:!0}),t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kh(t,r){return e(this,void 0,void 0,(function(){var e,i,o,s,u,a;return n(this,(function(n){switch(n.label){case 0:return e=sf(t),(s=e.Sl.get(r))?(i=s.targetId,e.pl.ka(i),o=s.view.Pl(),[3,4]):[3,1];case 1:return[4,ic(e.Sh,fo(r))];case 2:return u=n.sent(),a=e.pl.ka(u.targetId),i=u.targetId,[4,Oh(e,r,i,"current"===a)];case 3:o=n.sent(),e.$l&&Jc(e.gl,u),n.label=4;case 4:return[2,o]}}))}))}function Oh(t,r,i,o){return e(this,void 0,void 0,(function(){var s,u,a,c,h,f;return n(this,(function(l){switch(l.label){case 0:return t.Bl=function(r,i,o){return function(t,r,i,o){return e(this,void 0,void 0,(function(){var e,s,u;return n(this,(function(n){switch(n.label){case 0:return(e=r.view.dl(i))._c?[4,sc(t.Sh,r.query,!1).then((function(t){var n=t.documents;return r.view.dl(n,e)}))]:[3,2];case 1:e=n.sent(),n.label=2;case 2:return s=o&&o.Oe.get(r.targetId),u=r.view.Ei(e,t.$l,s),[2,(Hh(t,r.targetId,u.ml),u.snapshot)]}}))}))}(t,r,i,o)},[4,sc(t.Sh,r,!0)];case 1:return s=l.sent(),u=new Ah(r,s.Pc),a=u.dl(s.documents),c=Ts.Be(i,o&&"Offline"!==t.onlineState),h=u.Ei(a,t.$l,c),Hh(t,i,h.ml),f=new Sh(r,i,u),[2,(t.Sl.set(r,f),t.Dl.has(i)?t.Dl.get(i).push(r):t.Dl.set(i,[r]),h.snapshot)]}}))}))}function Ch(t,r){return e(this,void 0,void 0,(function(){var e,i,o;return n(this,(function(n){switch(n.label){case 0:return e=xr(t),i=e.Sl.get(r),(o=e.Dl.get(i.targetId)).length>1?[2,(e.Dl.set(i.targetId,o.filter((function(t){return!po(t,r)}))),void e.Sl.delete(r))]:e.$l?(e.pl.La(i.targetId),e.pl.Ca(i.targetId)?[3,2]:[4,oc(e.Sh,i.targetId,!1).then((function(){e.pl.Ba(i.targetId),Wc(e.gl,i.targetId),zh(e,i.targetId)})).catch(va)]):[3,3];case 1:n.sent(),n.label=2;case 2:return[3,5];case 3:return zh(e,i.targetId),[4,oc(e.Sh,i.targetId,!0)];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))}function Ph(t,r,i){return e(this,void 0,void 0,(function(){var e,o,s,u;return n(this,(function(n){switch(n.label){case 0:e=uf(t),n.label=1;case 1:return n.trys.push([1,5,,6]),[4,function(t,e){var n,r=xr(t),i=Qr.now(),o=e.reduce((function(t,e){return t.add(e.key)}),gs());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Ic.Zo(t,o).next((function(o){n=o;for(var s=[],u=0,a=e;u<a.length;u++){var c=a[u],h=Go(c,n.get(c.key));null!=h&&s.push(new Jo(c.key,h,Oi(h.proto.mapValue),Uo.exists(!0)))}return r.Ho.Pi(t,i,s,e)}))})).then((function(t){var e=t.Ns(n);return{batchId:t.batchId,oi:e}}))}(e.Sh,r)];case 2:return o=n.sent(),e.pl.xa(o.batchId),function(t,e,n){var r=t.Ol[t.currentUser.R()];r||(r=new os(Or)),r=r.Ht(e,n),t.Ol[t.currentUser.R()]=r}(e,o.batchId,i),[4,Jh(e,o.oi)];case 3:return n.sent(),[4,sh(e.gl)];case 4:return n.sent(),[3,6];case 5:return s=n.sent(),u=Iu(s,"Failed to persist write"),i.reject(u),[3,6];case 6:return[2]}}))}))}function Lh(t,r){return e(this,void 0,void 0,(function(){var e,i;return n(this,(function(n){switch(n.label){case 0:e=xr(t),n.label=1;case 1:return n.trys.push([1,4,,6]),[4,nc(e.Sh,r)];case 2:return i=n.sent(),r.Oe.forEach((function(t,n){var r=e.Nl.get(n);r&&(Sr(t.Ue.size+t.Qe.size+t.Ke.size<=1),t.Ue.size>0?r.yl=!0:t.Qe.size>0?Sr(r.yl):t.Ke.size>0&&(Sr(r.yl),r.yl=!1))})),[4,Jh(e,i,r)];case 3:return n.sent(),[3,6];case 4:return[4,va(n.sent())];case 5:return n.sent(),[3,6];case 6:return[2]}}))}))}function Rh(t,e,n){var r=xr(t);if(r.$l&&0===n||!r.$l&&1===n){var i=[];r.Sl.forEach((function(t,n){var r=n.view.zh(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=xr(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zh(e)&&(r=!0)})),r&&_h(n)}(r.Vl,e),i.length&&r.vl.uh(i),r.onlineState=e,r.$l&&r.pl.Ka(e)}}function Vh(t,r,i){return e(this,void 0,void 0,(function(){var e,o,s,u,a,c;return n(this,(function(n){switch(n.label){case 0:return(e=xr(t)).pl.qa(r,"rejected",i),o=e.Nl.get(r),(s=o&&o.key)?(u=(u=new os(ri.J)).Ht(s,new Li(s,$r.min())),a=gs().add(s),c=new Es($r.min(),new Map,new as(Or),u,a),[4,Lh(e,c)]):[3,2];case 1:return n.sent(),e.xl=e.xl.remove(s),e.Nl.delete(r),Kh(e),[3,4];case 2:return[4,oc(e.Sh,r,!1).then((function(){return zh(e,r,i)})).catch(va)];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))}function Mh(t,r){return e(this,void 0,void 0,(function(){var e,i,o;return n(this,(function(n){switch(n.label){case 0:e=xr(t),i=r.batch.batchId,n.label=1;case 1:return n.trys.push([1,4,,6]),[4,tc(e.Sh,r)];case 2:return o=n.sent(),jh(e,i,null),qh(e,i),e.pl.Fa(i,"acknowledged"),[4,Jh(e,o)];case 3:return n.sent(),[3,6];case 4:return[4,va(n.sent())];case 5:return n.sent(),[3,6];case 6:return[2]}}))}))}function Uh(t,r,i){return e(this,void 0,void 0,(function(){var e,o;return n(this,(function(n){switch(n.label){case 0:e=xr(t),n.label=1;case 1:return n.trys.push([1,4,,6]),[4,function(t,e){var n=xr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n.Ho.yi(t,e).next((function(e){return Sr(null!==e),r=e.keys(),n.Ho.xi(t,e)})).next((function(){return n.Ho.Oi(t)})).next((function(){return n.Ic.Zo(t,r)}))}))}(e.Sh,r)];case 2:return o=n.sent(),jh(e,r,i),qh(e,r),e.pl.Fa(r,"rejected",i),[4,Jh(e,o)];case 3:return n.sent(),[3,6];case 4:return[4,va(n.sent())];case 5:return n.sent(),[3,6];case 6:return[2]}}))}))}function Fh(t,r){return e(this,void 0,void 0,(function(){var e,i,o,s,u;return n(this,(function(n){switch(n.label){case 0:Zc((e=xr(t)).gl)||_r("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,function(t){var e=xr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e.Ho.pi(t)}))}(e.Sh)];case 2:return-1===(i=n.sent())?[2,void r.resolve()]:((o=e.kl.get(i)||[]).push(r),e.kl.set(i,o),[3,4]);case 3:return s=n.sent(),u=Iu(s,"Initialization of waitForPendingWrites() operation failed"),r.reject(u),[3,4];case 4:return[2]}}))}))}function qh(t,e){(t.kl.get(e)||[]).forEach((function(t){t.resolve()})),t.kl.delete(e)}function jh(t,e,n){var r=xr(t),i=r.Ol[r.currentUser.R()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Ol[r.currentUser.R()]=i}}function zh(t,e,n){void 0===n&&(n=null),t.pl.La(e);for(var r=0,i=t.Dl.get(e);r<i.length;r++){var o=i[r];t.Sl.delete(o),n&&t.vl.ql(o,n)}t.Dl.delete(e),t.$l&&t.Fl.kc(e).forEach((function(e){t.Fl.ki(e)||Gh(t,e)}))}function Gh(t,e){var n=t.xl.get(e);null!==n&&(Wc(t.gl,n),t.xl=t.xl.remove(e),t.Nl.delete(n),Kh(t))}function Hh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Th?(t.Fl.sr(o.key,e),Bh(t,o)):o instanceof Nh?(_r("SyncEngine","Document no longer in limbo: "+o.key),t.Fl.rr(o.key,e),t.Fl.ki(o.key)||Gh(t,o.key)):Ar()}}function Bh(t,e){var n=e.key;t.xl.get(n)||(_r("SyncEngine","New document in limbo: "+n),t.Cl.push(n),Kh(t))}function Kh(t){for(;t.Cl.length>0&&t.xl.size<t.bl;){var e=t.Cl.shift(),n=t.Ml.next();t.Nl.set(n,new xh(e)),t.xl=t.xl.Ht(e,n),Jc(t.gl,new bo(fo(io(e.path)),n,2,Yr.U))}}function Jh(t,r,i){return e(this,void 0,void 0,(function(){var o,s,u,a;return n(this,(function(c){switch(c.label){case 0:return o=xr(t),s=[],u=[],a=[],o.Sl.nt()?[3,3]:(o.Sl.forEach((function(t,e){a.push(o.Bl(e,r,i).then((function(t){if(t){o.$l&&o.pl.qa(e.targetId,t.fromCache?"not-current":"current"),s.push(t);var n=Xa.cc(e.targetId,t);u.push(n)}})))})),[4,Promise.all(a)]);case 1:return c.sent(),o.vl.uh(s),[4,function(t,r){return e(this,void 0,void 0,(function(){var e,i,o,s,u,a,c,h,f;return n(this,(function(n){switch(n.label){case 0:e=xr(t),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return hu.forEach(r,(function(n){return hu.forEach(n.rc,(function(r){return e.persistence.Ii.sr(t,n.targetId,r)})).next((function(){return hu.forEach(n.oc,(function(r){return e.persistence.Ii.rr(t,n.targetId,r)}))}))}))}))];case 2:return n.sent(),[3,4];case 3:if(!vu(i=n.sent()))throw i;return _r("LocalStore","Failed to update sequence numbers: "+i),[3,4];case 4:for(o=0,s=r;o<s.length;o++)u=s[o],a=u.targetId,u.fromCache||(c=e.dc.get(a),h=c.Mt,f=c.Bt(h),e.dc=e.dc.Ht(a,f));return[2]}}))}))}(o.Sh,u)];case 2:c.sent(),c.label=3;case 3:return[2]}}))}))}function Wh(t,r){return e(this,void 0,void 0,(function(){var e,i;return n(this,(function(n){switch(n.label){case 0:return(e=xr(t)).currentUser.isEqual(r)?[3,3]:(_r("SyncEngine","User change. New user:",r.R()),[4,Za(e.Sh,r)]);case 1:return i=n.sent(),e.currentUser=r,function(t,e){t.kl.forEach((function(t){t.forEach((function(t){t.reject(new Vr(Rr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.kl.clear()}(e),e.pl.Qa(r,i.Ac,i.Rc),[4,Jh(e,i.mc)];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))}function Xh(t,e){var n=xr(t),r=n.Nl.get(e);if(r&&r.yl)return gs().add(r.key);var i=gs(),o=n.Dl.get(e);if(!o)return i;for(var s=0,u=o;s<u.length;s++){var a=u[s],c=n.Sl.get(a);i=i.ye(c.view.fl)}return i}function Yh(t,r){return e(this,void 0,void 0,(function(){var e,i,o;return n(this,(function(n){switch(n.label){case 0:return[4,sc((e=xr(t)).Sh,r.query,!0)];case 1:return i=n.sent(),o=r.view.Rl(i),[2,(e.$l&&Hh(e,r.targetId,o.ml),o)]}}))}))}function Qh(t){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){return[2,ac((e=xr(t)).Sh).then((function(t){return Jh(e,t)}))]}))}))}function $h(t,r,i,o){return e(this,void 0,void 0,(function(){var e,s;return n(this,(function(n){switch(n.label){case 0:return[4,function(t,e){var n=xr(t),r=xr(n.Ho);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.gi(t,e).next((function(e){return e?n.Ic.Zo(t,e):hu.resolve(null)}))}))}((e=xr(t)).Sh,r)];case 1:return null===(s=n.sent())?[3,6]:"pending"!==i?[3,3]:[4,sh(e.gl)];case 2:return n.sent(),[3,4];case 3:"acknowledged"===i||"rejected"===i?(jh(e,r,o||null),qh(e,r),function(t,e){xr(xr(t).Ho).Ni(e)}(e.Sh,r)):Ar(),n.label=4;case 4:return[4,Jh(e,s)];case 5:return n.sent(),[3,7];case 6:_r("SyncEngine","Cannot apply mutation batch with id: "+r),n.label=7;case 7:return[2]}}))}))}function Zh(t,r){return e(this,void 0,void 0,(function(){var e,i,o,s,u,a,c,h;return n(this,(function(n){switch(n.label){case 0:return sf(e=xr(t)),uf(e),!0!==r||!0===e.Ll?[3,3]:(i=e.pl.Sa(),[4,tf(e,i.rt())]);case 1:return o=n.sent(),e.Ll=!0,[4,ph(e.gl,!0)];case 2:for(n.sent(),s=0,u=o;s<u.length;s++)a=u[s],Jc(e.gl,a);return[3,7];case 3:return!1!==r||!1===e.Ll?[3,7]:(c=[],h=Promise.resolve(),e.Dl.forEach((function(t,n){e.pl.$a(n)?c.push(n):h=h.then((function(){return zh(e,n),oc(e.Sh,n,!0)})),Wc(e.gl,n)})),[4,h]);case 4:return n.sent(),[4,tf(e,c)];case 5:return n.sent(),function(t){var e=xr(t);e.Nl.forEach((function(t,n){Wc(e.gl,n)})),e.Fl.Mc(),e.Nl=new Map,e.xl=new os(ri.J)}(e),e.Ll=!1,[4,ph(e.gl,!1)];case 6:n.sent(),n.label=7;case 7:return[2]}}))}))}function tf(t,r,i){return e(this,void 0,void 0,(function(){var e,i,o,s,u,a,c,h,f,l,p,d,v,y;return n(this,(function(n){switch(n.label){case 0:e=xr(t),i=[],o=[],s=0,u=r,n.label=1;case 1:return s<u.length?(a=u[s],c=void 0,(h=e.Dl.get(a))&&0!==h.length?[4,ic(e.Sh,fo(h[0]))]:[3,7]):[3,13];case 2:c=n.sent(),f=0,l=h,n.label=3;case 3:return f<l.length?(p=l[f],d=e.Sl.get(p),[4,Yh(e,d)]):[3,6];case 4:(v=n.sent()).snapshot&&o.push(v.snapshot),n.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,uc(e.Sh,a)];case 8:return y=n.sent(),[4,ic(e.Sh,y)];case 9:return c=n.sent(),[4,Oh(e,ef(y),a,!1)];case 10:n.sent(),n.label=11;case 11:i.push(c),n.label=12;case 12:return s++,[3,1];case 13:return[2,(e.vl.uh(o),i)]}}))}))}function ef(t){return ro(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function nf(t){var e=xr(t);return xr(xr(e.Sh).persistence).Qo()}function rf(t,r,i,o){return e(this,void 0,void 0,(function(){var e,s,u;return n(this,(function(n){switch(n.label){case 0:return(e=xr(t)).Ll?(_r("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!e.Dl.has(r))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,ac(e.Sh)];case 3:return s=n.sent(),u=Es.$e(r,"current"===i),[4,Jh(e,s,u)];case 4:return n.sent(),[3,8];case 5:return[4,oc(e.Sh,r,!0)];case 6:return n.sent(),zh(e,r,o),[3,8];case 7:Ar(),n.label=8;case 8:return[2]}}))}))}function of(t,r,i){return e(this,void 0,void 0,(function(){var e,o,s,u,a,c,h,f,l,p;return n(this,(function(d){switch(d.label){case 0:if(!(e=sf(t)).Ll)return[3,10];o=0,s=r,d.label=1;case 1:return o<s.length?(u=s[o],e.Dl.has(u)?(_r("SyncEngine","Adding an already active target "+u),[3,5]):[4,uc(e.Sh,u)]):[3,6];case 2:return a=d.sent(),[4,ic(e.Sh,a)];case 3:return c=d.sent(),[4,Oh(e,ef(a),c.targetId,!1)];case 4:d.sent(),Jc(e.gl,c),d.label=5;case 5:return o++,[3,1];case 6:h=function(t){return n(this,(function(n){switch(n.label){case 0:return e.Dl.has(t)?[4,oc(e.Sh,t,!1).then((function(){Wc(e.gl,t),zh(e,t)})).catch(va)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))},f=0,l=i,d.label=7;case 7:return f<l.length?(p=l[f],[5,h(p)]):[3,10];case 8:d.sent(),d.label=9;case 9:return f++,[3,7];case 10:return[2]}}))}))}function sf(t){var e=xr(t);return e.gl.Ch.Bh=Lh.bind(null,e),e.gl.Ch.Sn=Xh.bind(null,e),e.gl.Ch.$h=Vh.bind(null,e),e.vl.uh=bh.bind(null,e.Vl),e.vl.ql=Ih.bind(null,e.Vl),e}function uf(t){var e=xr(t);return e.gl.Ch.qh=Mh.bind(null,e),e.gl.Ch.Uh=Uh.bind(null,e),e}var af=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this.Kt=Mc(t.gu.T),this.pl=this.jl(t),this.persistence=this.Gl(t),[4,this.persistence.start()];case 1:return e.sent(),this.zl=this.Hl(t),this.Sh=this.Jl(t),[2]}}))}))},t.prototype.Hl=function(t){return null},t.prototype.Jl=function(t){return $a(this.persistence,new Ya,t.Yl,this.Kt)},t.prototype.Gl=function(t){return new gc(wc.ra,this.Kt)},t.prototype.jl=function(t){return new Dc},t.prototype.terminate=function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return this.zl&&this.zl.stop(),[4,this.pl.Lo()];case 1:return t.sent(),[4,this.persistence.Lo()];case 2:return t.sent(),[2]}}))}))},t}(),cf=function(r){function i(t,e,n){var i=this;return(i=r.call(this)||this).Xl=t,i.cacheSizeBytes=e,i.forceOwnership=n,i.synchronizeTabs=!1,i}return t(i,r),i.prototype.initialize=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,r.prototype.initialize.call(this,t)];case 1:return e.sent(),[4,cc(this.Sh)];case 2:return e.sent(),[4,this.Xl.initialize(this,t)];case 3:return e.sent(),[4,uf(this.Xl.fa)];case 4:return e.sent(),[4,sh(this.Xl.gl)];case 5:return e.sent(),[2]}}))}))},i.prototype.Jl=function(t){return $a(this.persistence,new Ya,t.Yl,this.Kt)},i.prototype.Hl=function(t){var e=this.persistence.Ii._r;return new Ca(e,t.fs)},i.prototype.Gl=function(t){var e=Ja(t.gu.T,t.gu.persistenceKey),n=void 0!==this.cacheSizeBytes?da.Xs(this.cacheSizeBytes):da.ei;return new Ha(this.synchronizeTabs,e,t.clientId,n,t.fs,Rc(),Vc(),this.Kt,this.pl,!!this.forceOwnership)},i.prototype.jl=function(t){return new Dc},i}(af),hf=function(r){function i(t,e){var n=this;return(n=r.call(this,t,e,!1)||this).Xl=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}return t(i,r),i.prototype.initialize=function(t){return e(this,void 0,void 0,(function(){var i,o=this;return n(this,(function(s){switch(s.label){case 0:return[4,r.prototype.initialize.call(this,t)];case 1:return s.sent(),i=this.Xl.fa,this.pl instanceof xc?(this.pl.fa={nu:$h.bind(null,i),su:rf.bind(null,i),iu:of.bind(null,i),Qo:nf.bind(null,i),eu:Qh.bind(null,i)},[4,this.pl.start()]):[3,3];case 2:s.sent(),s.label=3;case 3:return[4,this.persistence.Po((function(t){return e(o,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,Zh(this.Xl.fa,t)];case 1:return e.sent(),this.zl&&(t&&!this.zl.Tr?this.zl.start(this.Sh):t||this.zl.stop()),[2]}}))}))}))];case 4:return s.sent(),[2]}}))}))},i.prototype.jl=function(t){var e=Rc();if(!xc.Wn(e))throw new Vr(Rr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Ja(t.gu.T,t.gu.persistenceKey);return new xc(e,t.fs,n,t.clientId,t.Yl)},i}(cf),ff=function(){function t(){}return t.prototype.initialize=function(t,r){return e(this,void 0,void 0,(function(){var e=this;return n(this,(function(n){switch(n.label){case 0:return this.Sh?[3,2]:(this.Sh=t.Sh,this.pl=t.pl,this.Dh=this.Zl(r),this.gl=this.t_(r),this.Vl=this.e_(r),this.fa=this.n_(r,!t.synchronizeTabs),this.pl.da=function(t){return Rh(e.fa,t,1)},this.gl.Ch.s_=Wh.bind(null,this.fa),[4,ph(this.gl,this.fa.$l)]);case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.e_=function(t){return new gh},t.prototype.Zl=function(t){var e,n=Mc(t.gu.T),r=(e=t.gu,new Lc(e));return function(t,e,n){return new zc(t,e,n)}(t.credentials,r,n)},t.prototype.t_=function(t){var e,n,r,i,o,s=this;return e=this.Sh,n=this.Dh,r=t.fs,i=function(t){return Rh(s.fa,t,0)},o=Oc.Wn()?new Oc:new kc,new Hc(e,n,r,i,o)},t.prototype.n_=function(t,e){return function(t,e,n,r,i,o,s){var u=new Dh(t,e,n,r,i,o);return s&&(u.Ll=!0),u}(this.Sh,this.gl,this.Vl,this.pl,t.Yl,t.bl,e)},t.prototype.terminate=function(){return function(t){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return e=xr(t),_r("RemoteStore","RemoteStore shutting down."),e.Fh.add(5),[4,Kc(e)];case 1:return n.sent(),e.kh.Lo(),e.Mh.set("Unknown"),[2]}}))}))}(this.gl)},t}(),lf=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.i_(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.i_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.r_=function(){this.muted=!0},t.prototype.i_=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),pf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Vr(Rr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.d_=new ni(t)}return t.prototype.isEqual=function(t){return this.d_.isEqual(t.d_)},t}(),df=function(t){this._methodName=t};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function vf(t,e,n){if(!n)throw new Vr(Rr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function yf(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Vr(Rr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function gf(t,e,n,r){if(!0===e&&!0===r)throw new Vr(Rr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function mf(t){if(!ri.Et(t))throw new Vr(Rr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function wf(t){if(ri.Et(t))throw new Vr(Rr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function bf(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Ar()}function If(t,e){if("_delegate"in t&&(t=t._),!(t instanceof e)){if(e.name===t.constructor.name)throw new Vr(Rr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=bf(t);throw new Vr(Rr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function _f(t,e){if(e<=0)throw new Vr(Rr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ef=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Vr(Rr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Vr(Rr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,gf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Tf=new Map,Nf=function(){function t(t,e){this.w_="(lite)",this.E_=new Ef({}),this.T_=!1,t instanceof Gr?(this.I_=t,this.m_=new Kr):(this.A_=t,this.I_=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Vr(Rr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Gr(t.options.projectId)}(t),this.m_=new Jr(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this.A_)throw new Vr(Rr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.A_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"R_",{get:function(){return this.T_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"P_",{get:function(){return void 0!==this.y_},enumerable:!1,configurable:!0}),t.prototype.g_=function(t){if(this.T_)throw new Vr(Rr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.E_=new Ef(t),void 0!==t.credentials&&(this.m_=function(t){if(!t)return new Kr;switch(t.type){case"gapi":var e=t.client;return Sr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Xr(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Vr(Rr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype.V_=function(){return this.E_},t.prototype.p_=function(){return this.T_=!0,this.E_},t.prototype._delete=function(){return this.y_||(this.y_=this.b_()),this.y_},t.prototype.b_=function(){return this,(t=Tf.get(this))&&(_r("ComponentProvider","Removing Datastore"),Tf.delete(this),t.terminate()),Promise.resolve();var t},t}(),Af=function(){function t(t,e,n){this.v_=e,this.S_=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"D_",{get:function(){return this.S_.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.S_.path.et()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this.S_.path.ot()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new xf(this.firestore,this.v_,this.S_.path.Z())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this.S_)},t}(),Sf=function(){function t(t,e,n){this.v_=e,this.C_=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this.C_)},t}(),xf=function(e){function n(t,n,r){var i=this;return(i=e.call(this,t,n,io(r))||this).firestore=t,i.D_=r,i.type="collection",i}return t(n,e),Object.defineProperty(n.prototype,"id",{get:function(){return this.C_.path.et()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this.C_.path.ot()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this.D_.Z();return t.nt()?null:new Af(this.firestore,null,new ri(t))},enumerable:!1,configurable:!0}),n.prototype.withConverter=function(t){return new n(this.firestore,t,this.D_)},n}(Sf);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Df(t,e){for(var n,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];if(t instanceof Ur&&(t=t._),vf("collection","path",e),t instanceof Nf)return wf(n=ti.ct.apply(ti,i([e],r))),new xf(t,null,n);if(!(t instanceof Af||t instanceof xf))throw new Vr(Rr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return wf(n=ti.ct.apply(ti,i([t.path],r)).child(ti.ct(e))),new xf(t.firestore,null,n)}function kf(t,e){for(var n,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];if(t instanceof Ur&&(t=t._),1===arguments.length&&(e=kr.t()),vf("doc","path",e),t instanceof Nf)return mf(n=ti.ct.apply(ti,i([e],r))),new Af(t,null,new ri(n));if(!(t instanceof Af||t instanceof xf))throw new Vr(Rr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return mf(n=t.D_.child(ti.ct.apply(ti,i([e],r)))),new Af(t.firestore,t instanceof xf?t.v_:null,new ri(n))}function Of(t,e){return t instanceof Ur&&(t=t._),e instanceof Ur&&(e=e._),(t instanceof Af||t instanceof xf)&&(e instanceof Af||e instanceof xf)&&t.firestore===e.firestore&&t.path===e.path&&t.v_===e.v_}function Cf(t,e){return t instanceof Ur&&(t=t._),e instanceof Ur&&(e=e._),t instanceof Sf&&e instanceof Sf&&t.firestore===e.firestore&&po(t.C_,e.C_)&&t.v_===e.v_
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var Pf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Vr(Rr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Vr(Rr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.x_=t,this.N_=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.x_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.N_},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.x_===t.x_&&this.N_===t.N_},t.prototype.toJSON=function(){return{latitude:this.x_,longitude:this.N_}},t.prototype.K=function(t){return Or(this.x_,t.x_)||Or(this.N_,t.N_)},t}(),Lf=/^__.*__$/,Rf=function(){function t(t,e,n){this.data=t,this.zt=e,this.fieldTransforms=n}return t.prototype.F_=function(t,e){return null!==this.zt?new Jo(t,this.data,this.zt,e,this.fieldTransforms):new Ko(t,this.data,e,this.fieldTransforms)},t}(),Vf=function(){function t(t,e,n){this.data=t,this.zt=e,this.fieldTransforms=n}return t.prototype.F_=function(t,e){return new Jo(t,this.data,this.zt,e,this.fieldTransforms)},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ar()}}var Uf=function(){function t(t,e,n,r,i,o){this.settings=t,this.T=e,this.Kt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.O_(),this.fieldTransforms=i||[],this.zt=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k_",{get:function(){return this.settings.k_},enumerable:!1,configurable:!0}),t.prototype.M_=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.T,this.Kt,this.ignoreUndefinedProperties,this.fieldTransforms,this.zt)},t.prototype.L_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.M_({path:n,B_:!1});return r.q_(t),r},t.prototype.U_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.M_({path:n,B_:!1});return r.O_(),r},t.prototype.Q_=function(t){return this.M_({path:void 0,B_:!0})},t.prototype.K_=function(t){return il(t,this.settings.methodName,this.settings.W_||!1,this.path,this.settings.j_)},t.prototype.contains=function(t){return void 0!==this.zt.find((function(e){return t.st(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.st(e.field)}))},t.prototype.O_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.q_(this.path.get(t))},t.prototype.q_=function(t){if(0===t.length)throw this.K_("Document fields must not be empty");if(Mf(this.k_)&&Lf.test(t))throw this.K_('Document fields cannot begin and end with "__"')},t}(),Ff=function(){function t(t,e,n){this.T=t,this.ignoreUndefinedProperties=e,this.Kt=n||Mc(t)}return t.prototype.G_=function(t,e,n,r){return void 0===r&&(r=!1),new Uf({k_:t,methodName:e,j_:n,path:ni.at(),B_:!1,W_:r},this.T,this.Kt,this.ignoreUndefinedProperties)},t}();function qf(t){var e=t.p_(),n=Mc(t.I_);return new Ff(t.I_,!!e.ignoreUndefinedProperties,n)}function jf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.G_(o.merge||o.mergeFields?2:0,e,n,i);tl("Data must be an object, but it was:",s,r);var u,a,c=$f(r,s);if(o.merge)u=new ui(s.zt),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var p=el(e,l[f],n);if(!s.contains(p))throw new Vr(Rr.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");ol(h,p)||h.push(p)}u=new ui(h),a=s.fieldTransforms.filter((function(t){return u.It(t.field)}))}else u=null,a=s.fieldTransforms;return new Rf(new Di(c),u,a)}var zf=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.z_=function(t){if(2!==t.k_)throw 1===t.k_?t.K_(this._methodName+"() can only appear at the top level of your update data"):t.K_(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.zt.push(t.path),null},n.prototype.isEqual=function(t){return t instanceof n},n}(df);function Gf(t,e,n){return new Uf({k_:3,j_:e.settings.j_,methodName:t._methodName,B_:n},e.T,e.Kt,e.ignoreUndefinedProperties)}var Hf=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.z_=function(t){return new Vo(t.path,new xo)},n.prototype.isEqual=function(t){return t instanceof n},n}(df),Bf=function(e){function n(t,n){var r=this;return(r=e.call(this,t)||this).H_=n,r}return t(n,e),n.prototype.z_=function(t){var e=Gf(this,t,!0),n=this.H_.map((function(t){return Qf(t,e)})),r=new Do(n);return new Vo(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(df),Kf=function(e){function n(t,n){var r=this;return(r=e.call(this,t)||this).H_=n,r}return t(n,e),n.prototype.z_=function(t){var e=Gf(this,t,!0),n=this.H_.map((function(t){return Qf(t,e)})),r=new Oo(n);return new Vo(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(df),Jf=function(e){function n(t,n){var r=this;return(r=e.call(this,t)||this).J_=n,r}return t(n,e),n.prototype.z_=function(t){var e=new Po(t.Kt,Eo(t.Kt,this.J_));return new Vo(t.path,e)},n.prototype.isEqual=function(t){return this===t},n}(df);function Wf(t,e,n,r){var i=t.G_(1,e,n);tl("Data must be an object, but it was:",i,r);var o=[],s=new ki;oi(r,(function(t,r){var u=rl(e,t,n);r instanceof Ur&&(r=r._);var a=i.U_(u);if(r instanceof zf)o.push(u);else{var c=Qf(r,a);null!=c&&(o.push(u),s.set(u,c))}}));var u=new ui(o);return new Vf(s.yt(),u,i.fieldTransforms)}function Xf(t,e,n,r,i,o){var s=t.G_(1,e,n),u=[el(e,r,n)],a=[i];if(o.length%2!=0)throw new Vr(Rr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(el(e,o[c])),a.push(o[c+1]);for(var h=[],f=new ki,l=u.length-1;l>=0;--l)if(!ol(h,u[l])){var p=u[l],d=a[l];d instanceof Ur&&(d=d._);var v=s.U_(p);if(d instanceof zf)h.push(p);else{var y=Qf(d,v);null!=y&&(h.push(p),f.set(p,y))}}var g=new ui(h);return new Vf(f.yt(),g,s.fieldTransforms)}function Yf(t,e,n,r){return void 0===r&&(r=!1),Qf(n,t.G_(r?4:3,e))}function Qf(t,e){if(t instanceof Ur&&(t=t._),Zf(t))return tl("Unsupported field value:",e,t),$f(t,e);if(t instanceof df)return function(t,e){if(!Mf(e.k_))throw e.K_(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.K_(t._methodName+"() is not currently supported inside arrays");var n=t.z_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.zt.push(e.path),t instanceof Array){if(e.settings.B_&&4!==e.k_)throw e.K_("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Qf(o[i],e.Q_(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(t instanceof Ur&&(t=t._),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Eo(e.Kt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Qr.fromDate(t);return{timestampValue:Rs(e.Kt,n)}}if(t instanceof Qr)return n=new Qr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Rs(e.Kt,n)};if(t instanceof Pf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Mr)return{bytesValue:Vs(e.Kt,t.l)};if(t instanceof Af){n=e.T;var r=t.firestore.I_;if(!r.isEqual(n))throw e.K_("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Fs(t.firestore.I_||e.T,t.S_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.K_("Unsupported field value: "+bf(t))}(t,e)}function $f(t,e){var n={};return si(t)?e.path&&e.path.length>0&&e.zt.push(e.path):oi(t,(function(t,r){var i=Qf(r,e.L_(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Zf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Qr||t instanceof Pf||t instanceof Mr||t instanceof Af||t instanceof df)}function tl(t,e,n){if(!Zf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=bf(n);throw"an object"===r?e.K_(t+" a custom object"):e.K_(t+" "+r)}}function el(t,e,n){if(e instanceof Ur&&(e=e._),e instanceof pf)return e.d_;if("string"==typeof e)return rl(t,e);throw il("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var nl=new RegExp("[~\\*/\\[\\]]");function rl(t,e,n){if(e.search(nl)>=0)throw il("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(pf.bind.apply(pf,i([void 0],e.split("."))))).d_}catch(r){throw il("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function il(t,e,n,r,i){var o=r&&!r.nt(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new Vr(Rr.INVALID_ARGUMENT,(u+=". ")+t+a)}function ol(t,e){return t.some((function(t){return t.isEqual(e)}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sl=function(){function t(t){this.Dh=t,this.Y_=new Map,this.mutations=[],this.X_=!1,this.Z_=null,this.tf=new Set}return t.prototype.ef=function(t){return e(this,void 0,void 0,(function(){var r,i=this;return n(this,(function(o){switch(o.label){case 0:if(this.nf(),this.mutations.length>0)throw new Vr(Rr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,r){return e(this,void 0,void 0,(function(){var e,i,o,s,u,a;return n(this,(function(n){switch(n.label){case 0:return e=xr(t),i=Bs(e.Kt)+"/documents",o={documents:r.map((function(t){return js(e.Kt,t)}))},[4,e.Cu("BatchGetDocuments",i,o)];case 1:return s=n.sent(),u=new Map,s.forEach((function(t){var n=function(t,e){return"found"in e?function(t,e){Sr(!!e.found),e.found.name,e.found.updateTime;var n=zs(t,e.found.name),r=Us(e.found.updateTime),i=new Di({mapValue:{fields:e.found.fields}});return new Pi(n,r,i,{})}(t,e):"missing"in e?function(t,e){Sr(!!e.missing),Sr(!!e.readTime);var n=zs(t,e.missing),r=Us(e.readTime);return new Li(n,r)}(t,e):Ar()}(e.Kt,t);u.set(n.key.toString(),n)})),a=[],[2,(r.forEach((function(t){var e=u.get(t.toString());Sr(!!e),a.push(e)})),a)]}}))}))}(this.Dh,t)];case 1:return[2,((r=o.sent()).forEach((function(t){t instanceof Li||t instanceof Pi?i.sf(t):Ar()})),r)]}}))}))},t.prototype.set=function(t,e){this.write(e.F_(t,this.Gt(t))),this.tf.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.F_(t,this.rf(t)))}catch(t){this.Z_=t}this.tf.add(t.toString())},t.prototype.delete=function(t){this.write(new ts(t,this.Gt(t))),this.tf.add(t.toString())},t.prototype.commit=function(){return e(this,void 0,void 0,(function(){var t,r=this;return n(this,(function(i){switch(i.label){case 0:if(this.nf(),this.Z_)throw this.Z_;return t=this.Y_,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,e){var n=ri.ft(e);r.mutations.push(new es(n,r.Gt(n)))})),[4,function(t,r){return e(this,void 0,void 0,(function(){var e,i,o;return n(this,(function(n){switch(n.label){case 0:return e=xr(t),i=Bs(e.Kt)+"/documents",o={writes:r.map((function(t){return Ws(e.Kt,t)}))},[4,e.bu("Commit",i,o)];case 1:return n.sent(),[2]}}))}))}(this.Dh,this.mutations)];case 1:return i.sent(),this.X_=!0,[2]}}))}))},t.prototype.sf=function(t){var e;if(t instanceof Pi)e=t.version;else{if(!(t instanceof Li))throw Ar();e=$r.min()}var n=this.Y_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Vr(Rr.ABORTED,"Document version changed between two reads.")}else this.Y_.set(t.key.toString(),e)},t.prototype.Gt=function(t){var e=this.Y_.get(t.toString());return!this.tf.has(t.toString())&&e?Uo.updateTime(e):Uo.Wt()},t.prototype.rf=function(t){var e=this.Y_.get(t.toString());if(!this.tf.has(t.toString())&&e){if(e.isEqual($r.min()))throw new Vr(Rr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Uo.updateTime(e)}return Uo.exists(!0)},t.prototype.write=function(t){this.nf(),this.mutations.push(t)},t.prototype.nf=function(){},t}(),ul=function(){function t(t,e,n,r){this.fs=t,this.Dh=e,this.updateFunction=n,this.Ts=r,this.cf=5,this.zu=new Uc(this.fs,"transaction_retry")}return t.prototype.run=function(){this.af()},t.prototype.af=function(){var t=this;this.zu.Bu((function(){return e(t,void 0,void 0,(function(){var t,e,r=this;return n(this,(function(n){return t=new sl(this.Dh),(e=this.uf(t))&&e.then((function(e){r.fs.ys((function(){return t.commit().then((function(){r.Ts.resolve(e)})).catch((function(t){r.hf(t)}))}))})).catch((function(t){r.hf(t)})),[2]}))}))}))},t.prototype.uf=function(t){try{var e=this.updateFunction(t);return!di(e)&&e.catch&&e.then?e:(this.Ts.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Ts.reject(t),null}},t.prototype.hf=function(t){var e=this;this.cf>0&&this.lf(t)?(this.cf-=1,this.fs.ys((function(){return e.af(),Promise.resolve()}))):this.Ts.reject(t)},t.prototype.lf=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!rs(e)}return!1},t}(),al=function(){function t(t,e,n){var r=this;this.credentials=t,this.fs=e,this.gu=n,this.user=Hr.UNAUTHENTICATED,this.clientId=kr.t(),this._f=function(){},this.N=new cu,this.credentials.S((function(t){_r("FirestoreClient","Received user=",t.uid),r.user=t,r._f(t),r.N.resolve()}))}return t.prototype.getConfiguration=function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return[4,this.N.promise];case 1:return[2,(t.sent(),{fs:this.fs,gu:this.gu,clientId:this.clientId,credentials:this.credentials,Yl:this.user,bl:100})]}}))}))},t.prototype.ff=function(t){var e=this;this._f=t,this.N.promise.then((function(){return e._f(e.user)}))},t.prototype.df=function(){if(this.fs.wf)throw new Vr(Rr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.fs.Ef();var r=new cu;return this.fs.Tf((function(){return e(t,void 0,void 0,(function(){var t,e;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),this.If?[4,this.If.terminate()]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.mf?[4,this.mf.terminate()]:[3,4];case 3:n.sent(),n.label=4;case 4:return this.credentials.D(),r.resolve(),[3,6];case 5:return t=n.sent(),e=Iu(t,"Failed to shutdown persistence"),r.reject(e),[3,6];case 6:return[2]}}))}))})),r.promise},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cl(t,r){return e(this,void 0,void 0,(function(){var i,o,s=this;return n(this,(function(u){switch(u.label){case 0:return t.fs.Af(),_r("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return i=u.sent(),[4,r.initialize(i)];case 2:return u.sent(),o=i.Yl,t.ff((function(i){o.isEqual(i)||(o=i,t.fs.bo((function(){return e(s,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return[4,Za(r.Sh,i)];case 1:return t.sent(),[2]}}))}))})))})),r.persistence.yo((function(){return t.terminate()})),t.mf=r,[2]}}))}))}function hl(t,r){return e(this,void 0,void 0,(function(){var i,o;return n(this,(function(s){switch(s.label){case 0:return t.fs.Af(),[4,fl(t)];case 1:return i=s.sent(),_r("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return o=s.sent(),[4,r.initialize(i,o)];case 3:return s.sent(),t.ff((function(i){return t.fs.bo((function(){return function(t,r){return e(this,void 0,void 0,(function(){var e,i;return n(this,(function(n){switch(n.label){case 0:return(e=xr(t)).fs.Af(),_r("RemoteStore","RemoteStore received new credentials"),i=Zc(e),e.Fh.add(3),[4,Kc(e)];case 1:return n.sent(),i&&e.Mh.set("Unknown"),[4,e.Ch.s_(r)];case 2:return n.sent(),e.Fh.delete(3),[4,Bc(e)];case 3:return n.sent(),[2]}}))}))}(r.gl,i)}))})),t.If=r,[2]}}))}))}function fl(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return t.mf?[3,2]:(_r("FirestoreClient","Using default OfflineComponentProvider"),[4,cl(t,new af)]);case 1:e.sent(),e.label=2;case 2:return[2,t.mf]}}))}))}function ll(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return t.If?[3,2]:(_r("FirestoreClient","Using default OnlineComponentProvider"),[4,hl(t,new ff)]);case 1:e.sent(),e.label=2;case 2:return[2,t.If]}}))}))}function pl(t){return fl(t).then((function(t){return t.persistence}))}function dl(t){return fl(t).then((function(t){return t.Sh}))}function vl(t){return ll(t).then((function(t){return t.gl}))}function yl(t){return ll(t).then((function(t){return t.fa}))}function gl(t){return e(this,void 0,void 0,(function(){var e,r;return n(this,(function(n){switch(n.label){case 0:return[4,ll(t)];case 1:return e=n.sent(),[2,((r=e.Vl).Gh=kh.bind(null,e.fa),r.Jh=Ch.bind(null,e.fa),r)]}}))}))}function ml(t,r,i){var o=this;void 0===i&&(i={});var s=new cu;return t.fs.ys((function(){return e(o,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return e=function(t,e,n,r,i){var o=new lf({next:function(o){e.ys((function(){return wh(t,s)}));var u=o.docs.has(n);!u&&o.fromCache?i.reject(new Vr(Rr.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&o.fromCache&&r&&"server"===r.source?i.reject(new Vr(Rr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Eh(io(n.path),o,{includeMetadataChanges:!0,sl:!0});return mh(t,s)},[4,gl(t)];case 1:return[2,e.apply(void 0,[n.sent(),t.fs,r,i,s])]}}))}))})),s.promise}function wl(t,r,i){var o=this;void 0===i&&(i={});var s=new cu;return t.fs.ys((function(){return e(o,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return e=function(t,e,n,r,i){var o=new lf({next:function(n){e.ys((function(){return wh(t,s)})),n.fromCache&&"server"===r.source?i.reject(new Vr(Rr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Eh(n,o,{includeMetadataChanges:!0,sl:!0});return mh(t,s)},[4,gl(t)];case 1:return[2,e.apply(void 0,[n.sent(),t.fs,r,i,s])]}}))}))})),s.promise}var bl=function(){function t(){var t=this;this.Rf=Promise.resolve(),this.Pf=[],this.yf=!1,this.gf=[],this.Vf=null,this.pf=!1,this.bf=[],this.zu=new Uc(this,"async_queue_retry"),this.vf=function(){var e=Vc();e&&_r("AsyncQueue","Visibility state changed to "+e.visibilityState),t.zu.Uu()};var e=Vc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.vf)}return Object.defineProperty(t.prototype,"wf",{get:function(){return this.yf},enumerable:!1,configurable:!0}),t.prototype.ys=function(t){this.enqueue(t)},t.prototype.Tf=function(t){this.Sf(),this.Df(t)},t.prototype.Ef=function(){if(!this.yf){this.yf=!0;var t=Vc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.vf)}},t.prototype.enqueue=function(t){return this.Sf(),this.yf?new Promise((function(t){})):this.Df(t)},t.prototype.bo=function(t){var e=this;this.ys((function(){return e.Pf.push(t),e.Cf()}))},t.prototype.Cf=function(){return e(this,void 0,void 0,(function(){var t,e=this;return n(this,(function(n){switch(n.label){case 0:if(0===this.Pf.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.Pf[0]()];case 2:return n.sent(),this.Pf.shift(),this.zu.reset(),[3,4];case 3:if(!vu(t=n.sent()))throw t;return _r("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.Pf.length>0&&this.zu.Bu((function(){return e.Cf()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Df=function(t){var e=this,n=this.Rf.then((function(){return e.pf=!0,t().catch((function(t){throw e.Vf=t,e.pf=!1,Er("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.pf=!1,t}))}));return this.Rf=n,n},t.prototype.Ir=function(t,e,n){var r=this;this.Sf(),this.bf.indexOf(t)>-1&&(e=0);var i=bu.Is(this,t,e,n,(function(t){return r.xf(t)}));return this.gf.push(i),i},t.prototype.Sf=function(){this.Vf&&Ar()},t.prototype.Af=function(){},t.prototype.Nf=function(){return e(this,void 0,void 0,(function(){var t;return n(this,(function(e){switch(e.label){case 0:return[4,t=this.Rf];case 1:e.sent(),e.label=2;case 2:if(t!==this.Rf)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Ff=function(t){for(var e=0,n=this.gf;e<n.length;e++)if(n[e].ds===t)return!0;return!1},t.prototype.Of=function(t){var e=this;return this.Nf().then((function(){e.gf.sort((function(t,e){return t.ws-e.ws}));for(var n=0,r=e.gf;n<r.length;n++){var i=r[n];if(i.Ps(),"all"!==t&&i.ds===t)break}return e.Nf()}))},t.prototype.kf=function(t){this.bf.push(t)},t.prototype.xf=function(t){var e=this.gf.indexOf(t);this.gf.splice(e,1)},t}(),Il=function(e){function n(t,n){var r=this;return(r=e.call(this,t,n)||this).Mf=new bl,r.w_="name"in t?t.name:"[DEFAULT]",r}return t(n,e),n.prototype.b_=function(){return this.Lf||El(this),this.Lf.terminate()},n}(Nf);function _l(t){return t.Lf||El(t),t.Lf.df(),t.Lf}function El(t){var e=t.p_(),n=function(t,e,n){return new zr(t,e,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling)}(t.I_,t.w_,e);t.Lf=new al(t.m_,t.Mf,n)}function Tl(t,r,i){var o=this,s=new cu;return t.fs.enqueue((function(){return e(o,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,cl(t,i)];case 1:return n.sent(),[4,hl(t,r)];case 2:return n.sent(),s.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===Rr.FAILED_PRECONDITION||t.code===Rr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(e=n.sent()))throw e;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),s.reject(e),[3,4];case 4:return[2]}}))}))})).then((function(){return s.promise}))}function Nl(t){if(t.R_||t.P_)throw new Vr(Rr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Al=function(){function t(){}return t.prototype.$f=function(t,e){switch(void 0===e&&(e="none"),gi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return hi(t.integerValue||t.doubleValue);case 3:return this.Bf(t.timestampValue);case 4:return this.qf(t,e);case 5:return t.stringValue;case 6:return this.Uf(fi(t.bytesValue));case 7:return this.Qf(t.referenceValue);case 8:return this.Kf(t.geoPointValue);case 9:return this.Wf(t.arrayValue,e);case 10:return this.jf(t.mapValue,e);default:throw Ar()}},t.prototype.jf=function(t,e){var n=this,r={};return oi(t.fields||{},(function(t,i){r[t]=n.$f(i,e)})),r},t.prototype.Kf=function(t){return new Pf(hi(t.latitude),hi(t.longitude))},t.prototype.Wf=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.$f(t,e)}))},t.prototype.qf=function(t,e){switch(e){case"previous":var n=function t(e){var n=e.mapValue.fields.__previous_value__;return li(n)?t(n):n}(t);return null==n?null:this.$f(n,e);case"estimate":return this.Bf(pi(t));default:return null}},t.prototype.Bf=function(t){var e=ci(t);return new Qr(e.seconds,e.nanos)},t.prototype.Gf=function(t,e){var n=ti.ct(t);Sr(au(n));var r=new Gr(n.get(1),n.get(3)),i=new ri(n.X(5));return r.isEqual(e)||Er("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}(),Sl=function(){function t(t,e,n,r,i){this.zf=t,this.Hf=e,this.S_=n,this.Jf=r,this.v_=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this.S_.path.et()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Af(this.zf,this.v_,this.S_)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this.Jf},t.prototype.data=function(){if(this.Jf){if(this.v_){var t=new xl(this.zf,this.Hf,this.S_,this.Jf,null);return this.v_.fromFirestore(t)}return this.Hf.$f(this.Jf.vt())}},t.prototype.get=function(t){if(this.Jf){var e=this.Jf.data().field(Dl("DocumentSnapshot.get",t));if(null!==e)return this.Hf.$f(e)}},t}(),xl=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.data=function(){return e.prototype.data.call(this)},n}(Sl);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dl(t,e){return"string"==typeof e?rl(t,e):e instanceof Ur?e._.d_:e.d_}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kl(t){if(so(t)&&0===t.Nt.length)throw new Vr(Rr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ol=function(){};function Cl(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o.Yf(t)}return t}var Pl=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).Xf=t,i.Zf=n,i.td=r,i.type="where",i}return t(n,e),n.prototype.Yf=function(t){var e=qf(t.firestore),n=function(t,e,n,r,i,o,s){var u;if(i.ht()){if("array-contains"===o||"array-contains-any"===o)throw new Vr(Rr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){ql(s,o);for(var a=[],c=0,h=s;c<h.length;c++){var f=h[c];a.push(Fl(r,t,f))}u={arrayValue:{values:a}}}else u=Fl(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||ql(s,o),u=Yf(n,"where",s,"in"===o||"not-in"===o);var l=ji.create(i,o,u);return function(t,e){if(e.xt()){var n=ao(t);if(null!==n&&!n.isEqual(e.field))throw new Vr(Rr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=uo(t);null!==r&&jl(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new Vr(Rr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Vr(Rr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t.C_,0,e,t.firestore.I_,this.Xf,this.Zf,this.td);return new Sf(t.firestore,t.v_,function(t,e){var n=t.filters.concat([e]);return new no(t.path,t.collectionGroup,t.Nt.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t.C_,n))},n}(Ol),Ll=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).Xf=t,r.ed=n,r.type="orderBy",r}return t(n,e),n.prototype.Yf=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Vr(Rr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Vr(Rr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new $i(e,n);return function(t,e){if(null===uo(t)){var n=ao(t);null!==n&&jl(t,n,e.field)}}(t,r),r}(t.C_,this.Xf,this.ed);return new Sf(t.firestore,t.v_,function(t,e){var n=t.Nt.concat([e]);return new no(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t.C_,e))},n}(Ol),Rl=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).type=t,i.nd=n,i.sd=r,i}return t(n,e),n.prototype.Yf=function(t){return new Sf(t.firestore,t.v_,lo(t.C_,this.nd,this.sd))},n}(Ol),Vl=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).type=t,i.rd=n,i.od=r,i}return t(n,e),n.prototype.Yf=function(t){var e=Ul(t,this.type,this.rd,this.od);return new Sf(t.firestore,t.v_,function(t,e){return new no(t.path,t.collectionGroup,t.Nt.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t.C_,e))},n}(Ol),Ml=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).type=t,i.rd=n,i.od=r,i}return t(n,e),n.prototype.Yf=function(t){var e=Ul(t,this.type,this.rd,this.od);return new Sf(t.firestore,t.v_,function(t,e){return new no(t.path,t.collectionGroup,t.Nt.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t.C_,e))},n}(Ol);function Ul(t,e,n,r){if(n[0]instanceof Ur&&(n[0]=n[0]._),n[0]instanceof Sl)return function(t,e,n,r,i){if(!r)throw new Vr(Rr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,u=ho(t);s<u.length;s++){var a=u[s];if(a.field.ht())o.push(Ei(e,r.key));else{var c=r.field(a.field);if(li(c))throw new Vr(Rr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=a.field.ot();throw new Vr(Rr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Yi(o,i)}(t.C_,t.firestore.I_,e,n[0].Jf,r);var i=qf(t.firestore);return function(t,e,n,r,i,o){var s=t.Nt;if(i.length>s.length)throw new Vr(Rr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.ht()){if("string"!=typeof c)throw new Vr(Rr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!co(t)&&-1!==c.indexOf("/"))throw new Vr(Rr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(ti.ct(c));if(!ri.Et(h))throw new Vr(Rr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var f=new ri(h);u.push(Ei(e,f))}else{var l=Yf(n,r,c);u.push(l)}}return new Yi(u,o)}(t.C_,t.firestore.I_,i,e,n,r)}function Fl(t,e,n){if(n instanceof Ur&&(n=n._),"string"==typeof n){if(""===n)throw new Vr(Rr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!co(e)&&-1!==n.indexOf("/"))throw new Vr(Rr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(ti.ct(n));if(!ri.Et(r))throw new Vr(Rr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Ei(t,new ri(r))}if(n instanceof Af)return Ei(t,n.S_);throw new Vr(Rr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+bf(n)+".")}function ql(t,e){if(!Array.isArray(t)||0===t.length)throw new Vr(Rr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Vr(Rr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function jl(t,e,n){if(!n.isEqual(e))throw new Vr(Rr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zl(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}function Gl(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Hl=function(e){function n(t){var n=this;return(n=e.call(this)||this).firestore=t,n}return t(n,e),n.prototype.Uf=function(t){return new Mr(t)},n.prototype.Qf=function(t){var e=this.Gf(t,this.firestore.I_);return new Af(this.firestore,null,e)},n}(Al),Bl=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Kl=function(e){function n(t,n,r,i,o,s){var u=this;return(u=e.call(this,t,n,r,i,s)||this).zf=t,u.ad=t,u.metadata=o,u}return t(n,e),n.prototype.exists=function(){return e.prototype.exists.call(this)},n.prototype.data=function(t){if(void 0===t&&(t={}),this.Jf){if(this.v_){var e=new Jl(this.zf,this.Hf,this.S_,this.Jf,this.metadata,null);return this.v_.fromFirestore(e,t)}return this.Hf.$f(this.Jf.vt(),t.serverTimestamps)}},n.prototype.get=function(t,e){if(void 0===e&&(e={}),this.Jf){var n=this.Jf.data().field(Dl("DocumentSnapshot.get",t));if(null!==n)return this.Hf.$f(n,e.serverTimestamps)}},n}(Sl),Jl=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.data=function(t){return void 0===t&&(t={}),e.prototype.data.call(this,t)},n}(Kl),Wl=function(){function t(t,e,n,r){this.zf=t,this.Hf=e,this.ud=r,this.metadata=new Bl(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.ud.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this.ud.docs.forEach((function(r){t.call(e,new Jl(n.zf,n.Hf,r.key,r,new Bl(n.ud.Ce.has(r.key),n.ud.fromCache),n.query.v_))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this.ud.Ne)throw new Vr(Rr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.hd&&this.ld===e||(this.hd=function(t,e){if(t.ud.De.nt()){var n=0;return t.ud.docChanges.map((function(e){var r=new Jl(t.zf,t.Hf,e.doc.key,e.doc,new Bl(t.ud.Ce.has(e.doc.key),t.ud.fromCache),t.query.v_);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=t.ud.De;return t.ud.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new Jl(t.zf,t.Hf,e.doc.key,e.doc,new Bl(t.ud.Ce.has(e.doc.key),t.ud.fromCache),t.query.v_),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Xl(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this.ld=e),this.hd},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xl(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ar()}}function Yl(t,e){return t instanceof Kl&&e instanceof Kl?t.zf===e.zf&&t.S_.isEqual(e.S_)&&(null===t.Jf?null===e.Jf:t.Jf.isEqual(e.Jf))&&t.v_===e.v_:t instanceof Wl&&e instanceof Wl&&t.zf===e.zf&&Cf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.ud.isEqual(e.ud)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ql=function(e){function n(t){var n=this;return(n=e.call(this)||this).firestore=t,n}return t(n,e),n.prototype.Uf=function(t){return new Mr(t)},n.prototype.Qf=function(t){var e=this.Gf(t,this.firestore.I_);return new Af(this.firestore,null,e)},n}(Al);function $l(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=If(t,Af);var o=If(t.firestore,Il),s=qf(o);return e instanceof Ur&&(e=e._),tp(o,[("string"==typeof e||e instanceof pf?Xf(s,"updateDoc",t.S_,e,n,r):Wf(s,"updateDoc",t.S_,e)).F_(t.S_,Uo.exists(!0))])}function Zl(t){for(var r,i,o,s=[],u=1;u<arguments.length;u++)s[u-1]=arguments[u];t instanceof Ur&&(t=t._);var a={includeMetadataChanges:!1},c=0;"object"!=typeof s[c]||zl(s[c])||(a=s[c],c++);var h,f,l,p={includeMetadataChanges:a.includeMetadataChanges};if(zl(s[c])){var d=s[c];s[c]=null===(r=d.next)||void 0===r?void 0:r.bind(d),s[c+1]=null===(i=d.error)||void 0===i?void 0:i.bind(d),s[c+2]=null===(o=d.complete)||void 0===o?void 0:o.bind(d)}if(t instanceof Af)f=If(t.firestore,Il),l=io(t.S_.path),h={next:function(e){s[c]&&s[c](ep(f,t,e))},error:s[c+1],complete:s[c+2]};else{var v=If(t,Sf);f=If(v.firestore,Il),l=v.C_;var y=new Ql(f);h={next:function(t){s[c]&&s[c](new Wl(f,y,v,t))},error:s[c+1],complete:s[c+2]},kl(t.C_)}return function(t,r,i,o){var s=this,u=new lf(o),a=new Eh(r,u,i);return t.fs.ys((function(){return e(s,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return e=mh,[4,gl(t)];case 1:return[2,e.apply(void 0,[n.sent(),a])]}}))}))})),function(){u.r_(),t.fs.ys((function(){return e(s,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return e=wh,[4,gl(t)];case 1:return[2,e.apply(void 0,[n.sent(),a])]}}))}))}))}}(_l(f),l,p,h)}function tp(t,r){return function(t,r){var i=this,o=new cu;return t.fs.ys((function(){return e(i,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return e=Ph,[4,yl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r,o])]}}))}))})),o.promise}(_l(t),r)}function ep(t,e,n){var r=n.docs.get(e.S_),i=new Ql(t);return new Kl(t,i,e.S_,r,new Bl(n.hasPendingWrites,n.fromCache),e.v_)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var np=function(){function t(t,e){this.zf=t,this._d=e,this.fd=[],this.dd=!1,this.wd=qf(t)}return t.prototype.set=function(t,e,n){this.Ed();var r=rp(t,this.zf),i=Gl(r.v_,e,n),o=jf(this.wd,"WriteBatch.set",r.S_,i,null!==r.v_,n);return this.fd.push(o.F_(r.S_,Uo.Wt())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this.Ed();var o,s=rp(t,this.zf);return e instanceof Ur&&(e=e._),o="string"==typeof e||e instanceof pf?Xf(this.wd,"WriteBatch.update",s.S_,e,n,r):Wf(this.wd,"WriteBatch.update",s.S_,e),this.fd.push(o.F_(s.S_,Uo.exists(!0))),this},t.prototype.delete=function(t){this.Ed();var e=rp(t,this.zf);return this.fd=this.fd.concat(new ts(e.S_,Uo.Wt())),this},t.prototype.commit=function(){return this.Ed(),this.dd=!0,this.fd.length>0?this._d(this.fd):Promise.resolve()},t.prototype.Ed=function(){if(this.dd)throw new Vr(Rr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function rp(t,e){if(t instanceof Ur&&(t=t._),t.firestore!==e)throw new Vr(Rr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ip=function(e){function n(t,n){var r=this;return(r=e.call(this,t,n)||this).zf=t,r}return t(n,e),n.prototype.get=function(t){var n=this,r=rp(t,this.zf),i=new Ql(this.zf);return e.prototype.get.call(this,t).then((function(t){return new Kl(n.zf,i,r.S_,t.Jf,new Bl(!1,!1),r.v_)}))},n}(function(){function t(t,e){this.zf=t,this.Td=e,this.wd=qf(t)}return t.prototype.get=function(t){var e=this,n=rp(t,this.zf),r=new Hl(this.zf);return this.Td.ef([n.S_]).then((function(t){if(!t||1!==t.length)return Ar();var i=t[0];if(i instanceof Li)return new Sl(e.zf,r,n.S_,null,n.v_);if(i instanceof Pi)return new Sl(e.zf,r,i.key,i,n.v_);throw Ar()}))},t.prototype.set=function(t,e,n){var r=rp(t,this.zf),i=Gl(r.v_,e,n),o=jf(this.wd,"Transaction.set",r.S_,i,null!==r.v_,n);return this.Td.set(r.S_,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=rp(t,this.zf);return e instanceof Ur&&(e=e._),o="string"==typeof e||e instanceof pf?Xf(this.wd,"Transaction.update",s.S_,e,n,r):Wf(this.wd,"Transaction.update",s.S_,e),this.Td.update(s.S_,o),this},t.prototype.delete=function(t){var e=rp(t,this.zf);return this.Td.delete(e.S_),this},t}()),op=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Nl(t=If(t,Il));var n=_l(t),r=t.p_(),i=new ff;return Tl(n,i,new cf(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Nl(t=If(t,Il));var e=_l(t),n=t.p_(),r=new ff;return Tl(e,r,new hf(r,n.cacheSizeBytes))}(t._)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var r=this;if(t.R_&&!t.P_)throw new Vr(Rr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var i=new cu;return t.Mf.Tf((function(){return e(r,void 0,void 0,(function(){var r;return n(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return lu.Wn()?(e=t+"main",[4,lu.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(Ja(t.I_,t.w_))];case 1:return o.sent(),i.resolve(),[3,3];case 2:return r=o.sent(),i.reject(r),[3,3];case 3:return[2]}}))}))})),i.promise}(t._)},t}(),sp=function(r){function i(t,e,n){var i=this;return(i=r.call(this,e)||this).Id=n,i.INTERNAL={delete:function(){return i.terminate()}},t instanceof Gr||(i.md=t),i}return t(i,r),Object.defineProperty(i.prototype,"I_",{get:function(){return this._.I_},enumerable:!1,configurable:!0}),i.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._.V_()),t)).merge,this._.g_(t)},i.prototype.useEmulator=function(t,e){!function(t,e,n){var r=(t=If(t,Nf)).V_();"firestore.googleapis.com"!==r.host&&r.host!==e&&Tr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t.g_(Object.assign(Object.assign({},r),{host:e+":"+n,ssl:!1}))}(this._,t,e)},i.prototype.enableNetwork=function(){return function(t){var r=this;return t.fs.enqueue((function(){return e(r,void 0,void 0,(function(){var e,r;return n(this,(function(n){switch(n.label){case 0:return[4,pl(t)];case 1:return e=n.sent(),[4,vl(t)];case 2:return r=n.sent(),[2,(e.Vo(!0),function(t){var e=xr(t);return e.Fh.delete(0),Bc(e)}(r))]}}))}))}))}(_l(If(this._,Il)))},i.prototype.disableNetwork=function(){return function(t){var r=this;return t.fs.enqueue((function(){return e(r,void 0,void 0,(function(){var r,i;return n(this,(function(o){switch(o.label){case 0:return[4,pl(t)];case 1:return r=o.sent(),[4,vl(t)];case 2:return i=o.sent(),[2,(r.Vo(!1),function(t){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return(e=xr(t)).Fh.add(0),[4,Kc(e)];case 1:return n.sent(),e.Mh.set("Offline"),[2]}}))}))}(i))]}}))}))}))}(_l(If(this._,Il)))},i.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&gf("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Id.enableMultiTabIndexedDbPersistence(this):this.Id.enableIndexedDbPersistence(this,n)},i.prototype.clearPersistence=function(){return this.Id.clearIndexedDbPersistence(this)},i.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.app._removeServiceInstance("firestore-exp"),this._._delete()},i.prototype.waitForPendingWrites=function(){return function(t){var r=this,i=new cu;return t.fs.ys((function(){return e(r,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return e=Fh,[4,yl(t)];case 1:return[2,e.apply(void 0,[n.sent(),i])]}}))}))})),i.promise}(_l(If(this._,Il)))},i.prototype.onSnapshotsInSync=function(t){return function(t,r){return function(t,r){var i=this,o=new lf(r);return t.fs.ys((function(){return e(i,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return e=function(t,e){xr(t).jh.add(e),e.next()},[4,gl(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))})),function(){o.r_(),t.fs.ys((function(){return e(i,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return e=function(t,e){xr(t).jh.delete(e)},[4,gl(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))}))}}(_l(t=If(t,Il)),zl(r)?r:{next:r})}(this._,t)},Object.defineProperty(i.prototype,"app",{get:function(){if(!this.md)throw new Vr(Rr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.md},enumerable:!1,configurable:!0}),i.prototype.collection=function(t){try{return new bp(this,Df(this._,t))}catch(t){throw lp(t,"collection()","Firestore.collection()")}},i.prototype.doc=function(t){try{return new fp(this,kf(this._,t))}catch(t){throw lp(t,"doc()","Firestore.doc()")}},i.prototype.collectionGroup=function(t){try{return new gp(this,function(t,e){if(t=If(t,Nf),vf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Vr(Rr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Sf(t,null,function(t){return new no(ti.at(),t)}(e))}(this._,t))}catch(t){throw lp(t,"collectionGroup()","Firestore.collectionGroup()")}},i.prototype.runTransaction=function(t){var r=this;return function(t,r){return function(t,r){var i=this,o=new cu;return t.fs.ys((function(){return e(i,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return[4,function(t){return ll(t).then((function(t){return t.Dh}))}(t)];case 1:return e=n.sent(),new ul(t.fs,e,r,o).run(),[2]}}))}))})),o.promise}(_l(t),(function(e){return r(new ip(t,e))}))}(this._,(function(e){return t(new ap(r,e))}))},i.prototype.batch=function(){var t=this;return _l(this._),new cp(new np(this._,(function(e){return tp(t._,e)})))},i.prototype.loadBundle=function(t){throw new Vr(Rr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},i.prototype.namedQuery=function(t){throw new Vr(Rr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},i}(Ur),up=function(e){function n(t){var n=this;return(n=e.call(this)||this).firestore=t,n}return t(n,e),n.prototype.Uf=function(t){return new jr(new Mr(t))},n.prototype.Qf=function(t){var e=this.Gf(t,this.firestore.I_);return fp.Ad(e,this.firestore,null)},n}(Al);var ap=function(e){function n(t,n){var r=this;return(r=e.call(this,n)||this).zf=t,r.Hf=new up(t),r}return t(n,e),n.prototype.get=function(t){var e=this,n=Ip(t);return this._.get(n).then((function(t){return new vp(e.zf,new Kl(e.zf._,e.Hf,t.S_,t.Jf,t.metadata,n.v_))}))},n.prototype.set=function(t,e,n){var r=Ip(t);return n?(yf("Transaction.set",n),this._.set(r,e,n)):this._.set(r,e),this},n.prototype.update=function(t,e,n){for(var r,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var u=Ip(t);return 2===arguments.length?this._.update(u,e):(r=this._).update.apply(r,i([u,e,n],o)),this},n.prototype.delete=function(t){var e=Ip(t);return this._.delete(e),this},n}(Ur),cp=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.set=function(t,e,n){var r=Ip(t);return n?(yf("WriteBatch.set",n),this._.set(r,e,n)):this._.set(r,e),this},n.prototype.update=function(t,e,n){for(var r,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var u=Ip(t);return 2===arguments.length?this._.update(u,e):(r=this._).update.apply(r,i([u,e,n],o)),this},n.prototype.delete=function(t){var e=Ip(t);return this._.delete(e),this},n.prototype.commit=function(){return this._.commit()},n}(Ur),hp=function(e){function n(t,n,r){var i=this;return(i=e.call(this,r)||this).zf=t,i.Hf=n,i}return t(n,e),n.prototype.fromFirestore=function(t,e){var n=new Jl(this.zf._,this.Hf,t.S_,t.Jf,t.metadata,null);return this._.fromFirestore(new yp(this.zf,n),null!=e?e:{})},n.prototype.toFirestore=function(t,e){return e?this._.toFirestore(t,e):this._.toFirestore(t)},n.Rd=function(t,e){var r=n.Pd,i=r.get(t);i||(i=new WeakMap,r.set(t,i));var o=i.get(e);return o||(o=new n(t,new up(t),e),i.set(e,o)),o},n}(Ur);hp.Pd=new WeakMap;var fp=function(r){function o(t,e){var n=this;return(n=r.call(this,e)||this).firestore=t,n.Hf=new up(t),n}return t(o,r),o.yd=function(t,e,n){if(t.length%2!=0)throw new Vr(Rr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.ot()+" has "+t.length);return new o(e,new Af(e._,n,new ri(t)))},o.Ad=function(t,e,n){return new o(e,new Af(e._,n,t))},Object.defineProperty(o.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"parent",{get:function(){return new bp(this.firestore,this._.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"path",{get:function(){return this._.path},enumerable:!1,configurable:!0}),o.prototype.collection=function(t){try{return new bp(this.firestore,Df(this._,t))}catch(t){throw lp(t,"collection()","DocumentReference.collection()")}},o.prototype.isEqual=function(t){return t instanceof Ur&&(t=t._),t instanceof Af&&Of(this._,t)},o.prototype.set=function(t,e){e=yf("DocumentReference.set",e);try{return function(t,e,n){t=If(t,Af);var r=If(t.firestore,Il),i=Gl(t.v_,e,n);return tp(r,[jf(qf(r),"setDoc",t.S_,i,null!==t.v_,n).F_(t.S_,Uo.Wt())])}(this._,t,e)}catch(t){throw lp(t,"setDoc()","DocumentReference.set()")}},o.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?$l(this._,t):$l.apply(void 0,i([this._,t,e],n))}catch(t){throw lp(t,"updateDoc()","DocumentReference.update()")}},o.prototype.delete=function(){return tp(If((t=this._).firestore,Il),[new ts(t.S_,Uo.Wt())]);var t},o.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=pp(e),i=dp(e,(function(e){return new vp(t.firestore,new Kl(t.firestore._,t.Hf,e.S_,e.Jf,e.metadata,t._.v_))}));return Zl(this._,r,i)},o.prototype.get=function(t){var r=this;return("cache"===(null==t?void 0:t.source)?function(t){t=If(t,Af);var r=If(t.firestore,Il),i=_l(r),o=new Ql(r);return function(t,r){var i=this,o=new cu;return t.fs.ys((function(){return e(i,void 0,void 0,(function(){var i;return n(this,(function(s){switch(s.label){case 0:return i=function(t,r,i){return e(this,void 0,void 0,(function(){var e,o;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,function(t,e){var n=xr(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Ic.Jo(t,e)}))}(t,r)];case 1:return(o=n.sent())instanceof Pi?i.resolve(o):o instanceof Li?i.resolve(null):i.reject(new Vr(Rr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return e=n.sent(),o=Iu(e,"Failed to get document '"+r+" from cache"),i.reject(o),[3,3];case 3:return[2]}}))}))},[4,dl(t)];case 1:return[2,i.apply(void 0,[s.sent(),r,o])]}}))}))})),o.promise}(i,t.S_).then((function(e){return new Kl(r,o,t.S_,e,new Bl(e instanceof Pi&&e.bt,!0),t.v_)}))}(this._):"server"===(null==t?void 0:t.source)?function(t){t=If(t,Af);var e=If(t.firestore,Il);return ml(_l(e),t.S_,{source:"server"}).then((function(n){return ep(e,t,n)}))}(this._):function(t){t=If(t,Af);var e=If(t.firestore,Il);return ml(_l(e),t.S_).then((function(n){return ep(e,t,n)}))}(this._)).then((function(t){return new vp(r.firestore,new Kl(r.firestore._,r.Hf,t.S_,t.Jf,t.metadata,r._.v_))}))},o.prototype.withConverter=function(t){return new o(this.firestore,this._.withConverter(hp.Rd(this.firestore,t)))},o}(Ur);function lp(t,e,n){return t.message=t.message.replace(e,n),t}function pp(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!zl(r))return r}return{}}function dp(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=zl(t[0])?t[0]:zl(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var vp=function(e){function n(t,n){var r=this;return(r=e.call(this,n)||this).zf=t,r}return t(n,e),Object.defineProperty(n.prototype,"ref",{get:function(){return new fp(this.zf,this._.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"metadata",{get:function(){return this._.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"exists",{get:function(){return this._.exists()},enumerable:!1,configurable:!0}),n.prototype.data=function(t){return this._.data(t)},n.prototype.get=function(t,e){return this._.get(t,e)},n.prototype.isEqual=function(t){return Yl(this._,t._)},n}(Ur),yp=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.data=function(t){return this._.data(t)},n}(vp),gp=function(r){function i(t,e){var n=this;return(n=r.call(this,e)||this).firestore=t,n.Hf=new up(t),n}return t(i,r),i.prototype.where=function(t,e,n){try{return new i(this.firestore,Cl(this._,function(t,e,n){var r=e,i=Dl("where",t);return new Pl(i,r,n)}(t,e,n)))}catch(t){throw lp(t,/(orderBy|where)\(\)/,"Query.$1()")}},i.prototype.orderBy=function(t,e){try{return new i(this.firestore,Cl(this._,function(t,e){void 0===e&&(e="asc");var n=e,r=Dl("orderBy",t);return new Ll(r,n)}(t,e)))}catch(t){throw lp(t,/(orderBy|where)\(\)/,"Query.$1()")}},i.prototype.limit=function(t){try{return new i(this.firestore,Cl(this._,function(t){return _f("limit",t),new Rl("limit",t,"F")}(t)))}catch(t){throw lp(t,"limit()","Query.limit()")}},i.prototype.limitToLast=function(t){try{return new i(this.firestore,Cl(this._,function(t){return _f("limitToLast",t),new Rl("limitToLast",t,"L")}(t)))}catch(t){throw lp(t,"limitToLast()","Query.limitToLast()")}},i.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new i(this.firestore,Cl(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vl("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw lp(t,"startAt()","Query.startAt()")}},i.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new i(this.firestore,Cl(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vl("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw lp(t,"startAfter()","Query.startAfter()")}},i.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new i(this.firestore,Cl(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ml("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw lp(t,"endBefore()","Query.endBefore()")}},i.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new i(this.firestore,Cl(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ml("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw lp(t,"endAt()","Query.endAt()")}},i.prototype.isEqual=function(t){return Cf(this._,t._)},i.prototype.get=function(t){var r=this;return("cache"===(null==t?void 0:t.source)?function(t){t=If(t,Sf);var r=If(t.firestore,Il),i=_l(r),o=new Ql(r);return function(t,r){var i=this,o=new cu;return t.fs.ys((function(){return e(i,void 0,void 0,(function(){var i;return n(this,(function(s){switch(s.label){case 0:return i=function(t,r,i){return e(this,void 0,void 0,(function(){var e,o,s,u,a;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,sc(t,r,!0)];case 1:return a=n.sent(),e=new Ah(r,a.Pc),o=e.dl(a.documents),s=e.Ei(o,!1),i.resolve(s.snapshot),[3,3];case 2:return u=n.sent(),a=Iu(u,"Failed to execute query '"+r+" against cache"),i.reject(a),[3,3];case 3:return[2]}}))}))},[4,dl(t)];case 1:return[2,i.apply(void 0,[s.sent(),r,o])]}}))}))})),o.promise}(i,t.C_).then((function(e){return new Wl(r,o,t,e)}))}(this._):"server"===(null==t?void 0:t.source)?function(t){t=If(t,Sf);var e=If(t.firestore,Il),n=_l(e),r=new Ql(e);return wl(n,t.C_,{source:"server"}).then((function(n){return new Wl(e,r,t,n)}))}(this._):function(t){t=If(t,Sf);var e=If(t.firestore,Il),n=_l(e),r=new Ql(e);return kl(t.C_),wl(n,t.C_).then((function(n){return new Wl(e,r,t,n)}))}(this._)).then((function(t){return new wp(r.firestore,new Wl(r.firestore._,r.Hf,r._,t.ud))}))},i.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=pp(e),i=dp(e,(function(e){return new wp(t.firestore,new Wl(t.firestore._,t.Hf,t._,e.ud))}));return Zl(this._,r,i)},i.prototype.withConverter=function(t){return new i(this.firestore,this._.withConverter(hp.Rd(this.firestore,t)))},i}(Ur),mp=function(e){function n(t,n){var r=this;return(r=e.call(this,n)||this).zf=t,r}return t(n,e),Object.defineProperty(n.prototype,"type",{get:function(){return this._.type},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"doc",{get:function(){return new yp(this.zf,this._.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"oldIndex",{get:function(){return this._.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"newIndex",{get:function(){return this._.newIndex},enumerable:!1,configurable:!0}),n}(Ur),wp=function(e){function n(t,n){var r=this;return(r=e.call(this,n)||this).zf=t,r}return t(n,e),Object.defineProperty(n.prototype,"query",{get:function(){return new gp(this.zf,this._.query)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"metadata",{get:function(){return this._.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"size",{get:function(){return this._.size},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"empty",{get:function(){return this._.empty},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"docs",{get:function(){var t=this;return this._.docs.map((function(e){return new yp(t.zf,e)}))},enumerable:!1,configurable:!0}),n.prototype.docChanges=function(t){var e=this;return this._.docChanges(t).map((function(t){return new mp(e.zf,t)}))},n.prototype.forEach=function(t,e){var n=this;this._.forEach((function(r){t.call(e,new yp(n.zf,r))}))},n.prototype.isEqual=function(t){return Yl(this._,t._)},n}(Ur),bp=function(e){function n(t,n){var r=this;return(r=e.call(this,t,n)||this).firestore=t,r._=n,r}return t(n,e),Object.defineProperty(n.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._.path},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this._.parent;return t?new fp(this.firestore,t):null},enumerable:!1,configurable:!0}),n.prototype.doc=function(t){try{return new fp(this.firestore,void 0===t?kf(this._):kf(this._,t))}catch(t){throw lp(t,"doc()","CollectionReference.doc()")}},n.prototype.add=function(t){var e=this;return function(t,e){var n=If(t.firestore,Il),r=kf(t),i=Gl(t.v_,e);return tp(n,[jf(qf(t.firestore),"addDoc",r.S_,i,null!==t.v_,{}).F_(r.S_,Uo.exists(!1))]).then((function(){return r}))}(this._,t).then((function(t){return new fp(e.firestore,t)}))},n.prototype.isEqual=function(t){return Of(this._,t._)},n.prototype.withConverter=function(t){return new n(this.firestore,this._.withConverter(hp.Rd(this.firestore,t)))},n}(gp);function Ip(t){return t instanceof Ur&&(t=t._),If(t,Af)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _p,Ep=function(e){function n(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.call(this,new(pf.bind.apply(pf,i([void 0],t))))||this}return t(n,e),n.documentId=function(){return new n(ni.lt().ot())},n.prototype.isEqual=function(t){return t instanceof Ur&&(t=t._),t instanceof pf&&this._.d_.isEqual(t.d_)},n}(Ur),Tp=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.serverTimestamp=function(){var t=new Hf("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new n(t)},n.delete=function(){var t=new zf("deleteField");return t._methodName="FieldValue.delete",new n(t)},n.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Bf("arrayUnion",t)}.apply(void 0,t);return r._methodName="FieldValue.arrayUnion",new n(r)},n.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Kf("arrayRemove",t)}.apply(void 0,t);return r._methodName="FieldValue.arrayRemove",new n(r)},n.increment=function(t){var e=function(t){return new Jf("increment",t)}(t);return e._methodName="FieldValue.increment",new n(e)},n.prototype.isEqual=function(t){return this._.isEqual(t._)},n}(Ur),Np={Firestore:sp,GeoPoint:Pf,Timestamp:Qr,Blob:jr,Transaction:ap,WriteBatch:cp,DocumentReference:fp,DocumentSnapshot:vp,Query:gp,QueryDocumentSnapshot:yp,QuerySnapshot:wp,CollectionReference:bp,FieldPath:Ep,FieldValue:Tp,setLogLevel:function(t){var e;e=t,br.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new p("firestore",(function(t){return function(t,e){return new sp(t,new Il(t,e),new op)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},Np)))})(_p=d),_p.registerVersion("@firebase/firestore","2.1.3");
//# sourceMappingURL=firestore.js.map
